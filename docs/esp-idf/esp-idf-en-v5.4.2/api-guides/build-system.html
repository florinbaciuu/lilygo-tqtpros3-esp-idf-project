<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-73KGWFC8DM"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-73KGWFC8DM');
        </script><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Build System - ESP32 -  &mdash; ESP-IDF Programming Guide v5.4.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=a60756f2" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=949a1ff5" />
      <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css?v=851bd809" />

  
    <link rel="canonical" href="https://docs.espressif.com/projects/esp-idf/en/stable/esp32/api-guides/build-system.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=c241bbaf"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=ff8fa330"></script>
        <script src="https://wavedrom.com/skins/default.js"></script>
        <script src="https://wavedrom.com/wavedrom.min.js"></script>
    <script src="../_static/js/theme.js"></script>

    
        

    <script type="text/javascript">
        DOCUMENTATION_OPTIONS.PAGENAME = 'api-guides/build-system';
        DOCUMENTATION_OPTIONS.PROJECT_SLUG = 'esp-idf';
        DOCUMENTATION_OPTIONS.LATEST_BRANCH_NAME = 'master';
        DOCUMENTATION_OPTIONS.VERSIONS_URL = 'https://dl.espressif.com/dl/esp-idf/idf_versions.js';
        DOCUMENTATION_OPTIONS.LANGUAGES = ["en", "zh_CN"];
        DOCUMENTATION_OPTIONS.IDF_TARGET = 'esp32';
        DOCUMENTATION_OPTIONS.HAS_IDF_TARGETS = ["esp32", "esp32s2", "esp32s3", "esp32c3", "esp32c2", "esp32c5", "esp32c6", "esp32p4"]
        DOCUMENTATION_OPTIONS.RELEASE = 'v5.4.2';
        DOCUMENTATION_OPTIONS.LANGUAGE_URL = 'en';

    </script>

    <script type="text/javascript" src="https://dl.espressif.com/dl/esp-idf/idf_versions.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="RF Coexistence" href="coexist.html" />
    <link rel="prev" title="Bootloader" href="bootloader.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            ESP-IDF Programming Guide
              <img src="../_static/espressif-logo.svg" class="logo" alt="Logo"/>
          </a>

          
            <div class="selectors">
              <select id="target-select" style="width: 150px;" hidden>
                <option value="" disabled selected>Choose target...</option>
              </select>
            </div>
          

          <div class="selectors">
            <select id="version-select" style="width: 150px;" hidden>
              <option value="" disabled selected>Choose version...</option>
            </select>
          </div>

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../get-started/index.html">Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api-reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hw-reference/index.html">Hardware Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">API Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="app_trace.html">Application Level Tracing Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="startup.html">Application Startup Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="classic-bt/index.html">Bluetooth<sup>®</sup> Classic</a></li>
<li class="toctree-l2"><a class="reference internal" href="ble/index.html">Bluetooth<sup>®</sup> Low Energy</a></li>
<li class="toctree-l2"><a class="reference internal" href="esp-ble-mesh/ble-mesh-index.html">ESP-BLE-MESH</a></li>
<li class="toctree-l2"><a class="reference internal" href="bootloader.html">Bootloader</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Build System</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#concepts">Concepts</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#using-the-build-system">Using the Build System</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#idf-py"><code class="docutils literal notranslate"><span class="pre">idf.py</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-cmake-directly">Using CMake Directly</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-cmake-in-an-ide">Using CMake in an IDE</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-the-python-interpreter">Setting up the Python Interpreter</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#example-project">Example Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="#project-cmakelists-file">Project CMakeLists File</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#minimal-example-cmakelists">Minimal Example CMakeLists</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mandatory-parts">Mandatory Parts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optional-project-variables">Optional Project Variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#renaming-main-component">Renaming <code class="docutils literal notranslate"><span class="pre">main</span></code> Component</a></li>
<li class="toctree-l4"><a class="reference internal" href="#overriding-default-build-specifications">Overriding Default Build Specifications</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#component-cmakelists-files">Component CMakeLists Files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#searching-for-components">Searching for Components</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multiple-components-with-the-same-name">Multiple Components with the Same Name</a></li>
<li class="toctree-l4"><a class="reference internal" href="#minimal-component-cmakelists">Minimal Component CMakeLists</a></li>
<li class="toctree-l4"><a class="reference internal" href="#preset-component-variables">Preset Component Variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-project-variables">Build/Project Variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#controlling-component-compilation">Controlling Component Compilation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#component-configuration">Component Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#preprocessor-definitions">Preprocessor Definitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#component-requirements">Component Requirements</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#when-writing-a-component">When Writing a Component</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-of-component-requirements">Example of Component Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#source-file-include-directories">Source File Include Directories</a></li>
<li class="toctree-l4"><a class="reference internal" href="#main-component-requirements">Main Component Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#common-component-requirements">Common Component Requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#including-components-in-the-build">Including Components in the Build</a></li>
<li class="toctree-l4"><a class="reference internal" href="#circular-dependencies">Circular Dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requirements-in-the-build-system-implementation">Requirements in the Build System Implementation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#overriding-parts-of-the-project">Overriding Parts of the Project</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#project-include-cmake">Project_include.cmake</a></li>
<li class="toctree-l4"><a class="reference internal" href="#kconfig-projbuild">KConfig.projbuild</a></li>
<li class="toctree-l4"><a class="reference internal" href="#wrappers-to-redefine-or-extend-existing-functions">Wrappers to Redefine or Extend Existing Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#override-the-default-bootloader">Override the Default Bootloader</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configuration-only-components">Configuration-Only Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#debugging-cmake">Debugging CMake</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#warning-on-undefined-variables">Warning On Undefined Variables</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#example-component-cmakelists">Example Component CMakeLists</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#adding-conditional-configuration">Adding Conditional Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#conditions-which-depend-on-the-target">Conditions Which Depend on the Target</a></li>
<li class="toctree-l4"><a class="reference internal" href="#source-code-generation">Source Code Generation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#embedding-binary-data">Embedding Binary Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#code-and-data-placements">Code and Data Placements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fully-overriding-the-component-build-process">Fully Overriding the Component Build Process</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#custom-sdkconfig-defaults">Custom Sdkconfig Defaults</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#target-dependent-sdkconfig-defaults">Target-dependent Sdkconfig Defaults</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#flash-arguments">Flash Arguments</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-the-bootloader">Building the Bootloader</a></li>
<li class="toctree-l3"><a class="reference internal" href="#writing-pure-cmake-components">Writing Pure CMake Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-third-party-cmake-projects-with-components">Using Third-Party CMake Projects with Components</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#using-esp-idf-components-from-external-libraries">Using ESP-IDF Components from External Libraries</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#using-prebuilt-libraries-with-components">Using Prebuilt Libraries with Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-esp-idf-in-custom-cmake-projects">Using ESP-IDF in Custom CMake Projects</a></li>
<li class="toctree-l3"><a class="reference internal" href="#esp-idf-cmake-build-system-api">ESP-IDF CMake Build System API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#idf-build-commands">Idf-build-commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cmake-build-properties">Idf-build-properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#idf-component-commands">Idf-component-commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cmake-component-properties">Idf-component-properties</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#file-globbing-incremental-builds">File Globbing &amp; Incremental Builds</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-system-metadata">Build System Metadata</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#json-configuration-server">JSON Configuration Server</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#build-system-internals">Build System Internals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#build-scripts">Build Scripts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-process">Build Process</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#migrating-from-esp-idf-gnu-make-system">Migrating from ESP-IDF GNU Make System</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#automatic-conversion-tool">Automatic Conversion Tool</a></li>
<li class="toctree-l4"><a class="reference internal" href="#no-longer-available-in-cmake">No Longer Available in CMake</a></li>
<li class="toctree-l4"><a class="reference internal" href="#no-default-values">No Default Values</a></li>
<li class="toctree-l4"><a class="reference internal" href="#no-longer-necessary">No Longer Necessary</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flashing-from-make">Flashing from Make</a></li>
<li class="toctree-l4"><a class="reference internal" href="#application-examples">Application Examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="coexist.html">RF Coexistence</a></li>
<li class="toctree-l2"><a class="reference internal" href="c.html">C Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="cplusplus.html">C++ Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="code-quality/index.html">Code Quality</a></li>
<li class="toctree-l2"><a class="reference internal" href="core_dump.html">Core Dump</a></li>
<li class="toctree-l2"><a class="reference internal" href="current-consumption-measurement-modules.html">Current Consumption Measurement of Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="deep-sleep-stub.html">Deep-sleep Wake Stubs</a></li>
<li class="toctree-l2"><a class="reference internal" href="error-handling.html">Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="esp-wifi-mesh.html">ESP-WIFI-MESH</a></li>
<li class="toctree-l2"><a class="reference internal" href="external-ram.html">Support for External RAM</a></li>
<li class="toctree-l2"><a class="reference internal" href="fatal-errors.html">Fatal Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="file-system-considerations.html">File System Considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="hardware-abstraction.html">Hardware Abstraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="hlinterrupts.html">High Priority Interrupts</a></li>
<li class="toctree-l2"><a class="reference internal" href="jtag-debugging/index.html">JTAG Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="linker-script-generation.html">Linker Script Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="low-power-mode/index.html">Low Power Modes</a></li>
<li class="toctree-l2"><a class="reference internal" href="lwip.html">lwIP</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory-types.html">Memory Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="openthread.html">OpenThread</a></li>
<li class="toctree-l2"><a class="reference internal" href="partition-tables.html">Partition Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="performance/index.html">Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="reproducible-builds.html">Reproducible Builds</a></li>
<li class="toctree-l2"><a class="reference internal" href="RF_calibration.html">RF Calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="stdio.html">Standard I/O and Console Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="thread-local-storage.html">Thread Local Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools/index.html">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="unit-tests.html">Unit Testing in ESP32</a></li>
<li class="toctree-l2"><a class="reference internal" href="host-apps.html">Running ESP-IDF Applications on Host</a></li>
<li class="toctree-l2"><a class="reference internal" href="wifi.html">Wi-Fi Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="wifi-security.html">Wi-Fi Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="wifi-expansion.html">Wi-Fi Expansion</a></li>
<li class="toctree-l2"><a class="reference internal" href="phy.html">PHY</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration-guides/index.html">Migration Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../libraries-and-frameworks/index.html">Libraries and Frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/index.html">Contributions Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../versions.html">ESP-IDF Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../COPYRIGHT.html">Copyrights and Licenses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../languages.html">Switch Between Languages</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ESP-IDF Programming Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">API Guides</a></li>
      <li class="breadcrumb-item active">Build System</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/espressif/esp-idf/blob/v5.4.2/docs/en/api-guides/build-system.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="build-system">
<h1>Build System<a class="headerlink" href="#build-system" title="Permalink to this heading"></a></h1>
<p><a class="reference external" href="../../../../zh_CN/v5.4.2/esp32/api-guides/build-system.html">[中文]</a></p>
<p>This document explains the implementation of the ESP-IDF build system and the concept of &quot;components&quot;. Read this document if you want to know how to organize and build a new ESP-IDF project or component.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>An ESP-IDF project can be seen as an amalgamation of a number of components. For example, for a web server that shows the current humidity, there could be:</p>
<ul class="simple">
<li><p>The ESP-IDF base libraries (libc, ROM bindings, etc)</p></li>
<li><p>The Wi-Fi drivers</p></li>
<li><p>A TCP/IP stack</p></li>
<li><p>The FreeRTOS operating system</p></li>
<li><p>A web server</p></li>
<li><p>A driver for the humidity sensor</p></li>
<li><p>Main code tying it all together</p></li>
</ul>
<p>ESP-IDF makes these components explicit and configurable. To do that, when a project is compiled, the build system will look up all the components in the ESP-IDF directories, the project directories and (optionally) in additional custom component directories. It then allows the user to configure the ESP-IDF project using a text-based menu system to customize each component. After the components in the project are configured, the build system will compile the project.</p>
<section id="concepts">
<h3>Concepts<a class="headerlink" href="#concepts" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>A &quot;project&quot; is a directory that contains all the files and configuration to build a single &quot;app&quot; (executable), as well as additional supporting elements such as a partition table, data/filesystem partitions, and a bootloader.</p></li>
<li><p>&quot;Project configuration&quot; is held in a single file called <code class="docutils literal notranslate"><span class="pre">sdkconfig</span></code> in the root directory of the project. This configuration file is modified via <code class="docutils literal notranslate"><span class="pre">idf.py</span> <span class="pre">menuconfig</span></code> to customize the configuration of the project. A single project contains exactly one project configuration.</p></li>
<li><p>An &quot;app&quot; is an executable that is built by ESP-IDF. A single project will usually build two apps - a &quot;project app&quot; (the main executable, ie your custom firmware) and a &quot;bootloader app&quot; (the initial bootloader program which launches the project app).</p></li>
<li><p>&quot;components&quot; are modular pieces of standalone code that are compiled into static libraries (.a files) and linked to an app. Some are provided by ESP-IDF itself, others may be sourced from other places.</p></li>
<li><p>&quot;Target&quot; is the hardware for which an application is built. A full list of supported targets in your version of ESP-IDF can be seen by running <cite>idf.py --list-targets</cite>.</p></li>
</ul>
<p>Some things are not part of the project:</p>
<ul class="simple">
<li><p>&quot;ESP-IDF&quot; is not part of the project. Instead, it is standalone, and linked to the project via the <code class="docutils literal notranslate"><span class="pre">IDF_PATH</span></code> environment variable which holds the path of the <code class="docutils literal notranslate"><span class="pre">esp-idf</span></code> directory. This allows the ESP-IDF framework to be decoupled from your project.</p></li>
<li><p>The toolchain for compilation is not part of the project. The toolchain should be installed in the system command line PATH.</p></li>
</ul>
</section>
</section>
<section id="using-the-build-system">
<h2>Using the Build System<a class="headerlink" href="#using-the-build-system" title="Permalink to this heading"></a></h2>
<section id="idf-py">
<span id="id1"></span><h3><code class="docutils literal notranslate"><span class="pre">idf.py</span></code><a class="headerlink" href="#idf-py" title="Permalink to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">idf.py</span></code> command-line tool provides a front-end for easily managing your project builds. It manages the following tools:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://cmake.org">CMake</a>, which configures the project to be built</p></li>
<li><p><a class="reference external" href="https://ninja-build.org">Ninja</a> which builds the project</p></li>
<li><p><a class="reference external" href="https://github.com/espressif/esptool/#readme">esptool.py</a> for flashing the target.</p></li>
</ul>
<p>You can read more about configuring the build system using <code class="docutils literal notranslate"><span class="pre">idf.py</span></code> <a class="reference internal" href="tools/idf-py.html"><span class="doc">here</span></a>.</p>
</section>
<section id="using-cmake-directly">
<h3>Using CMake Directly<a class="headerlink" href="#using-cmake-directly" title="Permalink to this heading"></a></h3>
<p><a class="reference internal" href="#idf-py"><span class="std std-ref">idf.py</span></a> is a wrapper around <a class="reference external" href="https://cmake.org">CMake</a> for convenience. However, you can also invoke CMake directly if you prefer.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">idf.py</span></code> does something, it prints each command that it runs for easy reference. For example, the <code class="docutils literal notranslate"><span class="pre">idf.py</span> <span class="pre">build</span></code> command is the same as running these commands in a bash shell (or similar commands for Windows Command Prompt):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>-p<span class="w"> </span>build
<span class="nb">cd</span><span class="w"> </span>build
cmake<span class="w"> </span>..<span class="w"> </span>-G<span class="w"> </span>Ninja<span class="w">   </span><span class="c1"># or &#39;Unix Makefiles&#39;</span>
ninja
</pre></div>
</div>
<p>In the above list, the <code class="docutils literal notranslate"><span class="pre">cmake</span></code> command configures the project and generates build files for use with the final build tool. In this case, the final build tool is <a class="reference external" href="https://ninja-build.org">Ninja</a>: running <code class="docutils literal notranslate"><span class="pre">ninja</span></code> actually builds the project.</p>
<p>It's not necessary to run <code class="docutils literal notranslate"><span class="pre">cmake</span></code> more than once. After the first build, you only need to run <code class="docutils literal notranslate"><span class="pre">ninja</span></code> each time. <code class="docutils literal notranslate"><span class="pre">ninja</span></code> will automatically re-invoke <code class="docutils literal notranslate"><span class="pre">cmake</span></code> if the project needs reconfiguration.</p>
<p>If using CMake with <code class="docutils literal notranslate"><span class="pre">ninja</span></code> or <code class="docutils literal notranslate"><span class="pre">make</span></code>, there are also targets for more of the <code class="docutils literal notranslate"><span class="pre">idf.py</span></code> sub-commands. For example, running <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">menuconfig</span></code> or <code class="docutils literal notranslate"><span class="pre">ninja</span> <span class="pre">menuconfig</span></code> in the build directory will work the same as <code class="docutils literal notranslate"><span class="pre">idf.py</span> <span class="pre">menuconfig</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you're already familiar with <a class="reference external" href="https://cmake.org">CMake</a>, you may find the ESP-IDF CMake-based build system unusual because it wraps a lot of CMake's functionality to reduce boilerplate. See <a class="reference internal" href="#writing-pure-cmake-components">writing pure CMake components</a> for some information about writing more &quot;CMake style&quot; components.</p>
</div>
<section id="flashing-with-ninja-or-make">
<span id="flash-with-ninja-or-make"></span><h4>Flashing with Ninja or Make<a class="headerlink" href="#flashing-with-ninja-or-make" title="Permalink to this heading"></a></h4>
<p>It's possible to build and flash directly from ninja or make by running a target like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ninja<span class="w"> </span>flash
</pre></div>
</div>
<p>Or:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span>app-flash
</pre></div>
</div>
<p>Available targets are: <code class="docutils literal notranslate"><span class="pre">flash</span></code>, <code class="docutils literal notranslate"><span class="pre">app-flash</span></code> (app only), <code class="docutils literal notranslate"><span class="pre">bootloader-flash</span></code> (bootloader only).</p>
<p>When flashing this way, optionally set the <code class="docutils literal notranslate"><span class="pre">ESPPORT</span></code> and <code class="docutils literal notranslate"><span class="pre">ESPBAUD</span></code> environment variables to specify the serial port and baud rate. You can set environment variables in your operating system or IDE project. Alternatively, set them directly on the command line:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">ESPPORT</span><span class="o">=</span>/dev/ttyUSB0<span class="w"> </span>ninja<span class="w"> </span>flash
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Providing environment variables at the start of the command like this is Bash shell Syntax. It will work on Linux and macOS. It won't work when using Windows Command Prompt, but it will work when using Bash-like shells on Windows.</p>
</div>
<p>Or:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span>-j3<span class="w"> </span>app-flash<span class="w"> </span><span class="nv">ESPPORT</span><span class="o">=</span>COM4<span class="w"> </span><span class="nv">ESPBAUD</span><span class="o">=</span><span class="m">2000000</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Providing variables at the end of the command line is <code class="docutils literal notranslate"><span class="pre">make</span></code> syntax, and works for <code class="docutils literal notranslate"><span class="pre">make</span></code> on all platforms.</p>
</div>
</section>
</section>
<section id="using-cmake-in-an-ide">
<h3>Using CMake in an IDE<a class="headerlink" href="#using-cmake-in-an-ide" title="Permalink to this heading"></a></h3>
<p>You can also use an IDE with CMake integration. The IDE will want to know the path to the project's <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file. IDEs with CMake integration often provide their own build tools (CMake calls these &quot;generators&quot;) to build the source files as part of the IDE.</p>
<p>When adding custom non-build steps like &quot;flash&quot; to the IDE, it is recommended to execute <code class="docutils literal notranslate"><span class="pre">idf.py</span></code> for these &quot;special&quot; commands.</p>
<p>For more detailed information about integrating ESP-IDF with CMake into an IDE, see <a class="reference internal" href="#id7">Build System Metadata</a>.</p>
</section>
<section id="setting-up-the-python-interpreter">
<span id="setting-python-interpreter"></span><h3>Setting up the Python Interpreter<a class="headerlink" href="#setting-up-the-python-interpreter" title="Permalink to this heading"></a></h3>
<p>ESP-IDF works well with Python version 3.8+.</p>
<p><code class="docutils literal notranslate"><span class="pre">idf.py</span></code> and other Python scripts will run with the default Python interpreter, i.e., <code class="docutils literal notranslate"><span class="pre">python</span></code>. You can switch to a different one like <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">$IDF_PATH/tools/idf.py</span> <span class="pre">...</span></code>, or you can set up a shell alias or another script to simplify the command.</p>
<p>If using CMake directly, running <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-D</span> <span class="pre">PYTHON=python3</span> <span class="pre">...</span></code> will cause CMake to override the default Python interpreter.</p>
<p>If using an IDE with CMake, setting the <code class="docutils literal notranslate"><span class="pre">PYTHON</span></code> value as a CMake cache override in the IDE UI will override the default Python interpreter.</p>
<p>To manage the Python version more generally via the command line, check out the tools <a class="reference external" href="https://github.com/pyenv/pyenv#readme">pyenv</a> or <a class="reference external" href="https://virtualenv.pypa.io/en/stable/">virtualenv</a>. These let you change the default Python version.</p>
</section>
</section>
<section id="example-project">
<span id="example-project-structure"></span><h2>Example Project<a class="headerlink" href="#example-project" title="Permalink to this heading"></a></h2>
<p>An example project directory tree might look like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>- myProject/
             - CMakeLists.txt
             - sdkconfig
             - dependencies.lock
             - bootloader_components/ - boot_component/ - CMakeLists.txt
                                                        - Kconfig
                                                        - src1.c
             - components/ - component1/ - CMakeLists.txt
                                         - Kconfig
                                         - src1.c
                           - component2/ - CMakeLists.txt
                                         - Kconfig
                                         - src1.c
                                         - include/ - component2.h
             - managed_components/ - namespace__component-name/ - CMakelists.txt
                                                                - src1.c
                                                                - idf_component.yml
                                                                - include/ - src1.h
             - main/       - CMakeLists.txt
                           - src1.c
                           - src2.c
                           - idf_component.yml
             - build/
</pre></div>
</div>
<p>This example &quot;myProject&quot; contains the following elements:</p>
<ul class="simple">
<li><p>A top-level project CMakeLists.txt file. This is the primary file which CMake uses to learn how to build the project; and may set project-wide CMake variables. It includes the file <a class="reference external" href="https://github.com/espressif/esp-idf/blob/v5.4.2/tools/cmake/project.cmake">/tools/cmake/project.cmake</a> which implements the rest of the build system. Finally, it sets the project name and defines the project.</p></li>
<li><p>&quot;sdkconfig&quot; project configuration file. This file is created/updated when <code class="docutils literal notranslate"><span class="pre">idf.py</span> <span class="pre">menuconfig</span></code> runs, and holds the configuration for all of the components in the project (including ESP-IDF itself). The <code class="docutils literal notranslate"><span class="pre">sdkconfig</span></code> file may or may not be added to the source control system of the project.</p></li>
<li><p>&quot;dependencies.lock&quot; file contains the list of all managed components, and their versions, that are currently in used in the project. The <code class="docutils literal notranslate"><span class="pre">dependencies.lock</span></code> file is generated or updated automatically when IDF Component Manager is used to add or update project components. So this file should never be edited manually! If the project does not have <code class="docutils literal notranslate"><span class="pre">idf_component.yml</span></code> files in any of its components, <code class="docutils literal notranslate"><span class="pre">dependencies.lock</span></code> will not be created.</p></li>
<li><p>Optional &quot;idf_component.yml&quot; file contains metadata about the component and its dependencies. It is used by the IDF Component Manager to download and resolve these dependencies. More information about this file can be found in the <a class="reference external" href="https://docs.espressif.com/projects/idf-component-manager/en/latest/reference/manifest_file.html">idf_component.yml</a> section.</p></li>
<li><p>Optional &quot;bootloader_components&quot; directory contains components that need to be compiled and linked inside the bootloader project. A project does not have to contain custom bootloader components of this kind, but it can be useful in case the bootloader needs to be modified to embed new features.</p></li>
<li><p>Optional &quot;components&quot; directory contains components that are part of the project. A project does not have to contain custom components of this kind, but it can be useful for structuring reusable code or including third-party components that aren't part of ESP-IDF. Alternatively, <code class="docutils literal notranslate"><span class="pre">EXTRA_COMPONENT_DIRS</span></code> can be set in the top-level CMakeLists.txt to look for components in other places.</p></li>
<li><p>&quot;main&quot; directory is a special component that contains source code for the project itself. &quot;main&quot; is a default name, the CMake variable <code class="docutils literal notranslate"><span class="pre">COMPONENT_DIRS</span></code> includes this component but you can modify this variable. See the <a class="reference internal" href="#rename-main"><span class="std std-ref">renaming main</span></a> section for more info. If you have a lot of source files in your project, we recommend grouping most into components instead of putting them all in &quot;main&quot;.</p></li>
<li><p>&quot;build&quot; directory is where the build output is created. This directory is created by <code class="docutils literal notranslate"><span class="pre">idf.py</span></code> if it doesn't already exist. CMake configures the project and generates interim build files in this directory. Then, after the main build process is run, this directory will also contain interim object files and libraries as well as final binary output files. This directory is usually not added to source control or distributed with the project source code.</p></li>
<li><p>&quot;managed_components&quot; directory is created by the IDF Component Manager to store components managed by this tool. Each managed component typically includes a <code class="docutils literal notranslate"><span class="pre">idf_component.yml</span></code> manifest file defining the component's metadata, such as version and dependencies. However, for components sourced from Git repositories, the manifest file is optional. Users should avoid manually modifying the contents of the &quot;managed_components&quot; directory. If alterations are needed, the component can be copied to the <code class="docutils literal notranslate"><span class="pre">components</span></code> directory. The &quot;managed_components&quot; directory is usually not versioned in Git and not distributed with the project source code.</p></li>
</ul>
<p>Component directories each contain a component <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file. This file contains variable definitions to control the build process of the component, and its integration into the overall project. See <a class="reference internal" href="#component-cmakelists-files">Component CMakeLists Files</a> for more details.</p>
<p>Each component may also include a <code class="docutils literal notranslate"><span class="pre">Kconfig</span></code> file defining the <a class="reference internal" href="#id3">component configuration</a> options that can be set via <code class="docutils literal notranslate"><span class="pre">menuconfig</span></code>. Some components may also include <code class="docutils literal notranslate"><span class="pre">Kconfig.projbuild</span></code> and <code class="docutils literal notranslate"><span class="pre">project_include.cmake</span></code> files, which are special files for <a class="reference internal" href="#overriding-parts-of-the-project">overriding parts of the project</a>.</p>
</section>
<section id="project-cmakelists-file">
<h2>Project CMakeLists File<a class="headerlink" href="#project-cmakelists-file" title="Permalink to this heading"></a></h2>
<p>Each project has a single top-level <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file that contains build settings for the entire project. By default, the project CMakeLists can be quite minimal.</p>
<section id="minimal-example-cmakelists">
<h3>Minimal Example CMakeLists<a class="headerlink" href="#minimal-example-cmakelists" title="Permalink to this heading"></a></h3>
<p>Minimal project:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.16</span><span class="p">)</span>
<span class="nb">include</span><span class="p">(</span><span class="o">$ENV{</span><span class="nv">IDF_PATH</span><span class="o">}</span><span class="s">/tools/cmake/project.cmake</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s">myProject</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="mandatory-parts">
<span id="project-mandatory-parts"></span><h3>Mandatory Parts<a class="headerlink" href="#mandatory-parts" title="Permalink to this heading"></a></h3>
<p>The inclusion of these three lines, in the order shown above, is necessary for every project:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cmake_minimum_required(VERSION</span> <span class="pre">3.16)</span></code> tells CMake the minimum version that is required to build the project. ESP-IDF is designed to work with CMake 3.16 or newer. This line must be the first line in the CMakeLists.txt file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">include($ENV{IDF_PATH}/tools/cmake/project.cmake)</span></code> pulls in the rest of the CMake functionality to configure the project, discover all the components, etc.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">project(myProject)</span></code> creates the project itself, and specifies the project name. The project name is used for the final binary output files of the app - ie <code class="docutils literal notranslate"><span class="pre">myProject.elf</span></code>, <code class="docutils literal notranslate"><span class="pre">myProject.bin</span></code>. Only one project can be defined per CMakeLists file.</p></li>
</ul>
</section>
<section id="optional-project-variables">
<span id="optional-project-variable"></span><h3>Optional Project Variables<a class="headerlink" href="#optional-project-variables" title="Permalink to this heading"></a></h3>
<p>These variables all have default values that can be overridden for custom behavior. Look in <a class="reference external" href="https://github.com/espressif/esp-idf/blob/v5.4.2/tools/cmake/project.cmake">/tools/cmake/project.cmake</a> for all of the implementation details.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">COMPONENT_DIRS</span></code>: Directories to search for components. Defaults to <code class="docutils literal notranslate"><span class="pre">IDF_PATH/components</span></code>, <code class="docutils literal notranslate"><span class="pre">PROJECT_DIR/components</span></code>, and <code class="docutils literal notranslate"><span class="pre">EXTRA_COMPONENT_DIRS</span></code>. Override this variable if you don't want to search for components in these places.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EXTRA_COMPONENT_DIRS</span></code>: Optional list of additional directories to search for components. Paths can be relative to the project directory, or absolute.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COMPONENTS</span></code>: A list of component names to build into the project. Defaults to all components found in the <code class="docutils literal notranslate"><span class="pre">COMPONENT_DIRS</span></code> directories. Use this variable to &quot;trim down&quot; the project for faster build times. Note that any component which &quot;requires&quot; another component via the REQUIRES or PRIV_REQUIRES arguments on component registration will automatically have it added to this list, so the <code class="docutils literal notranslate"><span class="pre">COMPONENTS</span></code> list can be very short.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">BOOTLOADER_IGNORE_EXTRA_COMPONENT</span></code>: A list of components, placed in <code class="docutils literal notranslate"><span class="pre">bootloader_components/</span></code>, that should be ignored by the bootloader compilation. Use this variable if a bootloader component needs to be included conditionally inside the project.</p></li>
</ul>
<p>Any paths in these variables can be absolute paths, or set relative to the project directory.</p>
<p>To set these variables, use the <a class="reference external" href="https://cmake.org/cmake/help/v3.16/command/set.html">cmake set command</a> ie <code class="docutils literal notranslate"><span class="pre">set(VARIABLE</span> <span class="pre">&quot;VALUE&quot;)</span></code>. The <code class="docutils literal notranslate"><span class="pre">set()</span></code> commands should be placed after the <code class="docutils literal notranslate"><span class="pre">cmake_minimum(...)</span></code> line but before the <code class="docutils literal notranslate"><span class="pre">include(...)</span></code> line.</p>
</section>
<section id="renaming-main-component">
<span id="rename-main"></span><h3>Renaming <code class="docutils literal notranslate"><span class="pre">main</span></code> Component<a class="headerlink" href="#renaming-main-component" title="Permalink to this heading"></a></h3>
<p>The build system provides special treatment to the <code class="docutils literal notranslate"><span class="pre">main</span></code> component. It is a component that gets automatically added to the build provided that it is in the expected location, PROJECT_DIR/main. All other components in the build are also added as its dependencies, saving the user from hunting down dependencies and providing a build that works right out of the box. Renaming the <code class="docutils literal notranslate"><span class="pre">main</span></code> component causes the loss of these behind-the-scenes heavy lifting, requiring the user to specify the location of the newly renamed component and manually specify its dependencies. Specifically, the steps to renaming <code class="docutils literal notranslate"><span class="pre">main</span></code> are as follows:</p>
<ol class="arabic simple">
<li><p>Rename <code class="docutils literal notranslate"><span class="pre">main</span></code> directory.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">EXTRA_COMPONENT_DIRS</span></code> in the project CMakeLists.txt to include the renamed <code class="docutils literal notranslate"><span class="pre">main</span></code> directory.</p></li>
<li><p>Specify the dependencies in the renamed component's CMakeLists.txt file via REQUIRES or PRIV_REQUIRES arguments <a class="reference internal" href="#cmake-minimal-component-cmakelists"><span class="std std-ref">on component registration</span></a>.</p></li>
</ol>
</section>
<section id="overriding-default-build-specifications">
<h3>Overriding Default Build Specifications<a class="headerlink" href="#overriding-default-build-specifications" title="Permalink to this heading"></a></h3>
<p>The build sets some global build specifications (compile flags, definitions, etc.) that gets used in compiling all sources from all components.</p>
<p>For example, one of the default build specifications set is the compile option <code class="docutils literal notranslate"><span class="pre">-Wextra</span></code>. Suppose a user wants to use override this with <code class="docutils literal notranslate"><span class="pre">-Wno-extra</span></code>,
it should be done after <code class="docutils literal notranslate"><span class="pre">project()</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.16</span><span class="p">)</span>
<span class="nb">include</span><span class="p">(</span><span class="o">$ENV{</span><span class="nv">IDF_PATH</span><span class="o">}</span><span class="s">/tools/cmake/project.cmake</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s">myProject</span><span class="p">)</span>

<span class="nb">idf_build_set_property</span><span class="p">(</span><span class="s">COMPILE_OPTIONS</span><span class="w"> </span><span class="s2">&quot;-Wno-error&quot;</span><span class="w"> </span><span class="s">APPEND</span><span class="p">)</span>
</pre></div>
</div>
<p>This ensures that the compile options set by the user won't be overridden by the default build specifications, since the latter are set inside <code class="docutils literal notranslate"><span class="pre">project()</span></code>.</p>
</section>
</section>
<section id="component-cmakelists-files">
<span id="component-directories"></span><h2>Component CMakeLists Files<a class="headerlink" href="#component-cmakelists-files" title="Permalink to this heading"></a></h2>
<p>Each project contains one or more components. Components can be part of ESP-IDF, part of the project's own components directory, or added from custom component directories (<a class="reference internal" href="#component-directories"><span class="std std-ref">see above</span></a>).</p>
<p>A component is any directory in the <code class="docutils literal notranslate"><span class="pre">COMPONENT_DIRS</span></code> list which contains a <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file.</p>
<section id="searching-for-components">
<h3>Searching for Components<a class="headerlink" href="#searching-for-components" title="Permalink to this heading"></a></h3>
<p>The list of directories in <code class="docutils literal notranslate"><span class="pre">COMPONENT_DIRS</span></code> is searched for the project's components. Directories in this list can either be components themselves (ie they contain a <cite>CMakeLists.txt</cite> file), or they can be top-level directories whose sub-directories are components.</p>
<p>When CMake runs to configure the project, it logs the components included in the build. This list can be useful for debugging the inclusion/exclusion of certain components.</p>
</section>
<section id="multiple-components-with-the-same-name">
<span id="cmake-components-same-name"></span><h3>Multiple Components with the Same Name<a class="headerlink" href="#multiple-components-with-the-same-name" title="Permalink to this heading"></a></h3>
<p>When ESP-IDF is collecting all the components to compile, the search precedence is as follows (from highest to lowest):</p>
<ul class="simple">
<li><p>Project components</p></li>
<li><p>Components from <code class="docutils literal notranslate"><span class="pre">EXTRA_COMPONENT_DIRS</span></code></p></li>
<li><p>Project managed components, downloaded by the IDF Component Manager into <code class="docutils literal notranslate"><span class="pre">PROJECT_DIR/managed_components</span></code>, unless the IDF Component Manager is disabled.</p></li>
<li><p>ESP-IDF components (<code class="docutils literal notranslate"><span class="pre">IDF_PATH/components</span></code>)</p></li>
</ul>
<p>If two or more of these directories contain component sub-directories with the same name, the component with higher precedence is used. This allows, for example, overriding ESP-IDF components with a modified version by copying that component from the ESP-IDF components directory to the project components directory and then modifying it there. If used in this way, the ESP-IDF directory itself can remain untouched.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a component is overridden in an existing project by moving it to a new location, the project will not automatically see the new component path. Run <code class="docutils literal notranslate"><span class="pre">idf.py</span> <span class="pre">reconfigure</span></code> (or delete the project build folder) and then build again.</p>
</div>
</section>
<section id="minimal-component-cmakelists">
<span id="cmake-minimal-component-cmakelists"></span><h3>Minimal Component CMakeLists<a class="headerlink" href="#minimal-component-cmakelists" title="Permalink to this heading"></a></h3>
<p>The minimal component <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file simply registers the component to the build system using <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">idf_component_register</span><span class="p">(</span><span class="s">SRCS</span><span class="w"> </span><span class="s2">&quot;foo.c&quot;</span><span class="w"> </span><span class="s2">&quot;bar.c&quot;</span>
<span class="w">                       </span><span class="s">INCLUDE_DIRS</span><span class="w"> </span><span class="s2">&quot;include&quot;</span>
<span class="w">                       </span><span class="s">REQUIRES</span><span class="w"> </span><span class="s">mbedtls</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SRCS</span></code> is a list of source files (<code class="docutils literal notranslate"><span class="pre">*.c</span></code>, <code class="docutils literal notranslate"><span class="pre">*.cpp</span></code>, <code class="docutils literal notranslate"><span class="pre">*.cc</span></code>, <code class="docutils literal notranslate"><span class="pre">*.S</span></code>). These source files will be compiled into the component library.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">INCLUDE_DIRS</span></code> is a list of directories to add to the global include search path for any component which requires this component, and also the main source files.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">REQUIRES</span></code> is not actually required, but it is very often required to declare what other components this component will use. See <a class="reference internal" href="#component-requirements"><span class="std std-ref">component requirements</span></a>.</p></li>
</ul>
<p>A library with the name of the component will be built and linked to the final app.</p>
<p>Directories are usually specified relative to the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file itself, although they can be absolute.</p>
<p>There are other arguments that can be passed to <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code>. These arguments are discussed <a class="reference internal" href="#cmake-component-register"><span class="std std-ref">here</span></a>.</p>
<p>See <a class="reference internal" href="#example-component-requirements">example component requirements</a> and  <a class="reference internal" href="#example-component-cmakelists">example component CMakeLists</a> for more complete component <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> examples.</p>
</section>
<section id="preset-component-variables">
<span id="id2"></span><h3>Preset Component Variables<a class="headerlink" href="#preset-component-variables" title="Permalink to this heading"></a></h3>
<p>The following component-specific variables are available for use inside component CMakeLists, but should not be modified:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">COMPONENT_DIR</span></code>: The component directory. Evaluates to the absolute path of the directory containing <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>. The component path cannot contain spaces. This is the same as the <code class="docutils literal notranslate"><span class="pre">CMAKE_CURRENT_SOURCE_DIR</span></code> variable.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COMPONENT_NAME</span></code>: Name of the component. Same as the name of the component directory.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COMPONENT_ALIAS</span></code>: Alias of the library created internally by the build system for the component.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COMPONENT_LIB</span></code>: Name of the library created internally by the build system for the component.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COMPONENT_VERSION</span></code>: Component version specified by idf_component.yml and set by IDF Component Manager.</p></li>
</ul>
<p>The following variables are set at the project level, but available for use in component CMakeLists:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_*</span></code>: Each value in the project configuration has a corresponding variable available in cmake. All names begin with <code class="docutils literal notranslate"><span class="pre">CONFIG_</span></code>. <a class="reference internal" href="../api-reference/kconfig.html"><span class="doc">More information here</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ESP_PLATFORM</span></code>: Set to 1 when the CMake file is processed within the ESP-IDF build system.</p></li>
</ul>
</section>
<section id="build-project-variables">
<h3>Build/Project Variables<a class="headerlink" href="#build-project-variables" title="Permalink to this heading"></a></h3>
<p>The following are some project/build variables that are available as build properties and whose values can be queried using <code class="docutils literal notranslate"><span class="pre">idf_build_get_property</span></code> from the component CMakeLists.txt:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PROJECT_NAME</span></code>: Name of the project, as set in project CMakeLists.txt file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PROJECT_DIR</span></code>: Absolute path of the project directory containing the project CMakeLists. Same as the <code class="docutils literal notranslate"><span class="pre">CMAKE_SOURCE_DIR</span></code> variable.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COMPONENTS</span></code>: Names of all components that are included in this build, formatted as a semicolon-delimited CMake list.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IDF_VER</span></code>: Git version of ESP-IDF (produced by <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">describe</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IDF_VERSION_MAJOR</span></code>, <code class="docutils literal notranslate"><span class="pre">IDF_VERSION_MINOR</span></code>, <code class="docutils literal notranslate"><span class="pre">IDF_VERSION_PATCH</span></code>: Components of ESP-IDF version, to be used in conditional expressions. Note that this information is less precise than that provided by <code class="docutils literal notranslate"><span class="pre">IDF_VER</span></code> variable. <code class="docutils literal notranslate"><span class="pre">v4.0-dev-*</span></code>, <code class="docutils literal notranslate"><span class="pre">v4.0-beta1</span></code>, <code class="docutils literal notranslate"><span class="pre">v4.0-rc1</span></code> and <code class="docutils literal notranslate"><span class="pre">v4.0</span></code> will all have the same values of <code class="docutils literal notranslate"><span class="pre">IDF_VERSION_*</span></code> variables, but different <code class="docutils literal notranslate"><span class="pre">IDF_VER</span></code> values.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IDF_TARGET</span></code>: Name of the target for which the project is being built.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PROJECT_VER</span></code>: Project version.</p>
<ul>
<li><p>If <a class="reference internal" href="../api-reference/kconfig.html#config-app-project-ver-from-config"><span class="std std-ref">CONFIG_APP_PROJECT_VER_FROM_CONFIG</span></a> option is set, the value of <a class="reference internal" href="../api-reference/kconfig.html#config-app-project-ver"><span class="std std-ref">CONFIG_APP_PROJECT_VER</span></a> will be used.</p></li>
<li><p>Else, if <code class="docutils literal notranslate"><span class="pre">PROJECT_VER</span></code> variable is set in project CMakeLists.txt file, its value will be used.</p></li>
<li><p>Else, if the <code class="docutils literal notranslate"><span class="pre">PROJECT_DIR/version.txt</span></code> exists, its contents will be used as <code class="docutils literal notranslate"><span class="pre">PROJECT_VER</span></code>.</p></li>
<li><p>Else, if <code class="docutils literal notranslate"><span class="pre">VERSION</span></code> argument is passed to the <code class="docutils literal notranslate"><span class="pre">project()</span></code> call in the CMakeLists.txt file as <code class="docutils literal notranslate"><span class="pre">project(...</span> <span class="pre">VERSION</span> <span class="pre">x.y.z.w</span> <span class="pre">)</span></code> then it will be used as <code class="docutils literal notranslate"><span class="pre">PROJECT_VER</span></code>. The <code class="docutils literal notranslate"><span class="pre">VERSION</span></code> argument must be compliant with the <a class="reference external" href="https://cmake.org/cmake/help/v3.16/command/project.html">cmake standard</a>.</p></li>
<li><p>Else, if the project is located inside a Git repository, the output of git description will be used.</p></li>
<li><p>Otherwise, <code class="docutils literal notranslate"><span class="pre">PROJECT_VER</span></code> will be &quot;1&quot;.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">EXTRA_PARTITION_SUBTYPES</span></code>: CMake list of extra partition subtypes. Each subtype description is a comma-separated string with <code class="docutils literal notranslate"><span class="pre">type_name,</span> <span class="pre">subtype_name,</span> <span class="pre">numeric_value</span></code> format. Components may add new subtypes by appending them to this list.</p></li>
</ul>
<p>Other build properties are listed <a class="reference internal" href="#cmake-build-properties"><span class="std std-ref">here</span></a>.</p>
</section>
<section id="controlling-component-compilation">
<span id="component-build-control"></span><h3>Controlling Component Compilation<a class="headerlink" href="#controlling-component-compilation" title="Permalink to this heading"></a></h3>
<p>To pass compiler options when compiling source files belonging to a particular component, use the <a class="reference external" href="https://cmake.org/cmake/help/v3.16/command/target_compile_options.html">target_compile_options</a> function:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">target_compile_options</span><span class="p">(</span><span class="o">${</span><span class="nv">COMPONENT_LIB</span><span class="o">}</span><span class="w"> </span><span class="s">PRIVATE</span><span class="w"> </span><span class="s">-Wno-unused-variable</span><span class="p">)</span>
</pre></div>
</div>
<p>To apply the compilation flags to a single source file, use the CMake <a class="reference external" href="https://cmake.org/cmake/help/v3.16/command/set_source_files_properties.html">set_source_files_properties</a> command:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">set_source_files_properties</span><span class="p">(</span><span class="s">mysrc.c</span>
<span class="w">    </span><span class="s">PROPERTIES</span><span class="w"> </span><span class="s">COMPILE_FLAGS</span>
<span class="w">    </span><span class="s">-Wno-unused-variable</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This can be useful if there is upstream code that emits warnings.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>CMake <a class="reference external" href="https://cmake.org/cmake/help/v3.16/command/set_source_files_properties.html">set_source_files_properties</a> command is not applicable when the source files have been populated with help of the <code class="docutils literal notranslate"><span class="pre">SRC_DIRS</span></code> variable in <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code>. See <a class="reference internal" href="#cmake-file-globbing"><span class="std std-ref">File Globbing &amp; Incremental Builds</span></a> for more details.</p>
</div>
<p>When using these commands, place them after the call to <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code> in the component CMakeLists file.</p>
</section>
</section>
<section id="component-configuration">
<span id="id3"></span><h2>Component Configuration<a class="headerlink" href="#component-configuration" title="Permalink to this heading"></a></h2>
<p>Each component can also have a <code class="docutils literal notranslate"><span class="pre">Kconfig</span></code> file, alongside <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>. This contains configuration settings to add to the configuration menu for this component.</p>
<p>These settings are found under the &quot;Component Settings&quot; menu when menuconfig is run.</p>
<p>To create a component Kconfig file, it is easiest to start with one of the Kconfig files distributed with ESP-IDF.</p>
<p>For an example, see <a class="reference internal" href="#adding-conditional-configuration">Adding conditional configuration</a>.</p>
</section>
<section id="preprocessor-definitions">
<h2>Preprocessor Definitions<a class="headerlink" href="#preprocessor-definitions" title="Permalink to this heading"></a></h2>
<p>The ESP-IDF build system adds the following C preprocessor definitions on the command line:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ESP_PLATFORM</span></code> : Can be used to detect that build happens within ESP-IDF.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IDF_VER</span></code> : Defined to a git version string.  E.g. <code class="docutils literal notranslate"><span class="pre">v2.0</span></code> for a tagged release or <code class="docutils literal notranslate"><span class="pre">v1.0-275-g0efaa4f</span></code> for an arbitrary commit.</p></li>
</ul>
</section>
<section id="component-requirements">
<span id="id4"></span><h2>Component Requirements<a class="headerlink" href="#component-requirements" title="Permalink to this heading"></a></h2>
<p>When compiling each component, the ESP-IDF build system recursively evaluates its dependencies. This means each component needs to declare the components that it depends on (&quot;requires&quot;).</p>
<section id="when-writing-a-component">
<h3>When Writing a Component<a class="headerlink" href="#when-writing-a-component" title="Permalink to this heading"></a></h3>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">idf_component_register</span><span class="p">(</span><span class="s">...</span>
<span class="w">                       </span><span class="s">REQUIRES</span><span class="w"> </span><span class="s">mbedtls</span>
<span class="w">                       </span><span class="s">PRIV_REQUIRES</span><span class="w"> </span><span class="s">console</span><span class="w"> </span><span class="s">spiffs</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">REQUIRES</span></code> should be set to all components whose header files are #included from the <em>public</em> header files of this component.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PRIV_REQUIRES</span></code> should be set to all components whose header files are #included from <em>any source files</em> in this component, unless already listed in <code class="docutils literal notranslate"><span class="pre">REQUIRES</span></code>. Also, any component which is required to be linked in order for this component to function correctly.</p></li>
<li><p>The values of <code class="docutils literal notranslate"><span class="pre">REQUIRES</span></code> and <code class="docutils literal notranslate"><span class="pre">PRIV_REQUIRES</span></code> should not depend on any configuration choices (<code class="docutils literal notranslate"><span class="pre">CONFIG_xxx</span></code> macros). This is because requirements are expanded before the configuration is loaded. Other component variables (like include paths or source files) can depend on configuration choices.</p></li>
<li><p>Not setting either or both <code class="docutils literal notranslate"><span class="pre">REQUIRES</span></code> variables is fine. If the component has no requirements except for the <a class="reference internal" href="#common-component-requirements">Common component requirements</a> needed for RTOS, libc, etc.</p></li>
</ul>
<p>If a component only supports some target chips (values of <code class="docutils literal notranslate"><span class="pre">IDF_TARGET</span></code>) then it can specify <code class="docutils literal notranslate"><span class="pre">REQUIRED_IDF_TARGETS</span></code> in the <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code> call to express these requirements. In this case, the build system will generate an error if the component is included in the build, but does not support the selected target.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In CMake terms, <code class="docutils literal notranslate"><span class="pre">REQUIRES</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">PRIV_REQUIRES</span></code> are approximate wrappers around the CMake functions <code class="docutils literal notranslate"><span class="pre">target_link_libraries(...</span> <span class="pre">PUBLIC</span> <span class="pre">...)</span></code> and <code class="docutils literal notranslate"><span class="pre">target_link_libraries(...</span> <span class="pre">PRIVATE</span> <span class="pre">...)</span></code>.</p>
</div>
</section>
<section id="example-of-component-requirements">
<span id="example-component-requirements"></span><h3>Example of Component Requirements<a class="headerlink" href="#example-of-component-requirements" title="Permalink to this heading"></a></h3>
<p>Imagine there is a <code class="docutils literal notranslate"><span class="pre">car</span></code> component, which uses the <code class="docutils literal notranslate"><span class="pre">engine</span></code> component, which uses the <code class="docutils literal notranslate"><span class="pre">spark_plug</span></code> component:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>- autoProject/
             - CMakeLists.txt
             - components/ - car/ - CMakeLists.txt
                                     - car.c
                                     - car.h
                           - engine/ - CMakeLists.txt
                                     - engine.c
                                     - include/ - engine.h
                           - spark_plug/  - CMakeLists.txt
                                          - spark_plug.c
                                          - spark_plug.h
</pre></div>
</div>
<section id="car-component">
<h4>Car Component<a class="headerlink" href="#car-component" title="Permalink to this heading"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">car.h</span></code> header file is the public interface for the <code class="docutils literal notranslate"><span class="pre">car</span></code> component. This header includes <code class="docutils literal notranslate"><span class="pre">engine.h</span></code> directly because it uses some declarations from this header:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* car.h */</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;engine.h&quot;</span>

<span class="cp">#ifdef ENGINE_IS_HYBRID</span>
<span class="cp">#define CAR_MODEL &quot;Hybrid&quot;</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>And car.c includes <code class="docutils literal notranslate"><span class="pre">car.h</span></code> as well:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* car.c */</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;car.h&quot;</span>
</pre></div>
</div>
<p>This means the <code class="docutils literal notranslate"><span class="pre">car/CMakeLists.txt</span></code> file needs to declare that <code class="docutils literal notranslate"><span class="pre">car</span></code> requires <code class="docutils literal notranslate"><span class="pre">engine</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">idf_component_register</span><span class="p">(</span><span class="s">SRCS</span><span class="w"> </span><span class="s2">&quot;car.c&quot;</span>
<span class="w">                  </span><span class="s">INCLUDE_DIRS</span><span class="w"> </span><span class="s2">&quot;.&quot;</span>
<span class="w">                  </span><span class="s">REQUIRES</span><span class="w"> </span><span class="s">engine</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SRCS</span></code> gives the list of source files in the <code class="docutils literal notranslate"><span class="pre">car</span></code> component.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">INCLUDE_DIRS</span></code> gives the list of public include directories for this component. Because the public interface is <code class="docutils literal notranslate"><span class="pre">car.h</span></code>, the directory containing <code class="docutils literal notranslate"><span class="pre">car.h</span></code> is listed here.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">REQUIRES</span></code> gives the list of components required by the public interface of this component. Because <code class="docutils literal notranslate"><span class="pre">car.h</span></code> is a public header and includes a header from <code class="docutils literal notranslate"><span class="pre">engine</span></code>, we include <code class="docutils literal notranslate"><span class="pre">engine</span></code> here. This makes sure that any other component which includes <code class="docutils literal notranslate"><span class="pre">car.h</span></code> will be able to recursively include the required <code class="docutils literal notranslate"><span class="pre">engine.h</span></code> also.</p></li>
</ul>
</section>
<section id="engine-component">
<h4>Engine Component<a class="headerlink" href="#engine-component" title="Permalink to this heading"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">engine</span></code> component also has a public header file <code class="docutils literal notranslate"><span class="pre">include/engine.h</span></code>, but this header is simpler:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* engine.h */</span>
<span class="cp">#define ENGINE_IS_HYBRID</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">engine_start</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</pre></div>
</div>
<p>The implementation is in <code class="docutils literal notranslate"><span class="pre">engine.c</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* engine.c */</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;engine.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;spark_plug.h&quot;</span>

<span class="p">...</span>
</pre></div>
</div>
<p>In this component, <code class="docutils literal notranslate"><span class="pre">engine</span></code> depends on <code class="docutils literal notranslate"><span class="pre">spark_plug</span></code> but this is a private dependency. <code class="docutils literal notranslate"><span class="pre">spark_plug.h</span></code> is needed to compile <code class="docutils literal notranslate"><span class="pre">engine.c</span></code>, but not needed to include <code class="docutils literal notranslate"><span class="pre">engine.h</span></code>.</p>
<p>This means that the <code class="docutils literal notranslate"><span class="pre">engine/CMakeLists.txt</span></code> file can use <code class="docutils literal notranslate"><span class="pre">PRIV_REQUIRES</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">idf_component_register</span><span class="p">(</span><span class="s">SRCS</span><span class="w"> </span><span class="s2">&quot;engine.c&quot;</span>
<span class="w">                  </span><span class="s">INCLUDE_DIRS</span><span class="w"> </span><span class="s2">&quot;include&quot;</span>
<span class="w">                  </span><span class="s">PRIV_REQUIRES</span><span class="w"> </span><span class="s">spark_plug</span><span class="p">)</span>
</pre></div>
</div>
<p>As a result, source files in the <code class="docutils literal notranslate"><span class="pre">car</span></code> component don't need the <code class="docutils literal notranslate"><span class="pre">spark_plug</span></code> include directories added to their compiler search path. This can speed up compilation, and stops compiler command lines from becoming longer than necessary.</p>
</section>
<section id="spark-plug-component">
<h4>Spark Plug Component<a class="headerlink" href="#spark-plug-component" title="Permalink to this heading"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">spark_plug</span></code> component doesn't depend on anything else. It has a public header file <code class="docutils literal notranslate"><span class="pre">spark_plug.h</span></code>, but this doesn't include headers from any other components.</p>
<p>This means that the <code class="docutils literal notranslate"><span class="pre">spark_plug/CMakeLists.txt</span></code> file doesn't need any <code class="docutils literal notranslate"><span class="pre">REQUIRES</span></code> or <code class="docutils literal notranslate"><span class="pre">PRIV_REQUIRES</span></code> clauses:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">idf_component_register</span><span class="p">(</span><span class="s">SRCS</span><span class="w"> </span><span class="s2">&quot;spark_plug.c&quot;</span>
<span class="w">                  </span><span class="s">INCLUDE_DIRS</span><span class="w"> </span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="source-file-include-directories">
<h3>Source File Include Directories<a class="headerlink" href="#source-file-include-directories" title="Permalink to this heading"></a></h3>
<p>Each component's source file is compiled with these include path directories, as specified in the passed arguments to <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">idf_component_register</span><span class="p">(</span><span class="s">..</span>
<span class="w">                       </span><span class="s">INCLUDE_DIRS</span><span class="w"> </span><span class="s2">&quot;include&quot;</span>
<span class="w">                       </span><span class="s">PRIV_INCLUDE_DIRS</span><span class="w"> </span><span class="s2">&quot;other&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The current component's <code class="docutils literal notranslate"><span class="pre">INCLUDE_DIRS</span></code> and <code class="docutils literal notranslate"><span class="pre">PRIV_INCLUDE_DIRS</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">INCLUDE_DIRS</span></code> belonging to all other components listed in the <code class="docutils literal notranslate"><span class="pre">REQUIRES</span></code> and <code class="docutils literal notranslate"><span class="pre">PRIV_REQUIRES</span></code> parameters (ie all the current component's public and private dependencies).</p></li>
<li><p>Recursively, all of the <code class="docutils literal notranslate"><span class="pre">INCLUDE_DIRS</span></code> of those components <code class="docutils literal notranslate"><span class="pre">REQUIRES</span></code> lists (ie all public dependencies of this component's dependencies, recursively expanded).</p></li>
</ul>
</section>
<section id="main-component-requirements">
<h3>Main Component Requirements<a class="headerlink" href="#main-component-requirements" title="Permalink to this heading"></a></h3>
<p>The component named <code class="docutils literal notranslate"><span class="pre">main</span></code> is special because it automatically requires all other components in the build. So it's not necessary to pass <code class="docutils literal notranslate"><span class="pre">REQUIRES</span></code> or <code class="docutils literal notranslate"><span class="pre">PRIV_REQUIRES</span></code> to this component. See <a class="reference internal" href="#rename-main"><span class="std std-ref">renaming main</span></a> for a description of what needs to be changed if no longer using the <code class="docutils literal notranslate"><span class="pre">main</span></code> component.</p>
</section>
<section id="common-component-requirements">
<span id="component-common-requirements"></span><h3>Common Component Requirements<a class="headerlink" href="#common-component-requirements" title="Permalink to this heading"></a></h3>
<p>To avoid duplication, every component automatically requires some &quot;common&quot; IDF components even if they are not mentioned explicitly. Headers from these components can always be included.</p>
<p>The list of common components is: cxx, newlib, freertos, esp_hw_support, heap, log, soc, hal, esp_rom, esp_common, esp_system, xtensa/riscv.</p>
</section>
<section id="including-components-in-the-build">
<h3>Including Components in the Build<a class="headerlink" href="#including-components-in-the-build" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>By default, every component is included in the build.</p></li>
<li><p>If you set the <code class="docutils literal notranslate"><span class="pre">COMPONENTS</span></code> variable to a minimal list of components used directly by your project, then the build will expand to also include required components. The full list of components will be:</p>
<ul>
<li><p>Components mentioned explicitly in <code class="docutils literal notranslate"><span class="pre">COMPONENTS</span></code>.</p></li>
<li><p>Those components' requirements (evaluated recursively).</p></li>
<li><p>The &quot;common&quot; components that every component depends on.</p></li>
</ul>
</li>
<li><p>Setting <code class="docutils literal notranslate"><span class="pre">COMPONENTS</span></code> to the minimal list of required components can significantly reduce compile times.</p></li>
</ul>
</section>
<section id="circular-dependencies">
<span id="component-circular-dependencies"></span><h3>Circular Dependencies<a class="headerlink" href="#circular-dependencies" title="Permalink to this heading"></a></h3>
<p>It's possible for a project to contain Component A that requires (<code class="docutils literal notranslate"><span class="pre">REQUIRES</span></code> or <code class="docutils literal notranslate"><span class="pre">PRIV_REQUIRES</span></code>) Component B, and Component B that requires Component A. This is known as a dependency cycle or a circular dependency.</p>
<p>CMake will usually handle circular dependencies automatically by repeating the component library names twice on the linker command line. However this strategy doesn't always work, and the build may fail with a linker error about &quot;Undefined reference to ...&quot;, referencing a symbol defined by one of the components inside the circular dependency. This is particularly likely if there is a large circular dependency, i.e., A &gt; B &gt; C &gt; D &gt; A.</p>
<p>The best solution is to restructure the components to remove the circular dependency. In most cases, a software architecture without circular dependencies has desirable properties of modularity and clean layering and will be more maintainable in the long term. However, removing circular dependencies is not always possible.</p>
<p>To bypass a linker error caused by a circular dependency, the simplest workaround is to increase the CMake <a class="reference external" href="https://cmake.org/cmake/help/v3.16/prop_tgt/LINK_INTERFACE_MULTIPLICITY.html">LINK_INTERFACE_MULTIPLICITY</a> property of one of the component libraries. This causes CMake to repeat this library and its dependencies more than two times on the linker command line.</p>
<p>For example:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">set_property</span><span class="p">(</span><span class="s">TARGET</span><span class="w"> </span><span class="o">${</span><span class="nv">COMPONENT_LIB</span><span class="o">}</span><span class="w"> </span><span class="s">APPEND</span><span class="w"> </span><span class="s">PROPERTY</span><span class="w"> </span><span class="s">LINK_INTERFACE_MULTIPLICITY</span><span class="w"> </span><span class="s">3</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>This line should be placed after <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code> in the component CMakeLists.txt file.</p></li>
<li><p>If possible, place this line in the component that creates the circular dependency by depending on a lot of other components. However, the line can be placed inside any component that is part of the cycle. Choosing the component that owns the source file shown in the linker error message, or the component that defines the symbol(s) mentioned in the linker error message, is a good place to start.</p></li>
<li><p>Usually increasing the value to 3 (default is 2) is enough, but if this doesn't work then try increasing the number further.</p></li>
<li><p>Adding this option will make the linker command line longer, and the linking stage slower.</p></li>
</ul>
<section id="advanced-workaround-undefined-symbols">
<h4>Advanced Workaround: Undefined Symbols<a class="headerlink" href="#advanced-workaround-undefined-symbols" title="Permalink to this heading"></a></h4>
<p>If only one or two symbols are causing a circular dependency, and all other dependencies are linear, then there is an alternative method to avoid linker errors: Specify the specific symbols required for the &quot;reverse&quot; dependency as undefined symbols at link time.</p>
<p>For example, if component A depends on component B but component B also needs to reference <code class="docutils literal notranslate"><span class="pre">reverse_ops</span></code> from component A (but nothing else), then you can add a line like the following to the component B CMakeLists.txt to resolve the cycle at link time:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># This symbol is provided by &#39;Component A&#39; at link time</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="o">${</span><span class="nv">COMPONENT_LIB</span><span class="o">}</span><span class="w"> </span><span class="s">INTERFACE</span><span class="w"> </span><span class="s2">&quot;-u reverse_ops&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">-u</span></code> argument means that the linker will always include this symbol in the link, regardless of dependency ordering.</p></li>
<li><p>This line should be placed after <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code> in the component CMakeLists.txt file.</p></li>
<li><p>If 'Component B' doesn't need to access any headers of 'Component A', only link to a few symbol(s), then this line can be used instead of any <code class="docutils literal notranslate"><span class="pre">REQUIRES</span></code> from B to A. This further simplifies the component structure in the build system.</p></li>
</ul>
<p>See the <a class="reference external" href="https://cmake.org/cmake/help/v3.16/command/target_link_libraries.html#command:target_link_libraries">target_link_libraries</a> documentation for more information about this CMake function.</p>
</section>
</section>
<section id="requirements-in-the-build-system-implementation">
<span id="component-requirements-implementation"></span><h3>Requirements in the Build System Implementation<a class="headerlink" href="#requirements-in-the-build-system-implementation" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Very early in the CMake configuration process, the script <code class="docutils literal notranslate"><span class="pre">expand_requirements.cmake</span></code> is run. This script does a partial evaluation of all component CMakeLists.txt files and builds a graph of component requirements (this <a class="reference internal" href="#component-circular-dependencies"><span class="std std-ref">graph may have cycles</span></a>). The graph is used to generate a file <code class="docutils literal notranslate"><span class="pre">component_depends.cmake</span></code> in the build directory.</p></li>
<li><p>The main CMake process then includes this file and uses it to determine the list of components to include in the build (internal <code class="docutils literal notranslate"><span class="pre">BUILD_COMPONENTS</span></code> variable). The <code class="docutils literal notranslate"><span class="pre">BUILD_COMPONENTS</span></code> variable is sorted so dependencies are listed first, however, as the component dependency graph has cycles this cannot be guaranteed for all components. The order should be deterministic given the same set of components and component dependencies.</p></li>
<li><p>The value of <code class="docutils literal notranslate"><span class="pre">BUILD_COMPONENTS</span></code> is logged by CMake as &quot;Component names: &quot;</p></li>
<li><p>Configuration is then evaluated for the components included in the build.</p></li>
<li><p>Each component is included in the build normally and the CMakeLists.txt file is evaluated again to add the component libraries to the build.</p></li>
</ul>
<section id="component-dependency-order">
<h4>Component Dependency Order<a class="headerlink" href="#component-dependency-order" title="Permalink to this heading"></a></h4>
<p>The order of components in the <code class="docutils literal notranslate"><span class="pre">BUILD_COMPONENTS</span></code> variable determines other orderings during the build:</p>
<ul class="simple">
<li><p>Order that <a class="reference internal" href="#project-include-cmake"><span class="std std-ref">Project_include.cmake</span></a> files are included in the project.</p></li>
<li><p>Order that the list of header paths is generated for compilation (via <code class="docutils literal notranslate"><span class="pre">-I</span></code> argument). (Note that for a given component's source files, only that component's dependency's header paths are passed to the compiler.)</p></li>
</ul>
</section>
<section id="adding-link-time-dependencies">
<h4>Adding Link-Time Dependencies<a class="headerlink" href="#adding-link-time-dependencies" title="Permalink to this heading"></a></h4>
<p>The ESP-IDF CMake helper function <code class="docutils literal notranslate"><span class="pre">idf_component_add_link_dependency</span></code> adds a link-only dependency between one component and another. In almost all cases, it is better to use the <code class="docutils literal notranslate"><span class="pre">PRIV_REQUIRES</span></code> feature in <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code> to create a dependency. However, in some cases, it's necessary to add the link-time dependency of another component to this component, i.e., the reverse order to <code class="docutils literal notranslate"><span class="pre">PRIV_REQUIRES</span></code> (for example: <a class="reference internal" href="../api-reference/peripherals/spi_flash/spi_flash_override_driver.html"><span class="doc">Overriding Default Chip Drivers</span></a>).</p>
<p>To make another component depend on this component at link time:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">idf_component_add_link_dependency</span><span class="p">(</span><span class="s">FROM</span><span class="w"> </span><span class="s">other_component</span><span class="p">)</span>
</pre></div>
</div>
<p>Place this line after the line with <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code>.</p>
<p>It's also possible to specify both components by name:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">idf_component_add_link_dependency</span><span class="p">(</span><span class="s">FROM</span><span class="w"> </span><span class="s">other_component</span><span class="w"> </span><span class="s">TO</span><span class="w"> </span><span class="s">that_component</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="overriding-parts-of-the-project">
<span id="override-project-config"></span><h2>Overriding Parts of the Project<a class="headerlink" href="#overriding-parts-of-the-project" title="Permalink to this heading"></a></h2>
<section id="project-include-cmake">
<span id="id5"></span><h3>Project_include.cmake<a class="headerlink" href="#project-include-cmake" title="Permalink to this heading"></a></h3>
<p>For components that have build requirements that must be evaluated before any component CMakeLists files are evaluated, you can create a file called <code class="docutils literal notranslate"><span class="pre">project_include.cmake</span></code> in the component directory. This CMake file is included when <code class="docutils literal notranslate"><span class="pre">project.cmake</span></code> is evaluating the entire project.</p>
<p><code class="docutils literal notranslate"><span class="pre">project_include.cmake</span></code> files are used inside ESP-IDF, for defining project-wide build features such as <code class="docutils literal notranslate"><span class="pre">esptool.py</span></code> command line arguments and the <code class="docutils literal notranslate"><span class="pre">bootloader</span></code> &quot;special app&quot;.</p>
<p>Unlike component <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> files, when including a <code class="docutils literal notranslate"><span class="pre">project_include.cmake</span></code> file the current source directory (<code class="docutils literal notranslate"><span class="pre">CMAKE_CURRENT_SOURCE_DIR</span></code> and working directory) is the project directory. Use the variable <code class="docutils literal notranslate"><span class="pre">COMPONENT_DIR</span></code> for the absolute directory of the component.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">project_include.cmake</span></code> isn't necessary for the most common component uses, such as adding include directories to the project, or <code class="docutils literal notranslate"><span class="pre">LDFLAGS</span></code> to the final linking step. These values can be customized via the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file itself. See <a class="reference internal" href="#optional-project-variables">Optional Project Variables</a> for details.</p>
<p><code class="docutils literal notranslate"><span class="pre">project_include.cmake</span></code> files are included in the order given in <code class="docutils literal notranslate"><span class="pre">BUILD_COMPONENTS</span></code> variable (as logged by CMake). This means that a component's <code class="docutils literal notranslate"><span class="pre">project_include.cmake</span></code> file will be included after it's all dependencies' <code class="docutils literal notranslate"><span class="pre">project_include.cmake</span></code> files, unless both components are part of a dependency cycle. This is important if a <code class="docutils literal notranslate"><span class="pre">project_include.cmake</span></code> file relies on variables set by another component. See also <a class="reference internal" href="#component-requirements-implementation"><span class="std std-ref">above</span></a>.</p>
<p>Take great care when setting variables or targets in a <code class="docutils literal notranslate"><span class="pre">project_include.cmake</span></code> file. As the values are included in the top-level project CMake pass, they can influence or break functionality across all components!</p>
</section>
<section id="kconfig-projbuild">
<h3>KConfig.projbuild<a class="headerlink" href="#kconfig-projbuild" title="Permalink to this heading"></a></h3>
<p>This is an equivalent to <code class="docutils literal notranslate"><span class="pre">project_include.cmake</span></code> for <a class="reference internal" href="#component-configuration"><span class="std std-ref">Component Configuration</span></a> KConfig files. If you want to include configuration options at the top level of menuconfig, rather than inside the &quot;Component Configuration&quot; sub-menu, then these can be defined in the KConfig.projbuild file alongside the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file.</p>
<p>Take care when adding configuration values in this file, as they will be included across the entire project configuration. Where possible, it's generally better to create a KConfig file for <a class="reference internal" href="#component-configuration"><span class="std std-ref">Component Configuration</span></a>.</p>
</section>
<section id="wrappers-to-redefine-or-extend-existing-functions">
<h3>Wrappers to Redefine or Extend Existing Functions<a class="headerlink" href="#wrappers-to-redefine-or-extend-existing-functions" title="Permalink to this heading"></a></h3>
<p>Thanks to the linker's wrap feature, it is possible to redefine or extend the behavior of an existing ESP-IDF function. To do so, you will need to provide the following CMake declaration in your project's <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">target_link_libraries</span><span class="p">(</span><span class="o">${</span><span class="nv">COMPONENT_LIB</span><span class="o">}</span><span class="w"> </span><span class="s">INTERFACE</span><span class="w"> </span><span class="s2">&quot;-Wl,--wrap=function_to_redefine&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">function_to_redefine</span></code> is the name of the function to redefine or extend. This option will let the linker replace all the calls to <code class="docutils literal notranslate"><span class="pre">function_to_redefine</span></code> functions in the binary libraries with calls to <code class="docutils literal notranslate"><span class="pre">__wrap_function_to_redefine</span></code> function. Thus, you must define this new symbol in your application.</p>
<p>The linker will provide a new symbol named <code class="docutils literal notranslate"><span class="pre">__real_function_to_redefine</span></code> which points to the former implementation of the function to redefine. It can be called from the new implementation, making it an extension of the former one.</p>
<p>This mechanism is shown in the example <a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/examples/build_system/wrappers">build_system/wrappers</a>. Check <a class="reference external" href="https://github.com/espressif/esp-idf/blob/v5.4.2/examples/build_system/wrappers/README.md">examples/build_system/wrappers/README.md</a> for more details.</p>
</section>
<section id="override-the-default-bootloader">
<h3>Override the Default Bootloader<a class="headerlink" href="#override-the-default-bootloader" title="Permalink to this heading"></a></h3>
<p>Thanks to the optional <code class="docutils literal notranslate"><span class="pre">bootloader_components</span></code> directory present in your ESP-IDf project, it is possible to override the default ESP-IDF bootloader. To do so, a new <code class="docutils literal notranslate"><span class="pre">bootloader_components/main</span></code> component should be defined, which will make the project directory tree look like the following:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>myProject/</dt><dd><ul>
<li><p>CMakeLists.txt</p></li>
<li><p>sdkconfig</p></li>
<li><dl class="simple">
<dt>bootloader_components/ - main/ - CMakeLists.txt</dt><dd><ul>
<li><p>Kconfig</p></li>
<li><p>my_bootloader.c</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>main/       - CMakeLists.txt</dt><dd><ul>
<li><p>app_main.c</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>build/</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p>Here the <code class="docutils literal notranslate"><span class="pre">my_bootloader.c</span></code> file becomes source code for the new bootloader, which means that it will need to perform all the required operations to set up and load the <code class="docutils literal notranslate"><span class="pre">main</span></code> application from flash.</p>
<p>It is also possible to conditionally replace the bootloader depending on a certain condition, such as the target for example. This can be achieved thanks to the <code class="docutils literal notranslate"><span class="pre">BOOTLOADER_IGNORE_EXTRA_COMPONENT</span></code> CMake variable. This list can be used to tell the ESP-IDF bootloader project to ignore and not compile the given components present in <code class="docutils literal notranslate"><span class="pre">bootloader_components</span></code>. For example, if one wants to use the default bootloader for ESP32 target, then <code class="docutils literal notranslate"><span class="pre">myProject/CMakeLists.txt</span></code> should look like the following:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">include</span><span class="p">(</span><span class="o">$ENV{</span><span class="nv">IDF_PATH</span><span class="o">}</span><span class="s">/tools/cmake/project.cmake</span><span class="p">)</span>

<span class="nb">if</span><span class="p">(</span><span class="o">${</span><span class="nv">IDF_TARGET</span><span class="o">}</span><span class="w"> </span><span class="s">STREQUAL</span><span class="w"> </span><span class="s2">&quot;esp32&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nb">set</span><span class="p">(</span><span class="s">BOOTLOADER_IGNORE_EXTRA_COMPONENT</span><span class="w"> </span><span class="s2">&quot;main&quot;</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="nb">project</span><span class="p">(</span><span class="s">main</span><span class="p">)</span>
</pre></div>
</div>
<p>It is important to note that this can also be used for any other bootloader components than <code class="docutils literal notranslate"><span class="pre">main</span></code>. In all cases, the prefix <code class="docutils literal notranslate"><span class="pre">bootloader_component</span></code> must not be specified.</p>
<p>See <a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/examples/custom_bootloader/bootloader_override">custom_bootloader/bootloader_override</a> for an example of overriding the default bootloader.</p>
</section>
</section>
<section id="configuration-only-components">
<span id="config-only-component"></span><h2>Configuration-Only Components<a class="headerlink" href="#configuration-only-components" title="Permalink to this heading"></a></h2>
<p>Special components which contain no source files, only <code class="docutils literal notranslate"><span class="pre">Kconfig.projbuild</span></code> and <code class="docutils literal notranslate"><span class="pre">KConfig</span></code>, can have a one-line <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file which calls the function <code class="docutils literal notranslate"><span class="pre">idf_component_register()</span></code> with no arguments specified. This function will include the component in the project build, but no library will be built <em>and</em> no header files will be added to any included paths.</p>
</section>
<section id="debugging-cmake">
<h2>Debugging CMake<a class="headerlink" href="#debugging-cmake" title="Permalink to this heading"></a></h2>
<p>For full details about <a class="reference external" href="https://cmake.org">CMake</a> and CMake commands, see the <a class="reference external" href="https://cmake.org/cmake/help/v3.16/index.html">CMake v3.16 documentation</a>.</p>
<p>Some tips for debugging the ESP-IDF CMake-based build system:</p>
<ul class="simple">
<li><p>When CMake runs, it prints quite a lot of diagnostic information including lists of components and component paths.</p></li>
<li><p>Running <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-DDEBUG=1</span></code> will produce more verbose diagnostic output from the IDF build system.</p></li>
<li><p>Running <code class="docutils literal notranslate"><span class="pre">cmake</span></code> with the <code class="docutils literal notranslate"><span class="pre">--trace</span></code> or <code class="docutils literal notranslate"><span class="pre">--trace-expand</span></code> options will give a lot of information about control flow. See the <a class="reference external" href="https://cmake.org/cmake/help/v3.16/manual/cmake.1.html#options">cmake command line documentation</a>.</p></li>
</ul>
<p>When included from a project CMakeLists file, the <code class="docutils literal notranslate"><span class="pre">project.cmake</span></code> file defines some utility modules and global variables and then sets <code class="docutils literal notranslate"><span class="pre">IDF_PATH</span></code> if it was not set in the system environment.</p>
<p>It also defines an overridden custom version of the built-in <a class="reference external" href="https://cmake.org">CMake</a> <code class="docutils literal notranslate"><span class="pre">project</span></code> function. This function is overridden to add all of the ESP-IDF specific project functionality.</p>
<section id="warning-on-undefined-variables">
<span id="warn-undefined-variables"></span><h3>Warning On Undefined Variables<a class="headerlink" href="#warning-on-undefined-variables" title="Permalink to this heading"></a></h3>
<p>By default, the function of warnings on undefined variables is disabled.</p>
<p>To enable this function, we can pass the <code class="docutils literal notranslate"><span class="pre">--warn-uninitialized</span></code> flag to <a class="reference external" href="https://cmake.org">CMake</a> or pass the <code class="docutils literal notranslate"><span class="pre">--cmake-warn-uninitialized</span></code> flag to <code class="docutils literal notranslate"><span class="pre">idf.py</span></code> so it will print a warning if an undefined variable is referenced in the build. This can be very useful to find buggy CMake files.</p>
<p>Browse the <a class="reference external" href="https://github.com/espressif/esp-idf/blob/v5.4.2/tools/cmake/project.cmake">/tools/cmake/project.cmake</a> file and supporting functions in <a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/tools/cmake/">/tools/cmake/</a> for more details.</p>
</section>
</section>
<section id="example-component-cmakelists">
<span id="component-cmakelists-example"></span><h2>Example Component CMakeLists<a class="headerlink" href="#example-component-cmakelists" title="Permalink to this heading"></a></h2>
<p>Because the build environment tries to set reasonable defaults that will work most of the time, component <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> can be very small or even empty (see <a class="reference internal" href="#minimal-component-cmakelists">Minimal Component CMakeLists</a>). However, overriding <a class="reference internal" href="#preset-component-variables">preset_component_variables</a> is usually required for some functionality.</p>
<p>Here are some more advanced examples of component CMakeLists files.</p>
<section id="adding-conditional-configuration">
<span id="add-conditional-config"></span><h3>Adding Conditional Configuration<a class="headerlink" href="#adding-conditional-configuration" title="Permalink to this heading"></a></h3>
<p>The configuration system can be used to conditionally compile some files depending on the options selected in the project configuration.</p>
<p><code class="docutils literal notranslate"><span class="pre">Kconfig</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config FOO_ENABLE_BAR
    bool &quot;Enable the BAR feature.&quot;
    help
        This enables the BAR feature of the FOO component.
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span> set(srcs &quot;foo.c&quot; &quot;more_foo.c&quot;)

 if(CONFIG_FOO_ENABLE_BAR)
     list(APPEND srcs &quot;bar.c&quot;)
 endif()

idf_component_register(SRCS &quot;${srcs}&quot;
                     ...)
</pre></div>
</div>
<p>This example makes use of the CMake <a class="reference external" href="https://cmake.org/cmake/help/v3.16/command/if.html">if</a> function and <a class="reference external" href="https://cmake.org/cmake/help/v3.16/command/list.html">list APPEND</a> function.</p>
<p>This can also be used to select or stub out an implementation, as such:</p>
<p><code class="docutils literal notranslate"><span class="pre">Kconfig</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>config ENABLE_LCD_OUTPUT
    bool &quot;Enable LCD output.&quot;
    help
        Select this if your board has an LCD.

config ENABLE_LCD_CONSOLE
    bool &quot;Output console text to LCD&quot;
    depends on ENABLE_LCD_OUTPUT
    help
        Select this to output debugging output to the LCD

config ENABLE_LCD_PLOT
    bool &quot;Output temperature plots to LCD&quot;
    depends on ENABLE_LCD_OUTPUT
    help
        Select this to output temperature plots
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">if</span><span class="p">(</span><span class="s">CONFIG_ENABLE_LCD_OUTPUT</span><span class="p">)</span>
<span class="w">   </span><span class="nb">set</span><span class="p">(</span><span class="s">srcs</span><span class="w"> </span><span class="s">lcd-real.c</span><span class="w"> </span><span class="s">lcd-spi.c</span><span class="p">)</span>
<span class="nb">else</span><span class="p">()</span>
<span class="w">   </span><span class="nb">set</span><span class="p">(</span><span class="s">srcs</span><span class="w"> </span><span class="s">lcd-dummy.c</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c"># We need font if either console or plot is enabled</span>
<span class="nb">if</span><span class="p">(</span><span class="s">CONFIG_ENABLE_LCD_CONSOLE</span><span class="w"> </span><span class="s">OR</span><span class="w"> </span><span class="s">CONFIG_ENABLE_LCD_PLOT</span><span class="p">)</span>
<span class="w">   </span><span class="nb">list</span><span class="p">(</span><span class="s">APPEND</span><span class="w"> </span><span class="s">srcs</span><span class="w"> </span><span class="s2">&quot;font.c&quot;</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="nb">idf_component_register</span><span class="p">(</span><span class="s">SRCS</span><span class="w"> </span><span class="s2">&quot;${srcs}&quot;</span>
<span class="w">                    </span><span class="s">...</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="conditions-which-depend-on-the-target">
<h3>Conditions Which Depend on the Target<a class="headerlink" href="#conditions-which-depend-on-the-target" title="Permalink to this heading"></a></h3>
<p>The current target is available to CMake files via <code class="docutils literal notranslate"><span class="pre">IDF_TARGET</span></code> variable.</p>
<p>In addition to that, if target <code class="docutils literal notranslate"><span class="pre">xyz</span></code> is used (<code class="docutils literal notranslate"><span class="pre">IDF_TARGET=xyz</span></code>), then Kconfig variable <code class="docutils literal notranslate"><span class="pre">CONFIG_IDF_TARGET_XYZ</span></code> will be set.</p>
<p>Note that component dependencies may depend on <code class="docutils literal notranslate"><span class="pre">IDF_TARGET</span></code> variable, but not on Kconfig variables. Also one can not use Kconfig variables in <code class="docutils literal notranslate"><span class="pre">include</span></code> statements in CMake files, but <code class="docutils literal notranslate"><span class="pre">IDF_TARGET</span></code> can be used in such context.</p>
</section>
<section id="source-code-generation">
<h3>Source Code Generation<a class="headerlink" href="#source-code-generation" title="Permalink to this heading"></a></h3>
<p>Some components will have a situation where a source file isn't supplied with the component itself but has to be generated from another file. Say our component has a header file that consists of the converted binary data of a BMP file, converted using a hypothetical tool called bmp2h. The header file is then included in as C source file called graphics_lib.c:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">add_custom_command</span><span class="p">(</span><span class="s">OUTPUT</span><span class="w"> </span><span class="s">logo.h</span>
<span class="w">     </span><span class="s">COMMAND</span><span class="w"> </span><span class="s">bmp2h</span><span class="w"> </span><span class="s">-i</span><span class="w"> </span><span class="o">${</span><span class="nv">COMPONENT_DIR</span><span class="o">}</span><span class="s">/logo.bmp</span><span class="w"> </span><span class="s">-o</span><span class="w"> </span><span class="s">log.h</span>
<span class="w">     </span><span class="s">DEPENDS</span><span class="w"> </span><span class="o">${</span><span class="nv">COMPONENT_DIR</span><span class="o">}</span><span class="s">/logo.bmp</span>
<span class="w">     </span><span class="s">VERBATIM</span><span class="p">)</span>

<span class="nb">add_custom_target</span><span class="p">(</span><span class="s">logo</span><span class="w"> </span><span class="s">DEPENDS</span><span class="w"> </span><span class="s">logo.h</span><span class="p">)</span>
<span class="nb">add_dependencies</span><span class="p">(</span><span class="o">${</span><span class="nv">COMPONENT_LIB</span><span class="o">}</span><span class="w"> </span><span class="s">logo</span><span class="p">)</span>

<span class="nb">set_property</span><span class="p">(</span><span class="s">DIRECTORY</span><span class="w"> </span><span class="s2">&quot;${COMPONENT_DIR}&quot;</span><span class="w"> </span><span class="s">APPEND</span><span class="w"> </span><span class="s">PROPERTY</span>
<span class="w">     </span><span class="s">ADDITIONAL_CLEAN_FILES</span><span class="w"> </span><span class="s">logo.h</span><span class="p">)</span>
</pre></div>
</div>
<p>This answer is adapted from the <a class="reference external" href="https://gitlab.kitware.com/cmake/community/-/wikis/FAQ#how-can-i-generate-a-source-file-during-the-build">CMake FAQ entry</a>, which contains some other examples that will also work with ESP-IDF builds.</p>
<p>In this example, logo.h will be generated in the current directory (the build directory) while logo.bmp comes with the component and resides under the component path. Because logo.h is a generated file, it should be cleaned when the project is cleaned. For this reason, it is added to the <a class="reference external" href="https://cmake.org/cmake/help/v3.16/prop_dir/ADDITIONAL_CLEAN_FILES.html">ADDITIONAL_CLEAN_FILES</a> property.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If generating files as part of the project CMakeLists.txt file, not a component CMakeLists.txt, then use build property <code class="docutils literal notranslate"><span class="pre">PROJECT_DIR</span></code> instead of <code class="docutils literal notranslate"><span class="pre">${COMPONENT_DIR}</span></code> and <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}.elf</span></code> instead of <code class="docutils literal notranslate"><span class="pre">${COMPONENT_LIB}</span></code>.)</p>
</div>
<p>If a a source file from another component included <code class="docutils literal notranslate"><span class="pre">logo.h</span></code>, then <code class="docutils literal notranslate"><span class="pre">add_dependencies</span></code> would need to be called to add a dependency between the two components, to ensure that the component source files were always compiled in the correct order.</p>
</section>
<section id="embedding-binary-data">
<span id="cmake-embed-data"></span><h3>Embedding Binary Data<a class="headerlink" href="#embedding-binary-data" title="Permalink to this heading"></a></h3>
<p>Sometimes you have a file with some binary or text data that you'd like to make available to your component, but you don't want to reformat the file as a C source.</p>
<p>You can specify argument <code class="docutils literal notranslate"><span class="pre">EMBED_FILES</span></code> in the component registration, giving space-delimited names of the files to embed:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">idf_component_register</span><span class="p">(</span><span class="s">...</span>
<span class="w">                       </span><span class="s">EMBED_FILES</span><span class="w"> </span><span class="s">server_root_cert.der</span><span class="p">)</span>
</pre></div>
</div>
<p>Or if the file is a string, you can use the variable <code class="docutils literal notranslate"><span class="pre">EMBED_TXTFILES</span></code>. This will embed the contents of the text file as a null-terminated string:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">idf_component_register</span><span class="p">(</span><span class="s">...</span>
<span class="w">                       </span><span class="s">EMBED_TXTFILES</span><span class="w"> </span><span class="s">server_root_cert.pem</span><span class="p">)</span>
</pre></div>
</div>
<p>The file's contents will be added to the .rodata section in flash, and are available via symbol names as follows:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">extern</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">server_root_cert_pem_start</span><span class="p">[]</span><span class="w"> </span><span class="k">asm</span><span class="p">(</span><span class="s">&quot;_binary_server_root_cert_pem_start&quot;</span><span class="p">);</span>
<span class="k">extern</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">server_root_cert_pem_end</span><span class="p">[]</span><span class="w">   </span><span class="k">asm</span><span class="p">(</span><span class="s">&quot;_binary_server_root_cert_pem_end&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>The names are generated from the full name of the file, as given in <code class="docutils literal notranslate"><span class="pre">EMBED_FILES</span></code>. Characters /, ., etc. are replaced with underscores. The _binary prefix in the symbol name is added by objcopy and is the same for both text and binary files.</p>
<p>To embed a file into a project, rather than a component, you can call the function <code class="docutils literal notranslate"><span class="pre">target_add_binary_data</span></code> like this:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">target_add_binary_data</span><span class="p">(</span><span class="s">myproject.elf</span><span class="w"> </span><span class="s2">&quot;main/data.bin&quot;</span><span class="w"> </span><span class="s">TEXT</span><span class="p">)</span>
</pre></div>
</div>
<p>Place this line after the <code class="docutils literal notranslate"><span class="pre">project()</span></code> line in your project CMakeLists.txt file. Replace <code class="docutils literal notranslate"><span class="pre">myproject.elf</span></code> with your project name. The final argument can be <code class="docutils literal notranslate"><span class="pre">TEXT</span></code> to embed a null-terminated string, or <code class="docutils literal notranslate"><span class="pre">BINARY</span></code> to embed the content as-is.</p>
<p>For an example of using this technique, see the &quot;main&quot; component of the file_serving example <a class="reference external" href="https://github.com/espressif/esp-idf/blob/v5.4.2/examples/protocols/http_server/file_serving/main/CMakeLists.txt">protocols/http_server/file_serving/main/CMakeLists.txt</a> - two files are loaded at build time and linked into the firmware.</p>
<p>It is also possible to embed a generated file:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">add_custom_command</span><span class="p">(</span><span class="s">OUTPUT</span><span class="w"> </span><span class="s">my_processed_file.bin</span>
<span class="w">                  </span><span class="s">COMMAND</span><span class="w"> </span><span class="s">my_process_file_cmd</span><span class="w"> </span><span class="s">my_unprocessed_file.bin</span><span class="p">)</span>
<span class="nb">target_add_binary_data</span><span class="p">(</span><span class="s">my_target</span><span class="w"> </span><span class="s2">&quot;my_processed_file.bin&quot;</span><span class="w"> </span><span class="s">BINARY</span><span class="p">)</span>
</pre></div>
</div>
<p>In the example above, <code class="docutils literal notranslate"><span class="pre">my_processed_file.bin</span></code> is generated from <code class="docutils literal notranslate"><span class="pre">my_unprocessed_file.bin</span></code> through some command <code class="docutils literal notranslate"><span class="pre">my_process_file_cmd</span></code>, then embedded into the target.</p>
<p>To specify a dependence on a target, use the <code class="docutils literal notranslate"><span class="pre">DEPENDS</span></code> argument:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">add_custom_target</span><span class="p">(</span><span class="s">my_process</span><span class="w"> </span><span class="s">COMMAND</span><span class="w"> </span><span class="s">...</span><span class="p">)</span>
<span class="nb">target_add_binary_data</span><span class="p">(</span><span class="s">my_target</span><span class="w"> </span><span class="s2">&quot;my_embed_file.bin&quot;</span><span class="w"> </span><span class="s">BINARY</span><span class="w"> </span><span class="s">DEPENDS</span><span class="w"> </span><span class="s">my_process</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">DEPENDS</span></code> argument to <code class="docutils literal notranslate"><span class="pre">target_add_binary_data</span></code> ensures that the target executes first.</p>
</section>
<section id="code-and-data-placements">
<h3>Code and Data Placements<a class="headerlink" href="#code-and-data-placements" title="Permalink to this heading"></a></h3>
<p>ESP-IDF has a feature called linker script generation that enables components to define where its code and data will be placed in memory through linker fragment files. These files are processed by the build system, and is used to augment the linker script used for linking app binary. See <a class="reference internal" href="linker-script-generation.html"><span class="doc">Linker Script Generation</span></a> for a quick start guide as well as a detailed discussion of the mechanism.</p>
</section>
<section id="fully-overriding-the-component-build-process">
<span id="component-build-full-override"></span><h3>Fully Overriding the Component Build Process<a class="headerlink" href="#fully-overriding-the-component-build-process" title="Permalink to this heading"></a></h3>
<p>Obviously, there are cases where all these recipes are insufficient for a certain component, for example when the component is basically a wrapper around another third-party component not originally intended to be compiled under this build system. In that case, it's possible to forego the ESP-IDF build system entirely by using a CMake feature called <a class="reference external" href="https://cmake.org/cmake/help/v3.16/module/ExternalProject.html">ExternalProject</a>. Example component CMakeLists:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># External build process for quirc, runs in source dir and</span>
<span class="c"># produces libquirc.a</span>
<span class="nb">externalproject_add</span><span class="p">(</span><span class="s">quirc_build</span>
<span class="w">    </span><span class="s">PREFIX</span><span class="w"> </span><span class="o">${</span><span class="nv">COMPONENT_DIR</span><span class="o">}</span>
<span class="w">    </span><span class="s">SOURCE_DIR</span><span class="w"> </span><span class="o">${</span><span class="nv">COMPONENT_DIR</span><span class="o">}</span><span class="s">/quirc</span>
<span class="w">    </span><span class="s">CONFIGURE_COMMAND</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">    </span><span class="s">BUILD_IN_SOURCE</span><span class="w"> </span><span class="s">1</span>
<span class="w">    </span><span class="s">BUILD_COMMAND</span><span class="w"> </span><span class="s">make</span><span class="w"> </span><span class="s">CC=</span><span class="o">${</span><span class="nv">CMAKE_C_COMPILER</span><span class="o">}</span><span class="w"> </span><span class="s">libquirc.a</span>
<span class="w">    </span><span class="s">INSTALL_COMMAND</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">    </span><span class="p">)</span>

<span class="w"> </span><span class="c"># Add libquirc.a to the build process</span>
<span class="w"> </span><span class="nb">add_library</span><span class="p">(</span><span class="s">quirc</span><span class="w"> </span><span class="s">STATIC</span><span class="w"> </span><span class="s">IMPORTED</span><span class="w"> </span><span class="s">GLOBAL</span><span class="p">)</span>
<span class="w"> </span><span class="nb">add_dependencies</span><span class="p">(</span><span class="s">quirc</span><span class="w"> </span><span class="s">quirc_build</span><span class="p">)</span>

<span class="w"> </span><span class="nb">set_target_properties</span><span class="p">(</span><span class="s">quirc</span><span class="w"> </span><span class="s">PROPERTIES</span><span class="w"> </span><span class="s">IMPORTED_LOCATION</span>
<span class="w">      </span><span class="o">${</span><span class="nv">COMPONENT_DIR</span><span class="o">}</span><span class="s">/quirc/libquirc.a</span><span class="p">)</span>
<span class="w"> </span><span class="nb">set_target_properties</span><span class="p">(</span><span class="s">quirc</span><span class="w"> </span><span class="s">PROPERTIES</span><span class="w"> </span><span class="s">INTERFACE_INCLUDE_DIRECTORIES</span>
<span class="w">      </span><span class="o">${</span><span class="nv">COMPONENT_DIR</span><span class="o">}</span><span class="s">/quirc/lib</span><span class="p">)</span>

<span class="w"> </span><span class="nb">set_directory_properties</span><span class="p">(</span><span class="w"> </span><span class="s">PROPERTIES</span><span class="w"> </span><span class="s">ADDITIONAL_CLEAN_FILES</span>
<span class="w">      </span><span class="s2">&quot;${COMPONENT_DIR}/quirc/libquirc.a&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>(The above CMakeLists.txt can be used to create a component named <code class="docutils literal notranslate"><span class="pre">quirc</span></code> that builds the <a class="reference external" href="https://github.com/dlbeer/quirc">quirc</a> project using its own Makefile.)</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">externalproject_add</span></code> defines an external build system.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">SOURCE_DIR</span></code>, <code class="docutils literal notranslate"><span class="pre">CONFIGURE_COMMAND</span></code>, <code class="docutils literal notranslate"><span class="pre">BUILD_COMMAND</span></code> and <code class="docutils literal notranslate"><span class="pre">INSTALL_COMMAND</span></code> should always be set. <code class="docutils literal notranslate"><span class="pre">CONFIGURE_COMMAND</span></code> can be set to an empty string if the build system has no &quot;configure&quot; step. <code class="docutils literal notranslate"><span class="pre">INSTALL_COMMAND</span></code> will generally be empty for ESP-IDF builds.</p></li>
<li><p>Setting <code class="docutils literal notranslate"><span class="pre">BUILD_IN_SOURCE</span></code> means the build directory is the same as the source directory. Otherwise, you can set <code class="docutils literal notranslate"><span class="pre">BUILD_DIR</span></code>.</p></li>
<li><p>Consult the <a class="reference external" href="https://cmake.org/cmake/help/v3.16/module/ExternalProject.html">ExternalProject</a> documentation for more details about <code class="docutils literal notranslate"><span class="pre">externalproject_add()</span></code></p></li>
</ul>
</li>
<li><p>The second set of commands adds a library target, which points to the &quot;imported&quot; library file built by the external system. Some properties need to be set in order to add include directories and tell CMake where this file is.</p></li>
<li><p>Finally, the generated library is added to <a class="reference external" href="https://cmake.org/cmake/help/v3.16/prop_dir/ADDITIONAL_CLEAN_FILES.html">ADDITIONAL_CLEAN_FILES</a>. This means <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span></code> will delete this library. (Note that the other object files from the build won't be deleted.)</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using an external build process with PSRAM, remember to add <code class="docutils literal notranslate"><span class="pre">-mfix-esp32-psram-cache-issue</span></code> to the C compiler arguments. See <a class="reference internal" href="../api-reference/kconfig.html#config-spiram-cache-workaround"><span class="std std-ref">CONFIG_SPIRAM_CACHE_WORKAROUND</span></a> for details of this flag.</p>
</div>
<section id="externalproject-dependencies-and-clean-builds">
<span id="additional-clean-files-note"></span><h4>ExternalProject Dependencies and Clean Builds<a class="headerlink" href="#externalproject-dependencies-and-clean-builds" title="Permalink to this heading"></a></h4>
<p>CMake has some unusual behavior around external project builds:</p>
<ul>
<li><p><a class="reference external" href="https://cmake.org/cmake/help/v3.16/prop_dir/ADDITIONAL_CLEAN_FILES.html">ADDITIONAL_CLEAN_FILES</a> only works when &quot;make&quot; or &quot;ninja&quot; is used as the build system. If an IDE build system is used, it won't delete these files when cleaning.</p></li>
<li><p>However, the <a class="reference external" href="https://cmake.org/cmake/help/v3.16/module/ExternalProject.html">ExternalProject</a> configure &amp; build commands will <em>always</em> be re-run after a clean is run.</p></li>
<li><p>Therefore, there are two alternative recommended ways to configure the external build command:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Have the external <code class="docutils literal notranslate"><span class="pre">BUILD_COMMAND</span></code> run a full clean compile of all sources. The build command will be run if any of the dependencies passed to <code class="docutils literal notranslate"><span class="pre">externalproject_add</span></code> with <code class="docutils literal notranslate"><span class="pre">DEPENDS</span></code> have changed, or if this is a clean build (ie any of <code class="docutils literal notranslate"><span class="pre">idf.py</span> <span class="pre">clean</span></code>, <code class="docutils literal notranslate"><span class="pre">ninja</span> <span class="pre">clean</span></code>, or <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span></code> was run.)</p></li>
<li><p>Have the external <code class="docutils literal notranslate"><span class="pre">BUILD_COMMAND</span></code> be an incremental build command. Pass the parameter <code class="docutils literal notranslate"><span class="pre">BUILD_ALWAYS</span> <span class="pre">1</span></code> to <code class="docutils literal notranslate"><span class="pre">externalproject_add</span></code>. This means the external project will be built each time a build is run, regardless of dependencies. This is only recommended if the external project has correct incremental build behavior, and doesn't take too long to run.</p></li>
</ol>
</div></blockquote>
</li>
</ul>
<p>The best of these approaches for building an external project will depend on the project itself, its build system, and whether you anticipate needing to frequently recompile the project.</p>
</section>
</section>
</section>
<section id="custom-sdkconfig-defaults">
<span id="id6"></span><h2>Custom Sdkconfig Defaults<a class="headerlink" href="#custom-sdkconfig-defaults" title="Permalink to this heading"></a></h2>
<p>For example projects or other projects where you don't want to specify a full sdkconfig configuration, but you do want to override some key values from the ESP-IDF defaults, it is possible to create a file <code class="docutils literal notranslate"><span class="pre">sdkconfig.defaults</span></code> in the project directory. This file will be used when creating a new config from scratch, or when any new config value hasn't yet been set in the <code class="docutils literal notranslate"><span class="pre">sdkconfig</span></code> file.</p>
<p>To override the name of this file or to specify multiple files, set the <code class="docutils literal notranslate"><span class="pre">SDKCONFIG_DEFAULTS</span></code> environment variable or set <code class="docutils literal notranslate"><span class="pre">SDKCONFIG_DEFAULTS</span></code> in top-level <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>. File names that are not specified as full paths are resolved relative to current project's directory.</p>
<p>When specifying multiple files, use a semicolon as the list separator. Files listed first will be applied first. If a particular key is defined in multiple files, the definition in the latter file will override definitions from former files.</p>
<p>Some of the IDF examples include a <code class="docutils literal notranslate"><span class="pre">sdkconfig.ci</span></code> file. This is part of the continuous integration (CI) test framework and is ignored by the normal build process.</p>
<section id="target-dependent-sdkconfig-defaults">
<h3>Target-dependent Sdkconfig Defaults<a class="headerlink" href="#target-dependent-sdkconfig-defaults" title="Permalink to this heading"></a></h3>
<p>If and only if an <code class="docutils literal notranslate"><span class="pre">sdkconfig.defaults</span></code> file exists, the build system will also attempt to load defaults from an <code class="docutils literal notranslate"><span class="pre">sdkconfig.defaults.TARGET_NAME</span></code> file, where <code class="docutils literal notranslate"><span class="pre">TARGET_NAME</span></code> is the value of <code class="docutils literal notranslate"><span class="pre">IDF_TARGET</span></code>. For example, for <code class="docutils literal notranslate"><span class="pre">esp32</span></code> target, default settings will be taken from <code class="docutils literal notranslate"><span class="pre">sdkconfig.defaults</span></code> first, and then from <code class="docutils literal notranslate"><span class="pre">sdkconfig.defaults.esp32</span></code>. If there are no generic default settings, an empty <code class="docutils literal notranslate"><span class="pre">sdkconfig.defaults</span></code> still needs to be created if the build system should recognize any additional target-dependent <code class="docutils literal notranslate"><span class="pre">sdkconfig.defaults.TARGET_NAME</span></code> files.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">SDKCONFIG_DEFAULTS</span></code> is used to override the name of defaults file/files, the name of target-specific defaults file will be derived from <code class="docutils literal notranslate"><span class="pre">SDKCONFIG_DEFAULTS</span></code> value/values using the rule above. When there are multiple files in <code class="docutils literal notranslate"><span class="pre">SDKCONFIG_DEFAULTS</span></code>, target-specific file will be applied right after the file bringing it in, before all latter files in <code class="docutils literal notranslate"><span class="pre">SDKCONFIG_DEFAULTS</span></code></p>
<p>For example, if <code class="docutils literal notranslate"><span class="pre">SDKCONFIG_DEFAULTS=&quot;sdkconfig.defaults;sdkconfig_devkit1&quot;</span></code>, and there is a file <code class="docutils literal notranslate"><span class="pre">sdkconfig.defaults.esp32</span></code> in the same folder, then the files will be applied in the following order: (1) sdkconfig.defaults (2) sdkconfig.defaults.esp32 (3) sdkconfig_devkit1.</p>
</section>
</section>
<section id="flash-arguments">
<span id="flash-parameters"></span><h2>Flash Arguments<a class="headerlink" href="#flash-arguments" title="Permalink to this heading"></a></h2>
<p>There are some scenarios that we want to flash the target board without IDF. For this case we want to save the built binaries, esptool.py and esptool write_flash arguments. It's simple to write a script to save binaries and esptool.py.</p>
<p>After running a project build, the build directory contains binary output files (<code class="docutils literal notranslate"><span class="pre">.bin</span></code> files) for the project and also the following flashing data files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">flash_project_args</span></code> contains arguments to flash the entire project (app, bootloader, partition table, PHY data if this is configured).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flash_app_args</span></code> contains arguments to flash only the app.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flash_bootloader_args</span></code> contains arguments to flash only the bootloader.</p></li>
</ul>
<p>You can pass any of these flasher argument files to <code class="docutils literal notranslate"><span class="pre">esptool.py</span></code> as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>esptool.py<span class="w"> </span>--chip<span class="w"> </span>esp32<span class="w"> </span>write_flash<span class="w"> </span>@build/flash_project_args
</pre></div>
</div>
<p>Alternatively, it is possible to manually copy the parameters from the argument file and pass them on the command line.</p>
<p>The build directory also contains a generated file <code class="docutils literal notranslate"><span class="pre">flasher_args.json</span></code> which contains project flash information, in JSON format. This file is used by <code class="docutils literal notranslate"><span class="pre">idf.py</span></code> and can also be used by other tools which need information about the project build.</p>
</section>
<section id="building-the-bootloader">
<h2>Building the Bootloader<a class="headerlink" href="#building-the-bootloader" title="Permalink to this heading"></a></h2>
<p>The bootloader is a special &quot;subproject&quot; inside <a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/components/bootloader/subproject">/components/bootloader/subproject</a>. It has its own project CMakeLists.txt file and builds separate .ELF and .BIN files to the main project. However, it shares its configuration and build directory with the main project.</p>
<p>The subproject is inserted as an external project from the top-level project, by the file <a class="reference external" href="https://github.com/espressif/esp-idf/blob/v5.4.2/components/bootloader/project_include.cmake">/components/bootloader/project_include.cmake</a>. The main build process runs CMake for the subproject, which includes discovering components (a subset of the main components) and generating a bootloader-specific config (derived from the main <code class="docutils literal notranslate"><span class="pre">sdkconfig</span></code>).</p>
</section>
<section id="writing-pure-cmake-components">
<span id="write-pure-component"></span><h2>Writing Pure CMake Components<a class="headerlink" href="#writing-pure-cmake-components" title="Permalink to this heading"></a></h2>
<p>The ESP-IDF build system &quot;wraps&quot; CMake with the concept of &quot;components&quot;, and helper functions to automatically integrate these components into a project build.</p>
<p>However, underneath the concept of &quot;components&quot; is a full CMake build system. It is also possible to make a component which is pure CMake.</p>
<p>Here is an example minimal &quot;pure CMake&quot; component CMakeLists file for a component named <code class="docutils literal notranslate"><span class="pre">json</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">add_library</span><span class="p">(</span><span class="s">json</span><span class="w"> </span><span class="s">STATIC</span>
<span class="s">cJSON/cJSON.c</span>
<span class="s">cJSON/cJSON_Utils.c</span><span class="p">)</span>

<span class="nb">target_include_directories</span><span class="p">(</span><span class="s">json</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="s">cJSON</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>This is actually an equivalent declaration to the IDF <code class="docutils literal notranslate"><span class="pre">json</span></code> component <a class="reference external" href="https://github.com/espressif/esp-idf/blob/v5.4.2/components/json/CMakeLists.txt">/components/json/CMakeLists.txt</a>.</p></li>
<li><p>This file is quite simple as there are not a lot of source files. For components with a large number of files, the globbing behavior of ESP-IDF's component logic can make the component CMakeLists style simpler.)</p></li>
<li><p>Any time a component adds a library target with the component name, the ESP-IDF build system will automatically add this to the build, expose public include directories, etc. If a component wants to add a library target with a different name, dependencies will need to be added manually via CMake commands.</p></li>
</ul>
</section>
<section id="using-third-party-cmake-projects-with-components">
<h2>Using Third-Party CMake Projects with Components<a class="headerlink" href="#using-third-party-cmake-projects-with-components" title="Permalink to this heading"></a></h2>
<p>CMake is used for a lot of open-source C and C++ projects — code that users can tap into for their applications. One of the benefits of having a CMake build system is the ability to import these third-party projects, sometimes even without modification! This allows for users to be able to get functionality that may not yet be provided by a component, or use another library for the same functionality.</p>
<p>Importing a library might look like this for a hypothetical library <code class="docutils literal notranslate"><span class="pre">foo</span></code> to be used in the <code class="docutils literal notranslate"><span class="pre">main</span></code> component:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># Register the component</span>
<span class="nb">idf_component_register</span><span class="p">(</span><span class="s">...</span><span class="p">)</span>

<span class="c"># Set values of hypothetical variables that control the build of `foo`</span>
<span class="nb">set</span><span class="p">(</span><span class="s">FOO_BUILD_STATIC</span><span class="w"> </span><span class="s">OFF</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s">FOO_BUILD_TESTS</span><span class="w"> </span><span class="s">OFF</span><span class="p">)</span>

<span class="c"># Create and import the library targets</span>
<span class="nb">add_subdirectory</span><span class="p">(</span><span class="s">foo</span><span class="p">)</span>

<span class="c"># Publicly link `foo` to `main` component</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">main</span><span class="w"> </span><span class="s">PUBLIC</span><span class="w"> </span><span class="s">foo</span><span class="p">)</span>
</pre></div>
</div>
<p>For an actual example, take a look at <a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/examples/build_system/cmake/import_lib">build_system/cmake/import_lib</a>. Take note that what needs to be done in order to import the library may vary. It is recommended to read up on the library's documentation for instructions on how to import it from other projects. Studying the library's CMakeLists.txt and build structure can also be helpful.</p>
<p>It is also possible to wrap a third-party library to be used as a component in this manner. For example, the <a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/components/mbedtls">mbedtls</a> component is a wrapper for Espressif's fork of <a class="reference external" href="https://github.com/Mbed-TLS/mbedtls">mbedtls</a>. See its <a class="reference external" href="https://github.com/espressif/esp-idf/blob/v5.4.2/components/mbedtls/CMakeLists.txt">component CMakeLists.txt </a>.</p>
<p>The CMake variable <code class="docutils literal notranslate"><span class="pre">ESP_PLATFORM</span></code> is set to 1 whenever the ESP-IDF build system is being used. Tests such as <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(ESP_PLATFORM)</span></code> can be used in generic CMake code if special IDF-specific logic is required.</p>
<section id="using-esp-idf-components-from-external-libraries">
<h3>Using ESP-IDF Components from External Libraries<a class="headerlink" href="#using-esp-idf-components-from-external-libraries" title="Permalink to this heading"></a></h3>
<p>The above example assumes that the external library <code class="docutils literal notranslate"><span class="pre">foo</span></code> (or <code class="docutils literal notranslate"><span class="pre">tinyxml</span></code> in the case of the <code class="docutils literal notranslate"><span class="pre">import_lib</span></code> example) doesn't need to use any ESP-IDF APIs apart from common APIs such as libc, libstdc++, etc. If the external library needs to use APIs provided by other ESP-IDF components, this needs to be specified in the external CMakeLists.txt file by adding a dependency on the library target <code class="docutils literal notranslate"><span class="pre">idf::&lt;componentname&gt;</span></code>.</p>
<p>For example, in the <code class="docutils literal notranslate"><span class="pre">foo/CMakeLists.txt</span></code> file:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">add_library</span><span class="p">(</span><span class="s">foo</span><span class="w"> </span><span class="s">bar.c</span><span class="w"> </span><span class="s">fizz.cpp</span><span class="w"> </span><span class="s">buzz.cpp</span><span class="p">)</span>

<span class="nb">if</span><span class="p">(</span><span class="s">ESP_PLATFORM</span><span class="p">)</span>
<span class="w">  </span><span class="c"># On ESP-IDF, bar.c needs to include esp_flash.h from the spi_flash component</span>
<span class="w">  </span><span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">foo</span><span class="w"> </span><span class="s">PRIVATE</span><span class="w"> </span><span class="s">idf::spi_flash</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="using-prebuilt-libraries-with-components">
<h2>Using Prebuilt Libraries with Components<a class="headerlink" href="#using-prebuilt-libraries-with-components" title="Permalink to this heading"></a></h2>
<p>Another possibility is that you have a prebuilt static library (<code class="docutils literal notranslate"><span class="pre">.a</span></code> file), built by some other build process.</p>
<p>The ESP-IDF build system provides a utility function <code class="docutils literal notranslate"><span class="pre">add_prebuilt_library</span></code> for users to be able to easily import and use prebuilt libraries:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">add_prebuilt_library</span><span class="p">(</span><span class="s">target_name</span><span class="w"> </span><span class="s">lib_path</span><span class="w"> </span><span class="s">[REQUIRES</span><span class="w"> </span><span class="s">req1</span><span class="w"> </span><span class="s">req2</span><span class="w"> </span><span class="s">...]</span><span class="w"> </span><span class="s">[PRIV_REQUIRES</span><span class="w"> </span><span class="s">req1</span><span class="w"> </span><span class="s">req2</span><span class="w"> </span><span class="s">...]</span><span class="p">)</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">target_name</span></code>- name that can be used to reference the imported library, such as when linking to other targets</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lib_path</span></code>- path to prebuilt library; may be an absolute or relative path to the component directory</p></li>
</ul>
<p>Optional arguments <code class="docutils literal notranslate"><span class="pre">REQUIRES</span></code> and <code class="docutils literal notranslate"><span class="pre">PRIV_REQUIRES</span></code> specify dependency on other components. These have the same meaning as the arguments for <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code>.</p>
<p>Take note that the prebuilt library must have been compiled for the same target as the consuming project. Configuration relevant to the prebuilt library must also match. If not paid attention to, these two factors may contribute to subtle bugs in the app.</p>
<p>For an example, take a look at <a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/examples/build_system/cmake/import_prebuilt">build_system/cmake/import_prebuilt</a>.</p>
</section>
<section id="using-esp-idf-in-custom-cmake-projects">
<h2>Using ESP-IDF in Custom CMake Projects<a class="headerlink" href="#using-esp-idf-in-custom-cmake-projects" title="Permalink to this heading"></a></h2>
<p>ESP-IDF provides a template CMake project for easily creating an application. However, in some instances the user might already have an existing CMake project or may want to create a custom one. In these cases it is desirable to be able to consume IDF components as libraries to be linked to the user's targets (libraries/executables).</p>
<p>It is possible to do so by using the <a class="reference internal" href="#cmake-buildsystem-api"><span class="std std-ref">build system APIs provided</span></a> by <a class="reference external" href="https://github.com/espressif/esp-idf/blob/v5.4.2/tools/cmake/idf.cmake">tools/cmake/idf.cmake</a>. For example:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.16</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s">my_custom_app</span><span class="w"> </span><span class="s">C</span><span class="p">)</span>

<span class="c"># Include CMake file that provides ESP-IDF CMake build system APIs.</span>
<span class="nb">include</span><span class="p">(</span><span class="o">$ENV{</span><span class="nv">IDF_PATH</span><span class="o">}</span><span class="s">/tools/cmake/idf.cmake</span><span class="p">)</span>

<span class="c"># Include ESP-IDF components in the build, may be thought as an equivalent of</span>
<span class="c"># add_subdirectory() but with some additional processing and magic for ESP-IDF build</span>
<span class="c"># specific build processes.</span>
<span class="nb">idf_build_process</span><span class="p">(</span><span class="s">esp32</span><span class="p">)</span>

<span class="c"># Create the project executable and plainly link the newlib component to it using</span>
<span class="c"># its alias, idf::newlib.</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="o">${</span><span class="nv">CMAKE_PROJECT_NAME</span><span class="o">}</span><span class="s">.elf</span><span class="w"> </span><span class="s">main.c</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="o">${</span><span class="nv">CMAKE_PROJECT_NAME</span><span class="o">}</span><span class="s">.elf</span><span class="w"> </span><span class="s">idf::newlib</span><span class="p">)</span>

<span class="c"># Let the build system know what the project executable is to attach more targets, dependencies, etc.</span>
<span class="nb">idf_build_executable</span><span class="p">(</span><span class="o">${</span><span class="nv">CMAKE_PROJECT_NAME</span><span class="o">}</span><span class="s">.elf</span><span class="p">)</span>
</pre></div>
</div>
<p>The example in <a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/examples/build_system/cmake/idf_as_lib">build_system/cmake/idf_as_lib</a> demonstrates the creation of an application equivalent to <a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/examples/get-started/hello_world">hello world application </a> using a custom CMake project.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The IDF build system can only set compiler flags for source files that it builds. When an external CMakeLists.txt file is used and PSRAM is enabled, remember to add <code class="docutils literal notranslate"><span class="pre">-mfix-esp32-psram-cache-issue</span></code> to the C compiler arguments. See <a class="reference internal" href="../api-reference/kconfig.html#config-spiram-cache-workaround"><span class="std std-ref">CONFIG_SPIRAM_CACHE_WORKAROUND</span></a> for details of this flag.</p>
</div>
</section>
<section id="esp-idf-cmake-build-system-api">
<span id="cmake-buildsystem-api"></span><h2>ESP-IDF CMake Build System API<a class="headerlink" href="#esp-idf-cmake-build-system-api" title="Permalink to this heading"></a></h2>
<section id="idf-build-commands">
<h3>Idf-build-commands<a class="headerlink" href="#idf-build-commands" title="Permalink to this heading"></a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>idf_build_get_property(var property [GENERATOR_EXPRESSION])
</pre></div>
</div>
<p>Retrieve a <a class="reference internal" href="#cmake-build-properties"><span class="std std-ref">build property</span></a> <em>property</em> and store it in <em>var</em> accessible from the current scope. Specifying <em>GENERATOR_EXPRESSION</em> will retrieve the generator expression string for that property, instead of the actual value, which can be used with CMake commands that support generator expressions.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>idf_build_set_property(property val [APPEND])
</pre></div>
</div>
<p>Set a <a class="reference internal" href="#cmake-build-properties"><span class="std std-ref">build property</span></a> <em>property</em> with value <em>val</em>. Specifying <em>APPEND</em> will append the specified value to the current value of the property. If the property does not previously exist or it is currently empty, the specified value becomes the first element/member instead.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>idf_build_component(component_dir [component_source])
</pre></div>
</div>
<p>Present a directory <em>component_dir</em> that contains a component to the build system. Relative paths are converted to absolute paths with respect to current directory.</p>
<p>An optional <em>component_source</em> argument can be specified to indicate the source of the component. (default: &quot;project_components&quot;)</p>
<p>This argument determines the overriding priority for components with the same name. For detailed information, see <a class="reference internal" href="#cmake-components-same-name"><span class="std std-ref">Multiple Components with the Same Name</span></a>.</p>
<p>This argument supports the following values (from highest to lowest priority):</p>
<ul class="simple">
<li><p>&quot;project_components&quot; - project components</p></li>
<li><p>&quot;project_extra_components&quot; - components from <code class="docutils literal notranslate"><span class="pre">EXTRA_COMPONENT_DIRS</span></code></p></li>
<li><p>&quot;project_managed_components&quot; - custom project dependencies managed by the IDF Component Manager</p></li>
<li><p>&quot;idf_components&quot; - ESP-IDF built-in components, typically under <a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/components">/components</a></p></li>
</ul>
<p>For instance, if a component named &quot;json&quot; is present as both &quot;idf_components&quot;, and &quot;project_components&quot;, the component as &quot;project_components&quot; takes precedence over the one as &quot;idf_components&quot;.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>All calls to this command must be performed before <cite>idf_build_process</cite>. This command does not guarantee that the component will be processed during build (see the <cite>COMPONENTS</cite> argument description for <cite>idf_build_process</cite>).</p>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>idf_build_process(target
                  [PROJECT_DIR project_dir]
                  [PROJECT_VER project_ver]
                  [PROJECT_NAME project_name]
                  [SDKCONFIG sdkconfig]
                  [SDKCONFIG_DEFAULTS sdkconfig_defaults]
                  [BUILD_DIR build_dir]
                  [COMPONENTS component1 component2 ...])
</pre></div>
</div>
<p>Performs the bulk of the behind-the-scenes magic for including ESP-IDF components such as component configuration, libraries creation, dependency expansion and resolution. Among these functions, perhaps the most important from a user's perspective is the libraries creation by calling each component's <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code>. This command creates the libraries for each component, which are accessible using aliases in the form idf::<em>component_name</em>.
These aliases can be used to link the components to the user's own targets, either libraries or executables.</p>
<p>The call requires the target chip to be specified with <em>target</em> argument. Optional arguments for the call include:</p>
<ul class="simple">
<li><p>PROJECT_DIR - directory of the project; defaults to CMAKE_SOURCE_DIR</p></li>
<li><p>PROJECT_NAME - name of the project; defaults to CMAKE_PROJECT_NAME</p></li>
<li><p>PROJECT_VER - version/revision of the project; defaults to &quot;1&quot;</p></li>
<li><p>SDKCONFIG - output path of generated sdkconfig file; defaults to PROJECT_DIR/sdkconfig or CMAKE_SOURCE_DIR/sdkconfig depending if PROJECT_DIR is set</p></li>
<li><p>SDKCONFIG_DEFAULTS - list of files containing default config to use in the build (list must contain full paths); defaults to empty. For each value <em>filename</em> in the list, the config from file <em>filename.target</em>, if it exists, is also loaded.</p></li>
<li><p>BUILD_DIR - directory to place ESP-IDF build-related artifacts, such as generated binaries, text files, components; defaults to CMAKE_BINARY_DIR</p></li>
<li><p>COMPONENTS - select components to process among the components known by the build system (added via <cite>idf_build_component</cite>). This argument is used to trim the build.
Other components are automatically added if they are required in the dependency chain, i.e., the public and private requirements of the components in this list are automatically added, and in turn the public and private requirements of those requirements, so on and so forth. If not specified, all components known to the build system are processed.</p></li>
</ul>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>idf_build_executable(executable)
</pre></div>
</div>
<p>Specify the executable <em>executable</em> for ESP-IDF build. This attaches additional targets such as dependencies related to flashing, generating additional binary files, etc. Should be called after <code class="docutils literal notranslate"><span class="pre">idf_build_process</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>idf_build_get_config(var config [GENERATOR_EXPRESSION])
</pre></div>
</div>
<p>Get the value of the specified config. Much like build properties, specifying <em>GENERATOR_EXPRESSION</em> will retrieve the generator expression string for that config, instead of the actual value, which can be used with CMake commands that support generator expressions. Actual config values are only known after call to <code class="docutils literal notranslate"><span class="pre">idf_build_process</span></code>, however.</p>
</section>
<section id="cmake-build-properties">
<span id="idf-build-properties"></span><h3>Idf-build-properties<a class="headerlink" href="#cmake-build-properties" title="Permalink to this heading"></a></h3>
<p>These are properties that describe the build. Values of build properties can be retrieved by using the build command <code class="docutils literal notranslate"><span class="pre">idf_build_get_property</span></code>. For example, to get the Python interpreter used for the build:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">idf_build_get_property</span><span class="p">(</span><span class="s">python</span><span class="w"> </span><span class="s">PYTHON</span><span class="p">)</span>
<span class="nb">message</span><span class="p">(</span><span class="s">STATUS</span><span class="w"> </span><span class="s2">&quot;The Python interpreter is: ${python}&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>BUILD_DIR - build directory; set from <code class="docutils literal notranslate"><span class="pre">idf_build_process</span></code> BUILD_DIR argument</p></li>
<li><p>BUILD_COMPONENTS - list of components included in the build; set by <code class="docutils literal notranslate"><span class="pre">idf_build_process</span></code></p></li>
<li><p>BUILD_COMPONENT_ALIASES - list of library alias of components included in the build; set by <code class="docutils literal notranslate"><span class="pre">idf_build_process</span></code></p></li>
<li><p>C_COMPILE_OPTIONS - compile options applied to all components' C source files</p></li>
<li><p>COMPILE_OPTIONS - compile options applied to all components' source files, regardless of it being C or C++</p></li>
<li><p>COMPILE_DEFINITIONS - compile definitions applied to all component source files</p></li>
<li><p>CXX_COMPILE_OPTIONS - compile options applied to all components' C++ source files</p></li>
<li><p>DEPENDENCIES_LOCK - lock file path used in component manager. The default value is <cite>dependencies.lock</cite> under the project path.</p></li>
<li><p>EXECUTABLE - project executable; set by call to <code class="docutils literal notranslate"><span class="pre">idf_build_executable</span></code></p></li>
<li><p>EXECUTABLE_NAME - name of project executable without extension; set by call to <code class="docutils literal notranslate"><span class="pre">idf_build_executable</span></code></p></li>
<li><p>EXECUTABLE_DIR - path containing the output executable</p></li>
<li><p>IDF_COMPONENT_MANAGER - the component manager is enabled by default, but if this property is set to <code class="docutils literal notranslate"><span class="pre">0</span></code> it was disabled by the IDF_COMPONENT_MANAGER environment variable</p></li>
<li><p>IDF_PATH - ESP-IDF path; set from IDF_PATH environment variable, if not, inferred from the location of <code class="docutils literal notranslate"><span class="pre">idf.cmake</span></code></p></li>
<li><p>IDF_TARGET - target chip for the build; set from the required target argument for <code class="docutils literal notranslate"><span class="pre">idf_build_process</span></code></p></li>
<li><p>IDF_VER - ESP-IDF version; set from either a version file or the Git revision of the IDF_PATH repository</p></li>
<li><p>INCLUDE_DIRECTORIES - include directories for all component source files</p></li>
<li><p>KCONFIGS - list of Kconfig files found in components in build; set by <code class="docutils literal notranslate"><span class="pre">idf_build_process</span></code></p></li>
<li><p>KCONFIG_PROJBUILDS - list of Kconfig.projbuild files found in components in build; set by <code class="docutils literal notranslate"><span class="pre">idf_build_process</span></code></p></li>
<li><p>PROJECT_NAME - name of the project; set from <code class="docutils literal notranslate"><span class="pre">idf_build_process</span></code> PROJECT_NAME argument</p></li>
<li><p>PROJECT_DIR - directory of the project; set from <code class="docutils literal notranslate"><span class="pre">idf_build_process</span></code> PROJECT_DIR argument</p></li>
<li><p>PROJECT_VER - version of the project; set from <code class="docutils literal notranslate"><span class="pre">idf_build_process</span></code> PROJECT_VER argument</p></li>
<li><p>PYTHON - Python interpreter used for the build; set from PYTHON environment variable if available, if not &quot;python&quot; is used</p></li>
<li><p>SDKCONFIG - full path to output config file; set from <code class="docutils literal notranslate"><span class="pre">idf_build_process</span></code> SDKCONFIG argument</p></li>
<li><p>SDKCONFIG_DEFAULTS - list of files containing default config to use in the build; set from <code class="docutils literal notranslate"><span class="pre">idf_build_process</span></code> SDKCONFIG_DEFAULTS argument</p></li>
<li><p>SDKCONFIG_HEADER - full path to C/C++ header file containing component configuration; set by <code class="docutils literal notranslate"><span class="pre">idf_build_process</span></code></p></li>
<li><p>SDKCONFIG_CMAKE - full path to CMake file containing component configuration; set by <code class="docutils literal notranslate"><span class="pre">idf_build_process</span></code></p></li>
<li><p>SDKCONFIG_JSON - full path to JSON file containing component configuration; set by <code class="docutils literal notranslate"><span class="pre">idf_build_process</span></code></p></li>
<li><p>SDKCONFIG_JSON_MENUS - full path to JSON file containing config menus; set by <code class="docutils literal notranslate"><span class="pre">idf_build_process</span></code></p></li>
</ul>
</section>
<section id="idf-component-commands">
<h3>Idf-component-commands<a class="headerlink" href="#idf-component-commands" title="Permalink to this heading"></a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>idf_component_get_property(var component property [GENERATOR_EXPRESSION])
</pre></div>
</div>
<p>Retrieve a specified <em>component</em>'s <a class="reference internal" href="#cmake-component-properties"><span class="std std-ref">component property</span></a>, <em>property</em> and store it in <em>var</em> accessible from the current scope. Specifying <em>GENERATOR_EXPRESSION</em> will retrieve the generator expression string for that property, instead of the actual value, which can be used with CMake commands that support generator expressions.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>idf_component_set_property(component property val [APPEND])
</pre></div>
</div>
<p>Set a specified <em>component</em>'s <a class="reference internal" href="#cmake-component-properties"><span class="std std-ref">component property</span></a>, <em>property</em> with value <em>val</em>. Specifying <em>APPEND</em> will append the specified value to the current value of the property. If the property does not previously exist or it is currently empty, the specified value becomes the first element/member instead.</p>
<div class="highlight-none notranslate" id="cmake-component-register"><div class="highlight"><pre><span></span>idf_component_register([[SRCS src1 src2 ...] | [[SRC_DIRS dir1 dir2 ...] [EXCLUDE_SRCS src1 src2 ...]]
                       [INCLUDE_DIRS dir1 dir2 ...]
                       [PRIV_INCLUDE_DIRS dir1 dir2 ...]
                       [REQUIRES component1 component2 ...]
                       [PRIV_REQUIRES component1 component2 ...]
                       [LDFRAGMENTS ldfragment1 ldfragment2 ...]
                       [REQUIRED_IDF_TARGETS target1 target2 ...]
                       [EMBED_FILES file1 file2 ...]
                       [EMBED_TXTFILES file1 file2 ...]
                       [KCONFIG kconfig]
                       [KCONFIG_PROJBUILD kconfig_projbuild]
                       [WHOLE_ARCHIVE])
</pre></div>
</div>
<p>Register a component to the build system. Much like the <code class="docutils literal notranslate"><span class="pre">project()</span></code> CMake command, this should be called from the component's CMakeLists.txt directly (not through a function or macro) and is recommended to be called before any other command. Here are some guidelines on what commands can <strong>not</strong> be called before <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><p>commands that are not valid in CMake script mode</p></li>
<li><p>custom commands defined in project_include.cmake</p></li>
<li><p>build system API commands except <code class="docutils literal notranslate"><span class="pre">idf_build_get_property</span></code>; although consider whether the property may not have been set yet</p></li>
</ul>
</div></blockquote>
<p>Commands that set and operate on variables are generally okay to call before <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code>.</p>
<p>The arguments for <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code> include:</p>
<blockquote>
<div><ul class="simple">
<li><p>SRCS - component source files used for creating a static library for the component; if not specified, component is a treated as a config-only component and an interface library is created instead.</p></li>
<li><p>SRC_DIRS, EXCLUDE_SRCS - used to glob source files (.c, .cpp, .S) by specifying directories, instead of specifying source files manually via SRCS. Note that this is subject to the <a class="reference internal" href="#cmake-file-globbing"><span class="std std-ref">limitations of globbing in CMake</span></a>. Source files specified in EXCLUDE_SRCS are removed from the globbed files.</p></li>
<li><p>INCLUDE_DIRS - paths, relative to the component directory, which will be added to the include search path for all other components which require the current component</p></li>
<li><p>PRIV_INCLUDE_DIRS - directory paths, must be relative to the component directory, which will be added to the include search path for this component's source files only</p></li>
<li><p>REQUIRES - public component requirements for the component</p></li>
<li><p>PRIV_REQUIRES - private component requirements for the component; ignored on config-only components</p></li>
<li><p>LDFRAGMENTS - component linker fragment files</p></li>
<li><p>REQUIRED_IDF_TARGETS - specify the only target the component supports</p></li>
<li><p>KCONFIG - override the default Kconfig file</p></li>
<li><p>KCONFIG_PROJBUILD - override the default Kconfig.projbuild file</p></li>
<li><p>WHOLE_ARCHIVE - if specified, the component library is surrounded by <code class="docutils literal notranslate"><span class="pre">-Wl,--whole-archive</span></code>, <code class="docutils literal notranslate"><span class="pre">-Wl,--no-whole-archive</span></code> when linked. This has the same effect as setting <code class="docutils literal notranslate"><span class="pre">WHOLE_ARCHIVE</span></code> component property.</p></li>
</ul>
</div></blockquote>
<p>The following are used for <a class="reference internal" href="#cmake-embed-data"><span class="std std-ref">embedding data into the component</span></a>, and is considered as source files when determining if a component is config-only. This means that even if the component does not specify source files, a static library is still created internally for the component if it specifies either:</p>
<blockquote>
<div><ul class="simple">
<li><p>EMBED_FILES - binary files to be embedded in the component</p></li>
<li><p>EMBED_TXTFILES - text files to be embedded in the component</p></li>
</ul>
</div></blockquote>
</section>
<section id="cmake-component-properties">
<span id="idf-component-properties"></span><h3>Idf-component-properties<a class="headerlink" href="#cmake-component-properties" title="Permalink to this heading"></a></h3>
<p>These are properties that describe a component. Values of component properties can be retrieved by using the build command <code class="docutils literal notranslate"><span class="pre">idf_component_get_property</span></code>. For example, to get the directory of the <code class="docutils literal notranslate"><span class="pre">freertos</span></code> component:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">idf_component_get_property</span><span class="p">(</span><span class="s">dir</span><span class="w"> </span><span class="s">freertos</span><span class="w"> </span><span class="s">COMPONENT_DIR</span><span class="p">)</span>
<span class="nb">message</span><span class="p">(</span><span class="s">STATUS</span><span class="w"> </span><span class="s2">&quot;The &#39;freertos&#39; component directory is: ${dir}&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>COMPONENT_ALIAS - alias for COMPONENT_LIB used for linking the component to external targets; set by <code class="docutils literal notranslate"><span class="pre">idf_build_component</span></code> and alias library itself is created by <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code></p></li>
<li><p>COMPONENT_DIR - component directory; set by <code class="docutils literal notranslate"><span class="pre">idf_build_component</span></code></p></li>
<li><p>COMPONENT_OVERRIDEN_DIR - contains the directory of the original component if <a class="reference internal" href="#cmake-components-same-name"><span class="std std-ref">this component overrides another component</span></a></p></li>
<li><p>COMPONENT_LIB - name for created component static/interface library; set by <code class="docutils literal notranslate"><span class="pre">idf_build_component</span></code> and library itself is created by <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code></p></li>
<li><p>COMPONENT_NAME - name of the component; set by <code class="docutils literal notranslate"><span class="pre">idf_build_component</span></code> based on the component directory name</p></li>
<li><p>COMPONENT_TYPE - type of the component, whether LIBRARY or CONFIG_ONLY. A component is of type LIBRARY if it specifies source files or embeds a file</p></li>
<li><p>COMPONENT_SOURCE - source of the component, one of &quot;idf_components&quot;, &quot;project_managed_components&quot;, &quot;project_components&quot;, &quot;project_extra_components&quot;. This is used to determine the override precedence of components with the same name.</p></li>
<li><p>EMBED_FILES - list of files to embed in component; set from <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code> EMBED_FILES argument</p></li>
<li><p>EMBED_TXTFILES - list of text files to embed in component; set from <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code> EMBED_TXTFILES argument</p></li>
<li><p>INCLUDE_DIRS - list of component include directories; set from <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code> INCLUDE_DIRS argument</p></li>
<li><p>KCONFIG - component Kconfig file; set by <code class="docutils literal notranslate"><span class="pre">idf_build_component</span></code></p></li>
<li><p>KCONFIG_PROJBUILD - component Kconfig.projbuild; set by <code class="docutils literal notranslate"><span class="pre">idf_build_component</span></code></p></li>
<li><p>LDFRAGMENTS - list of component linker fragment files; set from <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code> LDFRAGMENTS argument</p></li>
<li><p>MANAGED_PRIV_REQUIRES - list of private component dependencies added by the IDF component manager from dependencies in <code class="docutils literal notranslate"><span class="pre">idf_component.yml</span></code> manifest file</p></li>
<li><p>MANAGED_REQUIRES - list of public component dependencies added by the IDF component manager from dependencies in <code class="docutils literal notranslate"><span class="pre">idf_component.yml</span></code> manifest file</p></li>
<li><p>PRIV_INCLUDE_DIRS - list of component private include directories; set from <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code> PRIV_INCLUDE_DIRS on components of type LIBRARY</p></li>
<li><p>PRIV_REQUIRES - list of private component dependencies; set from value of <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code> PRIV_REQUIRES argument and dependencies in <code class="docutils literal notranslate"><span class="pre">idf_component.yml</span></code> manifest file</p></li>
<li><p>REQUIRED_IDF_TARGETS - list of targets the component supports; set from <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code> REQUIRED_IDF_TARGETS argument</p></li>
<li><p>REQUIRES - list of public component dependencies; set from value of <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code> REQUIRES argument and dependencies in <code class="docutils literal notranslate"><span class="pre">idf_component.yml</span></code> manifest file</p></li>
<li><p>SRCS - list of component source files; set from SRCS or SRC_DIRS/EXCLUDE_SRCS argument of <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code></p></li>
<li><p>WHOLE_ARCHIVE - if this property is set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> (or any boolean &quot;true&quot; CMake value: 1, <code class="docutils literal notranslate"><span class="pre">ON</span></code>, <code class="docutils literal notranslate"><span class="pre">YES</span></code>, <code class="docutils literal notranslate"><span class="pre">Y</span></code>), the component library is surrounded by <code class="docutils literal notranslate"><span class="pre">-Wl,--whole-archive</span></code>, <code class="docutils literal notranslate"><span class="pre">-Wl,--no-whole-archive</span></code> when linked. This can be used to force the linker to include every object file into the executable, even if the object file doesn't resolve any references from the rest of the application. This is commonly used when a component contains plugins or modules which rely on link-time registration. This property is <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> by default. It can be set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> from the component CMakeLists.txt file.</p></li>
</ul>
</section>
</section>
<section id="file-globbing-incremental-builds">
<span id="cmake-file-globbing"></span><h2>File Globbing &amp; Incremental Builds<a class="headerlink" href="#file-globbing-incremental-builds" title="Permalink to this heading"></a></h2>
<p>The preferred way to include source files in an ESP-IDF component is to list them manually via SRCS argument to <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">idf_component_register</span><span class="p">(</span><span class="s">SRCS</span><span class="w"> </span><span class="s">library/a.c</span><span class="w"> </span><span class="s">library/b.c</span><span class="w"> </span><span class="s">platform/platform.c</span>
<span class="w">                       </span><span class="s">...</span><span class="p">)</span>
</pre></div>
</div>
<p>This preference reflects the <a class="reference external" href="https://gist.github.com/mbinna/c61dbb39bca0e4fb7d1f73b0d66a4fd1/">CMake best practice</a> of manually listing source files. This could, however, be inconvenient when there are lots of source files to add to the build. The ESP-IDF build system provides an alternative way for specifying source files using <code class="docutils literal notranslate"><span class="pre">SRC_DIRS</span></code>:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">idf_component_register</span><span class="p">(</span><span class="s">SRC_DIRS</span><span class="w"> </span><span class="s">library</span><span class="w"> </span><span class="s">platform</span>
<span class="w">                       </span><span class="s">...</span><span class="p">)</span>
</pre></div>
</div>
<p>This uses globbing behind the scenes to find source files in the specified directories. Be aware, however, that if a new source file is added and this method is used, then CMake won't know to automatically re-run and this file won't be added to the build.</p>
<p>The trade-off is acceptable when you're adding the file yourself, because you can trigger a clean build or run <code class="docutils literal notranslate"><span class="pre">idf.py</span> <span class="pre">reconfigure</span></code> to manually re-run <a class="reference external" href="https://cmake.org">CMake</a>. However, the problem gets harder when you share your project with others who may check out a new version using a source control tool like Git...</p>
<p>For components which are part of ESP-IDF, we use a third party Git CMake integration module (<a class="reference external" href="https://github.com/espressif/esp-idf/blob/v5.4.2/tools/cmake/third_party/GetGitRevisionDescription.cmake">/tools/cmake/third_party/GetGitRevisionDescription.cmake</a>) which automatically re-runs CMake any time the repository commit changes. This means if you check out a new ESP-IDF version, CMake will automatically rerun.</p>
<p>For project components (not part of ESP-IDF), there are a few different options:</p>
<ul class="simple">
<li><p>If keeping your project file in Git, ESP-IDF will automatically track the Git revision and re-run CMake if the revision changes.</p></li>
<li><p>If some components are kept in a third git repository (not the project repository or ESP-IDF repository), you can add a call to the <code class="docutils literal notranslate"><span class="pre">git_describe</span></code> function in a component CMakeLists file in order to automatically trigger re-runs of CMake when the Git revision changes.</p></li>
<li><p>If not using Git, remember to manually run <code class="docutils literal notranslate"><span class="pre">idf.py</span> <span class="pre">reconfigure</span></code> whenever a source file may change.</p></li>
<li><p>To avoid this problem entirely, use <code class="docutils literal notranslate"><span class="pre">SRCS</span></code> argument to <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code> to list all source files in project components.</p></li>
</ul>
<p>The best option will depend on your particular project and its users.</p>
</section>
<section id="build-system-metadata">
<span id="id7"></span><h2>Build System Metadata<a class="headerlink" href="#build-system-metadata" title="Permalink to this heading"></a></h2>
<p>For integration into IDEs and other build systems, when CMake runs the build process generates a number of metadata files in the <code class="docutils literal notranslate"><span class="pre">build/</span></code> directory. To regenerate these files, run <code class="docutils literal notranslate"><span class="pre">cmake</span></code> or <code class="docutils literal notranslate"><span class="pre">idf.py</span> <span class="pre">reconfigure</span></code> (or any other <code class="docutils literal notranslate"><span class="pre">idf.py</span></code> build command).</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">compile_commands.json</span></code> is a standard format JSON file which describes every source file which is compiled in the project. A CMake feature generates this file, and many IDEs know how to parse it.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">project_description.json</span></code> contains some general information about the ESP-IDF project, configured paths, etc.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flasher_args.json</span></code> contains esptool.py arguments to flash the project's binary files. There are also <code class="docutils literal notranslate"><span class="pre">flash_*_args</span></code> files which can be used directly with esptool.py. See <a class="reference internal" href="#flash-arguments">Flash arguments</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CMakeCache.txt</span></code> is the CMake cache file which contains other information about the CMake process, toolchain, etc.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">config/sdkconfig.json</span></code> is a JSON-formatted version of the project configuration values.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">config/kconfig_menus.json</span></code> is a JSON-formatted version of the menus shown in menuconfig, for use in external IDE UIs.</p></li>
</ul>
<section id="json-configuration-server">
<h3>JSON Configuration Server<a class="headerlink" href="#json-configuration-server" title="Permalink to this heading"></a></h3>
<p>A tool called <code class="docutils literal notranslate"><span class="pre">kconfserver</span></code> is provided to allow IDEs to easily integrate with the configuration system logic. <code class="docutils literal notranslate"><span class="pre">kconfserver</span></code> is designed to run in the background and interact with a calling process by reading and writing JSON over process stdin &amp; stdout.</p>
<p>You can run <code class="docutils literal notranslate"><span class="pre">kconfserver</span></code> from a project via <code class="docutils literal notranslate"><span class="pre">idf.py</span> <span class="pre">confserver</span></code> or <code class="docutils literal notranslate"><span class="pre">ninja</span> <span class="pre">kconfserver</span></code>, or a similar target triggered from a different build generator.</p>
<p>For more information about <code class="docutils literal notranslate"><span class="pre">kconfserver</span></code>, see the <a class="reference external" href="https://docs.espressif.com/projects/esp-idf-kconfig/en/latest/kconfserver/index.html">esp-idf-kconfig documentation</a>.</p>
</section>
</section>
<section id="build-system-internals">
<h2>Build System Internals<a class="headerlink" href="#build-system-internals" title="Permalink to this heading"></a></h2>
<section id="build-scripts">
<h3>Build Scripts<a class="headerlink" href="#build-scripts" title="Permalink to this heading"></a></h3>
<p>The listfiles for the ESP-IDF build system reside in <a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/tools/cmake">/tools/cmake</a>. The modules which implement core build system functionality are as follows:</p>
<blockquote>
<div><blockquote>
<div><ul class="simple">
<li><p>build.cmake - Build related commands i.e., build initialization, retrieving/setting build properties, build processing.</p></li>
<li><p>component.cmake - Component related commands i.e., adding components, retrieving/setting component properties, registering components.</p></li>
<li><p>kconfig.cmake - Generation of configuration files (sdkconfig, sdkconfig.h, sdkconfig.cmake, etc.) from Kconfig files.</p></li>
<li><p>ldgen.cmake - Generation  of  final linker script from linker fragment files.</p></li>
<li><p>target.cmake - Setting build target and toolchain file.</p></li>
<li><p>utilities.cmake - Miscellaneous helper commands.</p></li>
</ul>
</div></blockquote>
<p>Aside from these files, there are two other important CMake scripts in <a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/tools/cmake">/tools/cmake</a>:</p>
<blockquote>
<div><ul class="simple">
<li><p>idf.cmake - Sets up the build and includes the core modules listed above. Included in CMake projects in order to access ESP-IDF build system functionality.</p></li>
<li><p>project.cmake - Includes <code class="docutils literal notranslate"><span class="pre">idf.cmake</span></code> and provides a custom <code class="docutils literal notranslate"><span class="pre">project()</span></code> command that takes care of all the heavy lifting of building an executable. Included in the top-level CMakeLists.txt of standard ESP-IDF projects.</p></li>
</ul>
</div></blockquote>
</div></blockquote>
<p>The rest of the files in <a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/tools/cmake">/tools/cmake</a> are support or third-party scripts used in the build process.</p>
</section>
<section id="build-process">
<h3>Build Process<a class="headerlink" href="#build-process" title="Permalink to this heading"></a></h3>
<p>This section describes the standard ESP-IDF application build process. The build process can be broken down roughly into four phases:</p>
<figure class="align-center" id="id8">
<div class="align-default"><a class="reference internal image-reference" href="../_images/blockdiag-8d794a0b03e526ebdb5af851801dafc5ae10fb49.png"><img height="120.0" src="../_images/blockdiag-8d794a0b03e526ebdb5af851801dafc5ae10fb49.png" width="832.0" /></a></div>
<figcaption>
<p><span class="caption-text">ESP-IDF Build System Process</span><a class="headerlink" href="#id8" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<section id="initialization">
<h4>Initialization<a class="headerlink" href="#initialization" title="Permalink to this heading"></a></h4>
<p>This phase sets up necessary parameters for the build.</p>
<blockquote>
<div><blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>Upon inclusion of <code class="docutils literal notranslate"><span class="pre">idf.cmake</span></code> in <code class="docutils literal notranslate"><span class="pre">project.cmake</span></code>, the following steps are performed:</dt><dd><ul>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">IDF_PATH</span></code> from environment variable or inferred from path to <code class="docutils literal notranslate"><span class="pre">project.cmake</span></code> included in the top-level CMakeLists.txt.</p></li>
<li><p>Add <a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/tools/cmake">/tools/cmake</a> to <code class="docutils literal notranslate"><span class="pre">CMAKE_MODULE_PATH</span></code> and include core modules plus the various helper/third-party scripts.</p></li>
<li><p>Set build tools/executables such as default Python interpreter.</p></li>
<li><p>Get ESP-IDF git revision and store as <code class="docutils literal notranslate"><span class="pre">IDF_VER</span></code>.</p></li>
<li><p>Set global build specifications i.e., compile options, compile definitions, include directories for all components in the build.</p></li>
<li><p>Add components in <a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/components">components</a> to the build.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>The initial part of the custom <code class="docutils literal notranslate"><span class="pre">project()</span></code> command performs the following steps:</dt><dd><ul>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">IDF_TARGET</span></code> from environment variable or CMake cache and the corresponding <code class="docutils literal notranslate"><span class="pre">CMAKE_TOOLCHAIN_FILE</span></code> to be used.</p></li>
<li><p>Add components in <code class="docutils literal notranslate"><span class="pre">EXTRA_COMPONENT_DIRS</span></code> to the build.</p></li>
<li><p>Prepare arguments for calling command <code class="docutils literal notranslate"><span class="pre">idf_build_process()</span></code> from variables such as <code class="docutils literal notranslate"><span class="pre">COMPONENTS</span></code>/<code class="docutils literal notranslate"><span class="pre">EXCLUDE_COMPONENTS</span></code>, <code class="docutils literal notranslate"><span class="pre">SDKCONFIG</span></code>, <code class="docutils literal notranslate"><span class="pre">SDKCONFIG_DEFAULTS</span></code>.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p>The call to <code class="docutils literal notranslate"><span class="pre">idf_build_process()</span></code> command marks the end of this phase.</p>
</div></blockquote>
</section>
<section id="enumeration">
<h4>Enumeration<a class="headerlink" href="#enumeration" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>This phase builds a final list of components to be processed in the build, and is performed in the first half of <code class="docutils literal notranslate"><span class="pre">idf_build_process()</span></code>.</p>
<blockquote>
<div><ul class="simple">
<li><p>Retrieve each component's public and private requirements. A child process is created which executes each component's CMakeLists.txt in script mode. The values of <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code> REQUIRES and PRIV_REQUIRES argument is returned to the parent build process. This is called early expansion. The variable <code class="docutils literal notranslate"><span class="pre">CMAKE_BUILD_EARLY_EXPANSION</span></code> is defined during this step.</p></li>
<li><p>Recursively include components based on public and private requirements.</p></li>
<li><p>Unless IDF Component Manager is disabled, it is called to resolve the dependencies of the components:
- Looks for manifests and dependencies contained in the project.
- Starts the version solving process to resolve the dependencies of the components.
- When the version solving process succeeds, the IDF Component Manager downloads dependencies, integrates them into the build, and creates a <code class="docutils literal notranslate"><span class="pre">dependencies.lock</span></code> file that contains a list of the exact versions of the dependencies installed by the IDF Component Manager.</p></li>
</ul>
</div></blockquote>
</div></blockquote>
</section>
<section id="processing">
<h4>Processing<a class="headerlink" href="#processing" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>This phase processes the components in the build, and is the second half of <code class="docutils literal notranslate"><span class="pre">idf_build_process()</span></code>.</p>
<ul class="simple">
<li><p>Load project configuration from sdkconfig file and generate an sdkconfig.cmake and sdkconfig.h header. These define configuration variables/macros that are accessible from the build scripts and C/C++ source/header files, respectively.</p></li>
<li><p>Include each component's <code class="docutils literal notranslate"><span class="pre">project_include.cmake</span></code>.</p></li>
<li><p>Add each component as a subdirectory, processing its CMakeLists.txt. The component CMakeLists.txt calls the registration command, <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code> which adds source files, include directories, creates component library, links dependencies, etc.</p></li>
</ul>
</div></blockquote>
</section>
<section id="finalization">
<h4>Finalization<a class="headerlink" href="#finalization" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>This phase is everything after <code class="docutils literal notranslate"><span class="pre">idf_build_process()</span></code>.</p>
<ul class="simple">
<li><p>Create executable and link the component libraries to it.</p></li>
<li><p>Generate project metadata files such as project_description.json and display relevant information about the project built.</p></li>
</ul>
</div></blockquote>
<p>Browse <a class="reference external" href="https://github.com/espressif/esp-idf/blob/v5.4.2/tools/cmake/project.cmake">/tools/cmake/project.cmake</a> for more details.</p>
</section>
</section>
</section>
<section id="migrating-from-esp-idf-gnu-make-system">
<span id="migrating-from-make"></span><h2>Migrating from ESP-IDF GNU Make System<a class="headerlink" href="#migrating-from-esp-idf-gnu-make-system" title="Permalink to this heading"></a></h2>
<p>Some aspects of the CMake-based ESP-IDF build system are very similar to the older GNU Make-based system. The developer needs to provide values the include directories, source files etc. There is a syntactical difference, however, as the developer needs to pass these as arguments to the registration command, <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code>.</p>
<section id="automatic-conversion-tool">
<h3>Automatic Conversion Tool<a class="headerlink" href="#automatic-conversion-tool" title="Permalink to this heading"></a></h3>
<p>An automatic project conversion tool is available in <cite>tools/cmake/convert_to_cmake.py</cite> in ESP-IDF v4.x releases. The script was removed in v5.0 because of its <cite>make</cite> build system dependency.</p>
</section>
<section id="no-longer-available-in-cmake">
<h3>No Longer Available in CMake<a class="headerlink" href="#no-longer-available-in-cmake" title="Permalink to this heading"></a></h3>
<p>Some features are significantly different or removed in the CMake-based system. The following variables no longer exist in the CMake-based build system:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">COMPONENT_BUILD_DIR</span></code>: Use <code class="docutils literal notranslate"><span class="pre">CMAKE_CURRENT_BINARY_DIR</span></code> instead.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COMPONENT_LIBRARY</span></code>: Defaulted to <code class="docutils literal notranslate"><span class="pre">$(COMPONENT_NAME).a</span></code>, but the library name could be overridden by the component. The name of the component library can no longer be overridden by the component.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CC</span></code>, <code class="docutils literal notranslate"><span class="pre">LD</span></code>, <code class="docutils literal notranslate"><span class="pre">AR</span></code>, <code class="docutils literal notranslate"><span class="pre">OBJCOPY</span></code>: Full paths to each tool from the gcc xtensa cross-toolchain. Use <code class="docutils literal notranslate"><span class="pre">CMAKE_C_COMPILER</span></code>, <code class="docutils literal notranslate"><span class="pre">CMAKE_C_LINK_EXECUTABLE</span></code>, <code class="docutils literal notranslate"><span class="pre">CMAKE_OBJCOPY</span></code>, etc instead. <a class="reference external" href="https://cmake.org/cmake/help/v3.16/manual/cmake-variables.7.html#variables-for-languages">Full list here</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HOSTCC</span></code>, <code class="docutils literal notranslate"><span class="pre">HOSTLD</span></code>, <code class="docutils literal notranslate"><span class="pre">HOSTAR</span></code>: Full names of each tool from the host native toolchain. These are no longer provided, external projects should detect any required host toolchain manually.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COMPONENT_ADD_LDFLAGS</span></code>: Used to override linker flags. Use the CMake <a class="reference external" href="https://cmake.org/cmake/help/v3.16/command/target_link_libraries.html#command:target_link_libraries">target_link_libraries</a> command instead.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COMPONENT_ADD_LINKER_DEPS</span></code>: List of files that linking should depend on. <a class="reference external" href="https://cmake.org/cmake/help/v3.16/command/target_link_libraries.html#command:target_link_libraries">target_link_libraries</a> will usually infer these dependencies automatically. For linker scripts, use the provided custom CMake function <code class="docutils literal notranslate"><span class="pre">target_linker_scripts</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COMPONENT_SUBMODULES</span></code>: No longer used, the build system will automatically enumerate all submodules in the ESP-IDF repository.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COMPONENT_EXTRA_INCLUDES</span></code>: Used to be an alternative to <code class="docutils literal notranslate"><span class="pre">COMPONENT_PRIV_INCLUDEDIRS</span></code> for absolute paths. Use <code class="docutils literal notranslate"><span class="pre">PRIV_INCLUDE_DIRS</span></code> argument to <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code> for all cases now (can be relative or absolute).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COMPONENT_OBJS</span></code>: Previously, component sources could be specified as a list of object files. Now they can be specified as a list of source files via <code class="docutils literal notranslate"><span class="pre">SRCS</span></code> argument to <cite>idf_component_register</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COMPONENT_OBJEXCLUDE</span></code>: Has been replaced with <code class="docutils literal notranslate"><span class="pre">EXCLUDE_SRCS</span></code> argument to <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code>. Specify source files (as absolute paths or relative to component directory), instead.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COMPONENT_EXTRA_CLEAN</span></code>: Set property <code class="docutils literal notranslate"><span class="pre">ADDITIONAL_CLEAN_FILES</span></code> instead but note <a class="reference internal" href="#additional-clean-files-note"><span class="std std-ref">CMake has some restrictions around this functionality</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COMPONENT_OWNBUILDTARGET</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">COMPONENT_OWNCLEANTARGET</span></code>: Use CMake <a class="reference external" href="https://cmake.org/cmake/help/v3.16/module/ExternalProject.html">ExternalProject</a> instead. See <a class="reference internal" href="#component-build-full-override"><span class="std std-ref">Fully Overriding the Component Build Process</span></a> for full details.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COMPONENT_CONFIG_ONLY</span></code>: Call <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code> without any arguments instead. See <a class="reference internal" href="#configuration-only-components">Configuration-Only Components</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CFLAGS</span></code>, <code class="docutils literal notranslate"><span class="pre">CPPFLAGS</span></code>, <code class="docutils literal notranslate"><span class="pre">CXXFLAGS</span></code>: Use equivalent CMake commands instead. See <a class="reference internal" href="#controlling-component-compilation">Controlling Component Compilation</a>.</p></li>
</ul>
</section>
<section id="no-default-values">
<h3>No Default Values<a class="headerlink" href="#no-default-values" title="Permalink to this heading"></a></h3>
<p>Unlike in the legacy Make-based build system, the following have no default values:</p>
<ul class="simple">
<li><p>Source directories (<code class="docutils literal notranslate"><span class="pre">COMPONENT_SRCDIRS</span></code> variable in Make, <code class="docutils literal notranslate"><span class="pre">SRC_DIRS</span></code> argument to <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code> in CMake)</p></li>
<li><p>Include directories (<code class="docutils literal notranslate"><span class="pre">COMPONENT_ADD_INCLUDEDIRS</span></code> variable in Make, <code class="docutils literal notranslate"><span class="pre">INCLUDE_DIRS</span></code> argument to <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code> in CMake)</p></li>
</ul>
</section>
<section id="no-longer-necessary">
<h3>No Longer Necessary<a class="headerlink" href="#no-longer-necessary" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>In the legacy Make-based build system, it is required to also set <code class="docutils literal notranslate"><span class="pre">COMPONENT_SRCDIRS</span></code> if <code class="docutils literal notranslate"><span class="pre">COMPONENT_SRCS</span></code> is set. In CMake, the equivalent is not necessary i.e., specifying <code class="docutils literal notranslate"><span class="pre">SRC_DIRS</span></code> to <code class="docutils literal notranslate"><span class="pre">idf_component_register</span></code> if <code class="docutils literal notranslate"><span class="pre">SRCS</span></code> is also specified (in fact, <code class="docutils literal notranslate"><span class="pre">SRCS</span></code> is ignored if <code class="docutils literal notranslate"><span class="pre">SRC_DIRS</span></code> is specified).</p></li>
</ul>
</section>
<section id="flashing-from-make">
<h3>Flashing from Make<a class="headerlink" href="#flashing-from-make" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">flash</span></code> and similar targets still work to build and flash. However, project <code class="docutils literal notranslate"><span class="pre">sdkconfig</span></code> no longer specifies serial port and baud rate. Environment variables can be used to override these. See <a class="reference internal" href="#flash-with-ninja-or-make"><span class="std std-ref">Flashing with Ninja or Make</span></a> for more details.</p>
</section>
<section id="application-examples">
<h3>Application Examples<a class="headerlink" href="#application-examples" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/examples/build_system/wrappers">build_system/wrappers</a> demonstrates how to use a linker feature to redefine or override any public function in both ESP-IDF and the bootloader, allowing modification or extension of a function's default behavior.</p></li>
<li><p><a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/examples/custom_bootloader/bootloader_override">custom_bootloader/bootloader_override</a> demonstrates how to override the second stage bootloader from a regular project, providing a custom bootloader that prints an extra message on startup, with the ability to conditionally override the bootloader based on certain conditions like target-dependency or KConfig options.</p></li>
<li><p><a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/examples/build_system/cmake/import_lib">build_system/cmake/import_lib</a> demonstrates how to import and use third-party libraries using ExternalProject CMake module.</p></li>
<li><p><a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/examples/build_system/cmake/import_prebuilt">build_system/cmake/import_prebuilt</a> demonstrates how to import a prebuilt static library into the ESP-IDF build system, build a component with dependencies, and link it to the main component, ultimately outputting the current running partition.</p></li>
<li><p><a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/examples/build_system/cmake/idf_as_lib">build_system/cmake/idf_as_lib</a> demonstrates the creation of an application equivalent to <a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/examples/get-started/hello_world">hello world application </a> using a custom CMake project.</p></li>
<li><p><a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/examples/build_system/cmake/multi_config">build_system/cmake/multi_config</a> demonstrates how to build multiple configurations of a single application from a single codebase, it is useful for creating binaries for multiple similar products.</p></li>
<li><p><a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/examples/build_system/cmake/plugins">build_system/cmake/plugins</a> demonstrates features of the ESP-IDF build system related to link time registration of plugins, allowing you to add multiple implementations of a certain feature without the need to make the application aware of all these implementations.</p></li>
</ul>
</section>
</section>
</section>

    <script type="text/javascript">
        function init() {
            WaveDrom.ProcessAll();
        }
        window.onload = init;
    </script>

           </div>
             <div class="articleComments">

<style>
    .expand-feedback-content {
        display: none;
    }
    .click-like-or-dislike {
        background-color: #d3d3d3;
        pointer-events: none;
    }
</style>

<script>
    function submitFeedbackForm(user_likes_document) {
        // Send to GA4 the user reaction
        gtag('event', 'user_reaction', {
            'user_likes_document': user_likes_document
        });

        if (user_likes_document === 1) {
            document.querySelector('.like-btn').classList.add('click-like-or-dislike');
            document.getElementById("expandContentLike").style.display = 'block';
        } else {
            document.querySelector('.dislike-btn').classList.add('click-like-or-dislike');
            document.getElementById("expandContent").style.display = 'block';
        }

        document.querySelector('.like-btn').style.pointerEvents = 'none';
        document.querySelector('.dislike-btn').style.pointerEvents = 'none';
    }
</script>

<hr>

<p style="text-align:center"><strong>Was this page helpful?</strong></p>
<p style="text-align:center">
    <button class="like-btn" onclick="submitFeedbackForm(1)">
        <svg aria-hidden="true" focusable="false" class="color-fg-muted" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom;overflow:visible">
            <path d="M8.834.066c.763.087 1.5.295 2.01.884.505.581.656 1.378.656 2.3 0 .467-.087 1.119-.157 1.637L11.328 5h1.422c.603 0 1.174.085 1.668.333.508.254.911.679 1.137 1.2.453.998.438 2.447.188 4.316l-.04.306c-.105.79-.195 1.473-.313 2.033-.131.63-.315 1.209-.668 1.672C13.97 15.847 12.706 16 11 16c-1.848 0-3.234-.333-4.388-.653-.165-.045-.323-.09-.475-.133-.658-.186-1.2-.34-1.725-.415A1.75 1.75 0 0 1 2.75 16h-1A1.75 1.75 0 0 1 0 14.25v-7.5C0 5.784.784 5 1.75 5h1a1.75 1.75 0 0 1 1.514.872c.258-.105.59-.268.918-.508C5.853 4.874 6.5 4.079 6.5 2.75v-.5c0-1.202.994-2.337 2.334-2.184ZM4.5 13.3c.705.088 1.39.284 2.072.478l.441.125c1.096.305 2.334.598 3.987.598 1.794 0 2.28-.223 2.528-.549.147-.193.276-.505.394-1.07.105-.502.188-1.124.295-1.93l.04-.3c.25-1.882.189-2.933-.068-3.497a.921.921 0 0 0-.442-.48c-.208-.104-.52-.174-.997-.174H11c-.686 0-1.295-.577-1.206-1.336.023-.192.05-.39.076-.586.065-.488.13-.97.13-1.328 0-.809-.144-1.15-.288-1.316-.137-.158-.402-.304-1.048-.378C8.357 1.521 8 1.793 8 2.25v.5c0 1.922-.978 3.128-1.933 3.825a5.831 5.831 0 0 1-1.567.81ZM2.75 6.5h-1a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h1a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
        </svg>
    </button>
    <button class="dislike-btn" onclick="submitFeedbackForm(0)">
        <svg aria-hidden="true" focusable="false" class="" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom;overflow:visible">
            <path d="M7.083 15.986c-.763-.087-1.499-.295-2.011-.884-.504-.581-.655-1.378-.655-2.299 0-.468.087-1.12.157-1.638l.015-.112H3.167c-.603 0-1.174-.086-1.669-.334a2.415 2.415 0 0 1-1.136-1.2c-.454-.998-.438-2.447-.188-4.316l.04-.306C.32 4.108.41 3.424.526 2.864c.132-.63.316-1.209.669-1.672C1.947.205 3.211.053 4.917.053c1.848 0 3.234.332 4.388.652l.474.133c.658.187 1.201.341 1.726.415a1.75 1.75 0 0 1 1.662-1.2h1c.966 0 1.75.784 1.75 1.75v7.5a1.75 1.75 0 0 1-1.75 1.75h-1a1.75 1.75 0 0 1-1.514-.872c-.259.105-.59.268-.919.508-.671.491-1.317 1.285-1.317 2.614v.5c0 1.201-.994 2.336-2.334 2.183Zm4.334-13.232c-.706-.089-1.39-.284-2.072-.479l-.441-.125c-1.096-.304-2.335-.597-3.987-.597-1.794 0-2.28.222-2.529.548-.147.193-.275.505-.393 1.07-.105.502-.188 1.124-.295 1.93l-.04.3c-.25 1.882-.19 2.933.067 3.497a.923.923 0 0 0 .443.48c.208.104.52.175.997.175h1.75c.685 0 1.295.577 1.205 1.335-.022.192-.049.39-.075.586-.066.488-.13.97-.13 1.329 0 .808.144 1.15.288 1.316.137.157.401.303 1.048.377.307.035.664-.237.664-.693v-.5c0-1.922.978-3.127 1.932-3.825a5.878 5.878 0 0 1 1.568-.809Zm1.75 6.798h1a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25h-1a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25Z"></path>
        </svg>
    </button>
</p>

<div class="expand-feedback-content" id="expandContentLike">
    <ul style="text-align:center">
        <li>Thank you! We received your feedback.</li>
        <li>If you have any comments, fill in <a href='https://www.espressif.com/en/company/documents/documentation_feedback?docId=4287&sections=Build System (api-guides/build-system)&version=esp32 v5.4.2 (v5.4.2)'>Espressif Documentation Feedback Form</a>.</li>
    </ul>
</div>

<div class="expand-feedback-content" id="expandContent">
    <ul style="text-align:center">
        <li>We value your feedback.</li>
        <li>Let us know how we can improve this page by filling in <a href='https://www.espressif.com/en/company/documents/documentation_feedback?docId=4287&sections=Build System (api-guides/build-system)&version=esp32 v5.4.2 (v5.4.2)'>Espressif Documentation Feedback Form</a>.</li>
    </ul>
</div>

<br>


             </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="bootloader.html" class="btn btn-neutral float-left" title="Bootloader" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="coexist.html" class="btn btn-neutral float-right" title="RF Coexistence" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016 - 2025, Espressif Systems (Shanghai) Co., Ltd.</p>
  </div>

  <ul class="footer">
        <li>
	    
            
            Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/espressif/sphinx_idf_theme">theme</a>  based on <a href="https://github.com/readthedocs/sphinx_rtd_theme">Read the Docs Sphinx Theme</a>.
         </li>
    <li class="footer-aside">
        <a href="../esp-idf-en-v5.4.2.zip"> Download HTML</a>
    </li>

  </ul> 

</footer>
        </div>
      </div>
    </section>
  </div>

  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>