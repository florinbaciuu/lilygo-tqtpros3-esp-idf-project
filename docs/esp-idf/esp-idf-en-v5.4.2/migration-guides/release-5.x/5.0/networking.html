<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-73KGWFC8DM"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-73KGWFC8DM');
        </script><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Networking - ESP32 -  &mdash; ESP-IDF Programming Guide v5.4.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=a60756f2" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=949a1ff5" />
      <link rel="stylesheet" type="text/css" href="../../../_static/theme_overrides.css?v=851bd809" />

  
    <link rel="canonical" href="https://docs.espressif.com/projects/esp-idf/en/stable/esp32/migration-guides/release-5.x/5.0/networking.html" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=c241bbaf"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../../_static/copybutton.js?v=ff8fa330"></script>
        <script src="https://wavedrom.com/skins/default.js"></script>
        <script src="https://wavedrom.com/wavedrom.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>

    
        

    <script type="text/javascript">
        DOCUMENTATION_OPTIONS.PAGENAME = 'migration-guides/release-5.x/5.0/networking';
        DOCUMENTATION_OPTIONS.PROJECT_SLUG = 'esp-idf';
        DOCUMENTATION_OPTIONS.LATEST_BRANCH_NAME = 'master';
        DOCUMENTATION_OPTIONS.VERSIONS_URL = 'https://dl.espressif.com/dl/esp-idf/idf_versions.js';
        DOCUMENTATION_OPTIONS.LANGUAGES = ["en", "zh_CN"];
        DOCUMENTATION_OPTIONS.IDF_TARGET = 'esp32';
        DOCUMENTATION_OPTIONS.HAS_IDF_TARGETS = ["esp32", "esp32s2", "esp32s3", "esp32c3", "esp32c2", "esp32c5", "esp32c6", "esp32p4"]
        DOCUMENTATION_OPTIONS.RELEASE = 'v5.4.2';
        DOCUMENTATION_OPTIONS.LANGUAGE_URL = 'en';

    </script>

    <script type="text/javascript" src="https://dl.espressif.com/dl/esp-idf/idf_versions.js"></script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Peripherals" href="peripherals.html" />
    <link rel="prev" title="GCC" href="gcc.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            ESP-IDF Programming Guide
              <img src="../../../_static/espressif-logo.svg" class="logo" alt="Logo"/>
          </a>

          
            <div class="selectors">
              <select id="target-select" style="width: 150px;" hidden>
                <option value="" disabled selected>Choose target...</option>
              </select>
            </div>
          

          <div class="selectors">
            <select id="version-select" style="width: 150px;" hidden>
              <option value="" disabled selected>Choose version...</option>
            </select>
          </div>

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../get-started/index.html">Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api-reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hw-reference/index.html">Hardware Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api-guides/index.html">API Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/index.html">Security Guides</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Migration Guides</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html#esp-idf-5-x-migration-guide">ESP-IDF 5.x Migration Guide</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Migration from 4.4 to 5.0</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="bluetooth-classic.html">Bluetooth Classic</a></li>
<li class="toctree-l4"><a class="reference internal" href="bluetooth-low-energy.html">Bluetooth Low Energy</a></li>
<li class="toctree-l4"><a class="reference internal" href="build-system.html">Build System</a></li>
<li class="toctree-l4"><a class="reference internal" href="gcc.html">GCC</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Networking</a></li>
<li class="toctree-l4"><a class="reference internal" href="peripherals.html">Peripherals</a></li>
<li class="toctree-l4"><a class="reference internal" href="protocols.html">Protocols</a></li>
<li class="toctree-l4"><a class="reference internal" href="provisioning.html">Provisioning</a></li>
<li class="toctree-l4"><a class="reference internal" href="removed-components.html">Removed or Deprecated Components</a></li>
<li class="toctree-l4"><a class="reference internal" href="storage.html">Storage</a></li>
<li class="toctree-l4"><a class="reference internal" href="system.html">System</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools.html">Tools</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../5.1/index.html">Migration from 5.0 to 5.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../5.2/index.html">Migration from 5.1 to 5.2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../5.3/index.html">Migration from 5.2 to 5.3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../5.4/index.html">Migration from 5.3 to 5.4</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../libraries-and-frameworks/index.html">Libraries and Frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute/index.html">Contributions Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../versions.html">ESP-IDF Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../COPYRIGHT.html">Copyrights and Licenses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../languages.html">Switch Between Languages</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ESP-IDF Programming Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Migration Guides</a></li>
          <li class="breadcrumb-item"><a href="index.html">Migration from 4.4 to 5.0</a></li>
      <li class="breadcrumb-item active">Networking</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/espressif/esp-idf/blob/v5.4.2/docs/en/migration-guides/release-5.x/5.0/networking.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="networking">
<h1>Networking<a class="headerlink" href="#networking" title="Permalink to this heading"></a></h1>
<p><a class="reference external" href="../../../../../../zh_CN/v5.4.2/esp32/migration-guides/release-5.x/5.0/networking.html">[中文]</a></p>
<section id="wi-fi">
<h2>Wi-Fi<a class="headerlink" href="#wi-fi" title="Permalink to this heading"></a></h2>
<section id="callback-function-type-esp-now-recv-cb-t">
<h3>Callback Function Type <code class="docutils literal notranslate"><span class="pre">esp_now_recv_cb_t</span></code><a class="headerlink" href="#callback-function-type-esp-now-recv-cb-t" title="Permalink to this heading"></a></h3>
<p>Previously, the first parameter of <code class="docutils literal notranslate"><span class="pre">esp_now_recv_cb_t</span></code> was of type <code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">uint8_t</span> <span class="pre">*mac_addr</span></code>, which only included the address of ESP-NOW peer device.</p>
<p>This now changes. The first parameter is of type <code class="docutils literal notranslate"><span class="pre">esp_now_recv_info_t</span></code>, which has members <code class="docutils literal notranslate"><span class="pre">src_addr</span></code>, <code class="docutils literal notranslate"><span class="pre">des_addr</span></code> and <code class="docutils literal notranslate"><span class="pre">rx_ctrl</span></code>. Therefore, the following updates are required:</p>
<blockquote>
<div><ul class="simple">
<li><p>Redefine ESP-NOW receive callback function.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src_addr</span></code> can be used to replace original <code class="docutils literal notranslate"><span class="pre">mac_addr</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">des_addr</span></code> is the destination MAC address of ESP-NOW packet, which can be unitcast or broadcast address. With <code class="docutils literal notranslate"><span class="pre">des_addr</span></code>, the user can distinguish unitcast and broadcast ESP-NOW packets where broadcast ESP-NOW packets can be non-encrypted even when encryption policy is configured for the ESP-NOW.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rx_ctrl</span></code> is Rx control info of the ESP-NOW packet, which provides more information about the packet.</p></li>
</ul>
</div></blockquote>
<p>Please refer to the ESP-NOW example: <a class="reference external" href="https://github.com/espressif/esp-idf/blob/v5.4.2/examples/wifi/espnow/main/espnow_example_main.c">wifi/espnow/main/espnow_example_main.c</a></p>
</section>
</section>
<section id="ethernet">
<h2>Ethernet<a class="headerlink" href="#ethernet" title="Permalink to this heading"></a></h2>
<section id="esp-eth-ioctl-api">
<h3><code class="docutils literal notranslate"><span class="pre">esp_eth_ioctl()</span></code> API<a class="headerlink" href="#esp-eth-ioctl-api" title="Permalink to this heading"></a></h3>
<p>Previously, the <a class="reference internal" href="../../../api-reference/network/esp_eth.html#_CPPv413esp_eth_ioctl16esp_eth_handle_t16esp_eth_io_cmd_tPv" title="esp_eth_ioctl"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_eth_ioctl()</span></code></a> API had the following issues:</p>
<blockquote>
<div><ul class="simple">
<li><p>The third parameter (which is of type <code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span></code>) would accept an <code class="docutils literal notranslate"><span class="pre">int</span></code>/<code class="docutils literal notranslate"><span class="pre">bool</span></code> type arguments (i.e., not pointers) as input in some cases. However, these cases were not documented properly.</p></li>
<li><p>To pass <code class="docutils literal notranslate"><span class="pre">int</span></code>/<code class="docutils literal notranslate"><span class="pre">bool</span></code> type argument as the third parameter, the argument had to be &quot;unnaturally&quot; casted to a <code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*</span></code> type, to prevent a compiler warning as demonstrated in the code snippet below. This casting could lead to misuse of the <a class="reference internal" href="../../../api-reference/network/esp_eth.html#_CPPv413esp_eth_ioctl16esp_eth_handle_t16esp_eth_io_cmd_tPv" title="esp_eth_ioctl"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_eth_ioctl()</span></code></a> function.</p></li>
</ul>
</div></blockquote>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">esp_eth_ioctl</span><span class="p">(</span><span class="n">eth_handle</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_CMD_S_FLOW_CTRL</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nb">true</span><span class="p">);</span>
</pre></div>
</div>
<p>Therefore, the usage of <a class="reference internal" href="../../../api-reference/network/esp_eth.html#_CPPv413esp_eth_ioctl16esp_eth_handle_t16esp_eth_io_cmd_tPv" title="esp_eth_ioctl"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_eth_ioctl()</span></code></a> is now unified. Arguments to the third parameter must be passed as pointers to a specific data type to/from where data is stored/read by <a class="reference internal" href="../../../api-reference/network/esp_eth.html#_CPPv413esp_eth_ioctl16esp_eth_handle_t16esp_eth_io_cmd_tPv" title="esp_eth_ioctl"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_eth_ioctl()</span></code></a>. The code snippets below demonstrate the usage of <a class="reference internal" href="../../../api-reference/network/esp_eth.html#_CPPv413esp_eth_ioctl16esp_eth_handle_t16esp_eth_io_cmd_tPv" title="esp_eth_ioctl"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_eth_ioctl()</span></code></a>.</p>
<p>Usage example to set Ethernet configuration:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">eth_duplex_t</span><span class="w"> </span><span class="n">new_duplex_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ETH_DUPLEX_HALF</span><span class="p">;</span>
<span class="n">esp_eth_ioctl</span><span class="p">(</span><span class="n">eth_handle</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_CMD_S_DUPLEX_MODE</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">new_duplex_mode</span><span class="p">);</span>
</pre></div>
</div>
<p>Usage example to get Ethernet configuration:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">eth_duplex_t</span><span class="w"> </span><span class="n">duplex_mode</span><span class="p">;</span>
<span class="n">esp_eth_ioctl</span><span class="p">(</span><span class="n">eth_handle</span><span class="p">,</span><span class="w"> </span><span class="n">ETH_CMD_G_DUPLEX_MODE</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">duplex_mode</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="ksz8041-81-and-lan8720-driver-update">
<h3>KSZ8041/81 and LAN8720 Driver Update<a class="headerlink" href="#ksz8041-81-and-lan8720-driver-update" title="Permalink to this heading"></a></h3>
<p>The KSZ8041/81 and LAN8720 drivers are updated to support more devices (i.e., generations) from their associated product families. The drivers can recognize particular chip numbers and their potential support by the driver.</p>
<p>As a result, the specific &quot;chip number&quot; functions calls are replaced by generic ones as follows:</p>
<ul class="simple">
<li><p>Removed <code class="docutils literal notranslate"><span class="pre">esp_eth_phy_new_ksz8041()</span></code> and <code class="docutils literal notranslate"><span class="pre">esp_eth_phy_new_ksz8081()</span></code>, and use <a class="reference internal" href="../../../api-reference/network/esp_eth.html#_CPPv423esp_eth_phy_new_ksz80xxPK16eth_phy_config_t" title="esp_eth_phy_new_ksz80xx"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_eth_phy_new_ksz80xx()</span></code></a> instead</p></li>
<li><p>Removed <code class="docutils literal notranslate"><span class="pre">esp_eth_phy_new_lan8720()</span></code>, and use <a class="reference internal" href="../../../api-reference/network/esp_eth.html#_CPPv423esp_eth_phy_new_lan87xxPK16eth_phy_config_t" title="esp_eth_phy_new_lan87xx"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_eth_phy_new_lan87xx()</span></code></a> instead</p></li>
</ul>
</section>
<section id="esp-netif-glue-event-handlers">
<h3>ESP NETIF Glue Event Handlers<a class="headerlink" href="#esp-netif-glue-event-handlers" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">esp_eth_set_default_handlers()</span></code> and <code class="docutils literal notranslate"><span class="pre">esp_eth_clear_default_handlers()</span></code> functions are removed. Registration of the default IP layer handlers for Ethernet is now handled automatically. If you have already followed the suggestion to fully initialize the Ethernet driver and network interface before registering their Ethernet/IP event handlers, then no action is required (except for deleting the affected functions). Otherwise, you may start the Ethernet driver right after they register the user event handler.</p>
</section>
<section id="phy-address-auto-detect">
<h3>PHY Address Auto-detect<a class="headerlink" href="#phy-address-auto-detect" title="Permalink to this heading"></a></h3>
<p>The Ethernet PHY address auto-detect function <code class="docutils literal notranslate"><span class="pre">esp_eth_detect_phy_addr()</span></code> is renamed to <a class="reference internal" href="../../../api-reference/network/esp_eth.html#_CPPv433esp_eth_phy_802_3_detect_phy_addrP18esp_eth_mediator_tPi" title="esp_eth_phy_802_3_detect_phy_addr"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_eth_phy_802_3_detect_phy_addr()</span></code></a> and its header declaration is moved to <a class="reference external" href="https://github.com/espressif/esp-idf/blob/v5.4.2/components/esp_eth/include/esp_eth_phy_802_3.h">esp_eth/include/esp_eth_phy_802_3.h</a>.</p>
</section>
<section id="spi-ethernet-module-initialization">
<h3>SPI-Ethernet Module Initialization<a class="headerlink" href="#spi-ethernet-module-initialization" title="Permalink to this heading"></a></h3>
<p>The SPI-Ethernet Module initialization is now simplified. Previously, you had to manually allocate an SPI device using <a class="reference internal" href="../../../api-reference/peripherals/spi_master.html#_CPPv418spi_bus_add_device17spi_host_device_tPK29spi_device_interface_config_tP19spi_device_handle_t" title="spi_bus_add_device"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">spi_bus_add_device()</span></code></a> before instantiating the SPI-Ethernet MAC.</p>
<p>Now, you no longer need to call <a class="reference internal" href="../../../api-reference/peripherals/spi_master.html#_CPPv418spi_bus_add_device17spi_host_device_tPK29spi_device_interface_config_tP19spi_device_handle_t" title="spi_bus_add_device"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">spi_bus_add_device()</span></code></a> as SPI devices are allocated internally. As a result, the <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">eth_dm9051_config_t</span></code>, <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">eth_w5500_config_t</span></code>, and <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">eth_ksz8851snl_config_t</span></code> configuration structures are updated to include members for SPI device configuration (e.g., to allow fine tuning of SPI timing which may be dependent on PCB design). Likewise, the <code class="docutils literal notranslate"><span class="pre">ETH_DM9051_DEFAULT_CONFIG</span></code>, <code class="docutils literal notranslate"><span class="pre">ETH_W5500_DEFAULT_CONFIG</span></code>, and <code class="docutils literal notranslate"><span class="pre">ETH_KSZ8851SNL_DEFAULT_CONFIG</span></code> configuration initialization macros are updated to accept new input parameters. Refer to <a class="reference internal" href="../../../api-reference/network/esp_eth.html"><span class="doc">Ethernet API Reference Guide</span></a> for an example of SPI-Ethernet Module initialization.</p>
</section>
<section id="ethernet-driver">
<h3>Ethernet Driver<a class="headerlink" href="#ethernet-driver" title="Permalink to this heading"></a></h3>
<p>APIs for creating MAC instances (<cite>esp_eth_mac_new_*()</cite>) have been reworked to accept two parameters, instead of one common configuration. Now, the configuration includes</p>
<ul class="simple">
<li><p>Vendor specific MAC configuration</p></li>
<li><p>Ethernet driver MAC configuration</p></li>
</ul>
<p>This is applicable to internal Ethernet MAC <a class="reference internal" href="../../../api-reference/network/esp_eth.html#_CPPv421esp_eth_mac_new_esp32PK23eth_esp32_emac_config_tPK16eth_mac_config_t" title="esp_eth_mac_new_esp32"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_eth_mac_new_esp32()</span></code></a> as well as to external MAC devices, such as <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_eth_mac_new_ksz8851snl()</span></code>, <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_eth_mac_new_dm9051()</span></code>, and <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_eth_mac_new_w5500()</span></code></p>
</section>
</section>
<section id="tcp-ip-adapter">
<span id="tcpip-adapter"></span><h2>TCP/IP Adapter<a class="headerlink" href="#tcp-ip-adapter" title="Permalink to this heading"></a></h2>
<p>The TCP/IP Adapter was a network interface abstraction component used in ESP-IDF prior to v4.1. This section outlines migration from <code class="docutils literal notranslate"><span class="pre">tcpip_adapter</span></code> API to its successor <a class="reference internal" href="../../../api-reference/network/esp_netif.html"><span class="doc">ESP-NETIF</span></a>.</p>
<section id="updating-network-connection-code">
<h3>Updating Network Connection Code<a class="headerlink" href="#updating-network-connection-code" title="Permalink to this heading"></a></h3>
<section id="network-stack-initialization">
<h4>Network Stack Initialization<a class="headerlink" href="#network-stack-initialization" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>You may simply replace <code class="docutils literal notranslate"><span class="pre">tcpip_adapter_init()</span></code> with <code class="docutils literal notranslate"><span class="pre">esp_netif_init()</span></code>. However, please should note that the <code class="docutils literal notranslate"><span class="pre">esp_netif_init()</span></code> function now returns standard error codes. See <a class="reference internal" href="../../../api-reference/network/esp_netif.html"><span class="doc">ESP-NETIF</span></a> for more details.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">esp_netif_deinit()</span></code> function is provided to de-initialize the network stack.</p></li>
<li><p>You should also replace <code class="docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&quot;tcpip_adapter.h&quot;</span></code> with <code class="docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&quot;esp_netif.h&quot;</span></code>.</p></li>
</ul>
</section>
<section id="network-interface-creation">
<h4>Network Interface Creation<a class="headerlink" href="#network-interface-creation" title="Permalink to this heading"></a></h4>
<p>Previously, the TCP/IP Adapter defined the following network interfaces statically:</p>
<ul class="simple">
<li><p>WiFi Station</p></li>
<li><p>WiFi Access Point</p></li>
<li><p>Ethernet</p></li>
</ul>
<p>This now changes. Network interface instance should be explicitly constructed, so that the <a class="reference internal" href="../../../api-reference/network/esp_netif.html"><span class="doc">ESP-NETIF</span></a> can connect to the TCP/IP stack. For example, after the TCP/IP stack and the event loop are initialized, the initialization code for WiFi must explicitly call <code class="docutils literal notranslate"><span class="pre">esp_netif_create_default_wifi_sta();</span></code> or <code class="docutils literal notranslate"><span class="pre">esp_netif_create_default_wifi_ap();</span></code>.</p>
<p>Please refer to the example initialization code for these three interfaces:</p>
<ul class="simple">
<li><p>WiFi Station: <a class="reference external" href="https://github.com/espressif/esp-idf/blob/v5.4.2/examples/wifi/getting_started/station/main/station_example_main.c">wifi/getting_started/station/main/station_example_main.c</a></p></li>
<li><p>WiFi Access Point: <a class="reference external" href="https://github.com/espressif/esp-idf/blob/v5.4.2/examples/wifi/getting_started/softAP/main/softap_example_main.c">wifi/getting_started/softAP/main/softap_example_main.c</a></p></li>
<li><p>Ethernet: <a class="reference external" href="https://github.com/espressif/esp-idf/blob/v5.4.2/examples/ethernet/basic/main/ethernet_example_main.c">ethernet/basic/main/ethernet_example_main.c</a></p></li>
</ul>
</section>
<section id="other-tcpip-adapter-api-replacement">
<h4>Other <code class="docutils literal notranslate"><span class="pre">tcpip_adapter</span></code> API Replacement<a class="headerlink" href="#other-tcpip-adapter-api-replacement" title="Permalink to this heading"></a></h4>
<p>All the <code class="docutils literal notranslate"><span class="pre">tcpip_adapter</span></code> functions have their <code class="docutils literal notranslate"><span class="pre">esp-netif</span></code> counter-part. Please refer to the <code class="docutils literal notranslate"><span class="pre">esp_netif.h</span></code> grouped into these sections:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/espressif/esp-idf/blob/v5.4.2/components/esp_netif/include/esp_netif.h#L241">Setters/Getters </a></p></li>
<li><p><a class="reference external" href="https://github.com/espressif/esp-idf/blob/v5.4.2/components/esp_netif/include/esp_netif.h#L387">DHCP </a></p></li>
<li><p><a class="reference external" href="https://github.com/espressif/esp-idf/blob/v5.4.2/components/esp_netif/include/esp_netif.h#L516">DNS </a></p></li>
<li><p><a class="reference external" href="https://github.com/espressif/esp-idf/blob/v5.4.2/components/esp_netif/include/esp_netif.h#L568">IP address </a></p></li>
</ul>
<p>The TCP/IP Adapter API <code class="docutils literal notranslate"><span class="pre">tcpip_adapter_get_sta_list()</span></code> that was used to acquire a list of associated Wi-Fi stations to the Software Access Point (softAP) has been moved to the Wi-Fi component and renamed to <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_wifi_ap_get_sta_list_with_ip()</span></code>, which is a special case of the ESP-NETIF API <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_netif_dhcps_get_clients_by_mac()</span></code> that could be used more generally to provide a list of clients connected to a DHCP server no matter which network interface the server is running on.</p>
</section>
<section id="default-event-handlers">
<h4>Default Event Handlers<a class="headerlink" href="#default-event-handlers" title="Permalink to this heading"></a></h4>
<p>Event handlers are moved from <code class="docutils literal notranslate"><span class="pre">tcpip_adapter</span></code> to appropriate driver code. There is no change from application code perspective, as all events should be handled in the same way. Please note that for IP-related event handlers, application code usually receives IP addresses in the form of an <code class="docutils literal notranslate"><span class="pre">esp-netif</span></code> specific struct instead of the LwIP structs. However, both structs are binary compatible.</p>
<p>This is the preferred way to print the address:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;got ip:&quot;</span><span class="w"> </span><span class="n">IPSTR</span><span class="p">,</span><span class="w"> </span><span class="n">IP2STR</span><span class="p">(</span><span class="o">&amp;</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">ip_info</span><span class="p">.</span><span class="n">ip</span><span class="p">));</span>
</pre></div>
</div>
<p>Instead of</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">ESP_LOGI</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;got ip:%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ip4addr_ntoa</span><span class="p">(</span><span class="o">&amp;</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">ip_info</span><span class="p">.</span><span class="n">ip</span><span class="p">));</span>
</pre></div>
</div>
<p>Since <code class="docutils literal notranslate"><span class="pre">ip4addr_ntoa()</span></code> is a LwIP API, the esp-netif provides <code class="docutils literal notranslate"><span class="pre">esp_ip4addr_ntoa()</span></code> as a replacement. However, the above method using <code class="docutils literal notranslate"><span class="pre">IP2STR()</span></code> is generally preferred.</p>
</section>
<section id="ip-addresses">
<h4>IP Addresses<a class="headerlink" href="#ip-addresses" title="Permalink to this heading"></a></h4>
<p>You are advised to use <code class="docutils literal notranslate"><span class="pre">esp-netif</span></code> defined IP structures. Please note that with default compatibility enabled, the LwIP structs still work.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/espressif/esp-idf/blob/v5.4.2/components/esp_netif/include/esp_netif_ip_addr.h#L96">esp-netif IP address definitions </a></p></li>
</ul>
</section>
</section>
</section>
</section>

    <script type="text/javascript">
        function init() {
            WaveDrom.ProcessAll();
        }
        window.onload = init;
    </script>

           </div>
             <div class="articleComments">

<style>
    .expand-feedback-content {
        display: none;
    }
    .click-like-or-dislike {
        background-color: #d3d3d3;
        pointer-events: none;
    }
</style>

<script>
    function submitFeedbackForm(user_likes_document) {
        // Send to GA4 the user reaction
        gtag('event', 'user_reaction', {
            'user_likes_document': user_likes_document
        });

        if (user_likes_document === 1) {
            document.querySelector('.like-btn').classList.add('click-like-or-dislike');
            document.getElementById("expandContentLike").style.display = 'block';
        } else {
            document.querySelector('.dislike-btn').classList.add('click-like-or-dislike');
            document.getElementById("expandContent").style.display = 'block';
        }

        document.querySelector('.like-btn').style.pointerEvents = 'none';
        document.querySelector('.dislike-btn').style.pointerEvents = 'none';
    }
</script>

<hr>

<p style="text-align:center"><strong>Was this page helpful?</strong></p>
<p style="text-align:center">
    <button class="like-btn" onclick="submitFeedbackForm(1)">
        <svg aria-hidden="true" focusable="false" class="color-fg-muted" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom;overflow:visible">
            <path d="M8.834.066c.763.087 1.5.295 2.01.884.505.581.656 1.378.656 2.3 0 .467-.087 1.119-.157 1.637L11.328 5h1.422c.603 0 1.174.085 1.668.333.508.254.911.679 1.137 1.2.453.998.438 2.447.188 4.316l-.04.306c-.105.79-.195 1.473-.313 2.033-.131.63-.315 1.209-.668 1.672C13.97 15.847 12.706 16 11 16c-1.848 0-3.234-.333-4.388-.653-.165-.045-.323-.09-.475-.133-.658-.186-1.2-.34-1.725-.415A1.75 1.75 0 0 1 2.75 16h-1A1.75 1.75 0 0 1 0 14.25v-7.5C0 5.784.784 5 1.75 5h1a1.75 1.75 0 0 1 1.514.872c.258-.105.59-.268.918-.508C5.853 4.874 6.5 4.079 6.5 2.75v-.5c0-1.202.994-2.337 2.334-2.184ZM4.5 13.3c.705.088 1.39.284 2.072.478l.441.125c1.096.305 2.334.598 3.987.598 1.794 0 2.28-.223 2.528-.549.147-.193.276-.505.394-1.07.105-.502.188-1.124.295-1.93l.04-.3c.25-1.882.189-2.933-.068-3.497a.921.921 0 0 0-.442-.48c-.208-.104-.52-.174-.997-.174H11c-.686 0-1.295-.577-1.206-1.336.023-.192.05-.39.076-.586.065-.488.13-.97.13-1.328 0-.809-.144-1.15-.288-1.316-.137-.158-.402-.304-1.048-.378C8.357 1.521 8 1.793 8 2.25v.5c0 1.922-.978 3.128-1.933 3.825a5.831 5.831 0 0 1-1.567.81ZM2.75 6.5h-1a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h1a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
        </svg>
    </button>
    <button class="dislike-btn" onclick="submitFeedbackForm(0)">
        <svg aria-hidden="true" focusable="false" class="" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom;overflow:visible">
            <path d="M7.083 15.986c-.763-.087-1.499-.295-2.011-.884-.504-.581-.655-1.378-.655-2.299 0-.468.087-1.12.157-1.638l.015-.112H3.167c-.603 0-1.174-.086-1.669-.334a2.415 2.415 0 0 1-1.136-1.2c-.454-.998-.438-2.447-.188-4.316l.04-.306C.32 4.108.41 3.424.526 2.864c.132-.63.316-1.209.669-1.672C1.947.205 3.211.053 4.917.053c1.848 0 3.234.332 4.388.652l.474.133c.658.187 1.201.341 1.726.415a1.75 1.75 0 0 1 1.662-1.2h1c.966 0 1.75.784 1.75 1.75v7.5a1.75 1.75 0 0 1-1.75 1.75h-1a1.75 1.75 0 0 1-1.514-.872c-.259.105-.59.268-.919.508-.671.491-1.317 1.285-1.317 2.614v.5c0 1.201-.994 2.336-2.334 2.183Zm4.334-13.232c-.706-.089-1.39-.284-2.072-.479l-.441-.125c-1.096-.304-2.335-.597-3.987-.597-1.794 0-2.28.222-2.529.548-.147.193-.275.505-.393 1.07-.105.502-.188 1.124-.295 1.93l-.04.3c-.25 1.882-.19 2.933.067 3.497a.923.923 0 0 0 .443.48c.208.104.52.175.997.175h1.75c.685 0 1.295.577 1.205 1.335-.022.192-.049.39-.075.586-.066.488-.13.97-.13 1.329 0 .808.144 1.15.288 1.316.137.157.401.303 1.048.377.307.035.664-.237.664-.693v-.5c0-1.922.978-3.127 1.932-3.825a5.878 5.878 0 0 1 1.568-.809Zm1.75 6.798h1a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25h-1a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25Z"></path>
        </svg>
    </button>
</p>

<div class="expand-feedback-content" id="expandContentLike">
    <ul style="text-align:center">
        <li>Thank you! We received your feedback.</li>
        <li>If you have any comments, fill in <a href='https://www.espressif.com/en/company/documents/documentation_feedback?docId=4287&sections=Networking (migration-guides/release-5.x/5.0/networking)&version=esp32 v5.4.2 (v5.4.2)'>Espressif Documentation Feedback Form</a>.</li>
    </ul>
</div>

<div class="expand-feedback-content" id="expandContent">
    <ul style="text-align:center">
        <li>We value your feedback.</li>
        <li>Let us know how we can improve this page by filling in <a href='https://www.espressif.com/en/company/documents/documentation_feedback?docId=4287&sections=Networking (migration-guides/release-5.x/5.0/networking)&version=esp32 v5.4.2 (v5.4.2)'>Espressif Documentation Feedback Form</a>.</li>
    </ul>
</div>

<br>


             </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="gcc.html" class="btn btn-neutral float-left" title="GCC" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="peripherals.html" class="btn btn-neutral float-right" title="Peripherals" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016 - 2025, Espressif Systems (Shanghai) Co., Ltd.</p>
  </div>

  <ul class="footer">
        <li>
	    
            
            Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/espressif/sphinx_idf_theme">theme</a>  based on <a href="https://github.com/readthedocs/sphinx_rtd_theme">Read the Docs Sphinx Theme</a>.
         </li>
    <li class="footer-aside">
        <a href="../../../esp-idf-en-v5.4.2.zip"> Download HTML</a>
    </li>

  </ul> 

</footer>
        </div>
      </div>
    </section>
  </div>

  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>