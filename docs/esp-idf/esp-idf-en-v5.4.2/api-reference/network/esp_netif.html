<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-73KGWFC8DM"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-73KGWFC8DM');
        </script><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ESP-NETIF - ESP32 -  &mdash; ESP-IDF Programming Guide v5.4.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=a60756f2" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=949a1ff5" />
      <link rel="stylesheet" type="text/css" href="../../_static/theme_overrides.css?v=851bd809" />

  
    <link rel="canonical" href="https://docs.espressif.com/projects/esp-idf/en/stable/esp32/api-reference/network/esp_netif.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=c241bbaf"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=ff8fa330"></script>
        <script src="https://wavedrom.com/skins/default.js"></script>
        <script src="https://wavedrom.com/wavedrom.min.js"></script>
    <script src="../../_static/js/theme.js"></script>

    
        

    <script type="text/javascript">
        DOCUMENTATION_OPTIONS.PAGENAME = 'api-reference/network/esp_netif';
        DOCUMENTATION_OPTIONS.PROJECT_SLUG = 'esp-idf';
        DOCUMENTATION_OPTIONS.LATEST_BRANCH_NAME = 'master';
        DOCUMENTATION_OPTIONS.VERSIONS_URL = 'https://dl.espressif.com/dl/esp-idf/idf_versions.js';
        DOCUMENTATION_OPTIONS.LANGUAGES = ["en", "zh_CN"];
        DOCUMENTATION_OPTIONS.IDF_TARGET = 'esp32';
        DOCUMENTATION_OPTIONS.HAS_IDF_TARGETS = ["esp32", "esp32s2", "esp32s3", "esp32c3", "esp32c2", "esp32c5", "esp32c6", "esp32p4"]
        DOCUMENTATION_OPTIONS.RELEASE = 'v5.4.2';
        DOCUMENTATION_OPTIONS.LANGUAGE_URL = 'en';

    </script>

    <script type="text/javascript" src="https://dl.espressif.com/dl/esp-idf/idf_versions.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="ESP-NETIF Programmers Manual" href="esp_netif_programming.html" />
    <link rel="prev" title="Thread" href="esp_openthread.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            ESP-IDF Programming Guide
              <img src="../../_static/espressif-logo.svg" class="logo" alt="Logo"/>
          </a>

          
            <div class="selectors">
              <select id="target-select" style="width: 150px;" hidden>
                <option value="" disabled selected>Choose target...</option>
              </select>
            </div>
          

          <div class="selectors">
            <select id="version-select" style="width: 150px;" hidden>
              <option value="" disabled selected>Choose version...</option>
            </select>
          </div>

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../get-started/index.html">Get Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../api-conventions.html">API Conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/index.html">Application Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bluetooth/index.html">Bluetooth® API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../error-codes.html">Error Codes Reference</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Networking APIs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="index.html#wi-fi">Wi-Fi</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#ethernet">Ethernet</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#thread">Thread</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html#esp-netif">ESP-NETIF</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">ESP-NETIF</a></li>
<li class="toctree-l4"><a class="reference internal" href="esp_netif_programming.html">ESP-NETIF Programmers Manual</a></li>
<li class="toctree-l4"><a class="reference internal" href="esp_netif_driver.html">ESP-NETIF Developer's manual</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="index.html#ip-network-layer">IP Network Layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#application-layer">Application Layer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../peripherals/index.html">Peripherals API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kconfig.html">Project Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../provisioning/index.html">Provisioning API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../storage/index.html">Storage API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../system/index.html">System API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../hw-reference/index.html">Hardware Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api-guides/index.html">API Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migration-guides/index.html">Migration Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../libraries-and-frameworks/index.html">Libraries and Frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contributions Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../versions.html">ESP-IDF Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COPYRIGHT.html">Copyrights and Licenses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../languages.html">Switch Between Languages</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ESP-IDF Programming Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">API Reference</a></li>
          <li class="breadcrumb-item"><a href="index.html">Networking APIs</a></li>
      <li class="breadcrumb-item active">ESP-NETIF</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/espressif/esp-idf/blob/v5.4.2/docs/en/api-reference/network/esp_netif.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="esp-netif">
<h1>ESP-NETIF<a class="headerlink" href="#esp-netif" title="Permalink to this heading"></a></h1>
<p><a class="reference external" href="../../../../../zh_CN/v5.4.2/esp32/api-reference/network/esp_netif.html">[中文]</a></p>
<p>The purpose of the ESP-NETIF library is twofold:</p>
<ul class="simple">
<li><p>It provides an abstraction layer for the application on top of the TCP/IP stack. This allows applications to choose between IP stacks in the future.</p></li>
<li><p>The APIs it provides are thread-safe, even if the underlying TCP/IP stack APIs are not.</p></li>
</ul>
<p>ESP-IDF currently implements ESP-NETIF for the lwIP TCP/IP stack only. However, the adapter itself is TCP/IP implementation-agnostic and allows different implementations.</p>
<p>Some ESP-NETIF API functions are intended to be called by application code, for example, to get or set interface IP addresses, and configure DHCP. Other functions are intended for internal ESP-IDF use by the network driver layer. In many cases, applications do not need to call ESP-NETIF APIs directly as they are called by the default network event handlers.</p>
<p>If you are only interested in using the most common network interfaces with default setting, please read <a class="reference internal" href="#esp-netif-user"><span class="std std-ref">ESP-NETIF User's Manual</span></a> to see how you can initialize default interfaces and register event handlers.</p>
<p>If you would like to learn more about the library interaction with other components, please refer to the <a class="reference internal" href="#esp-netif-structure"><span class="std std-ref">ESP-NETIF Architecture</span></a>.</p>
<p>In case your application needs to configure the network interfaces differently, e.g. setting a static IP address or just update the configuration runtime, please read <a class="reference internal" href="#esp-netif-programmer"><span class="std std-ref">ESP-NETIF Programmer's Manual</span></a>.</p>
<p>If you would like to develop your own network driver, implement support for a new TCP/IP stack or customize the ESP-NETIF in some other way, please refer to the <a class="reference internal" href="#esp-netif-developer"><span class="std std-ref">ESP-NETIF Developer's Manual</span></a>.</p>
<section id="esp-netif-user-s-manual">
<span id="esp-netif-user"></span><h2>ESP-NETIF User's Manual<a class="headerlink" href="#esp-netif-user-s-manual" title="Permalink to this heading"></a></h2>
<p>It is usually just enough to create a default network interface after startup and destroy it upon closing (see <a class="reference internal" href="#esp-netif-init"><span class="std std-ref">Initialization</span></a>). It is also useful to receive a notification upon assigning a new IP address or losing it (see <a class="reference internal" href="#esp-netif-ip-events"><span class="std std-ref">IP Events</span></a>).</p>
<section id="initialization">
<span id="esp-netif-init"></span><h3>Initialization<a class="headerlink" href="#initialization" title="Permalink to this heading"></a></h3>
<p>Since the ESP-NETIF component uses system events, the typical network startup code looks like this (note that error handling is omitted for clarity, see <a class="reference external" href="https://github.com/espressif/esp-idf/blob/v5.4.2/examples/ethernet/basic/main/ethernet_example_main.c">ethernet/basic/main/ethernet_example_main.c</a> for complete startup code):</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// 1) Initialize the TCP/IP stack and the event loop</span>
<span class="n">esp_netif_init</span><span class="p">();</span>
<span class="n">esp_event_loop_create_default</span><span class="p">();</span>

<span class="c1">// 2) Create the network interface handle</span>
<span class="n">esp_netif</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">esp_netif_new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">);</span>

<span class="c1">// 3) Create the network interface driver (e.g., Ethernet) and it&#39;s network layer glue</span>
<span class="c1">// and register the ESP-NETIF event (e.g., to bring the interface up upon link-up event)</span>
<span class="n">esp_netif_glue_t</span><span class="w"> </span><span class="n">glue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">driver_glue</span><span class="p">(</span><span class="n">driver</span><span class="p">);</span>

<span class="c1">// 4) Attach the driver&#39;s glue layer to the network interface handle</span>
<span class="n">esp_netif_attach</span><span class="p">(</span><span class="n">esp_netif</span><span class="p">,</span><span class="w"> </span><span class="n">glue</span><span class="p">);</span>

<span class="c1">// 5) Register user-side event handlers</span>
<span class="n">esp_event_handler_register</span><span class="p">(</span><span class="n">DRIVER_EVENT</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span><span class="w">  </span><span class="c1">// to observe driver states, e.g., link-up</span>
<span class="n">esp_event_handler_register</span><span class="p">(</span><span class="n">IP_EVENT</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span><span class="w">      </span><span class="c1">// to observe ESP-NETIF states, e.g., get an IP</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These steps must be performed in the exact order shown above, as the network interface drivers use the default event loop when registering system events.</p>
<blockquote>
<div><ul class="simple">
<li><p>The default event loop needs to be created <strong>before</strong> initializing an interface driver, as the driver typically needs to register system event handlers.</p></li>
<li><p>Registering application event handlers must occur <strong>after</strong> calling <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_netif_attach()</span></code>, because event handlers are called in the order they were registered. To ensure that system handlers are called first, you should register application handlers afterward.</p></li>
</ul>
</div></blockquote>
<p>Steps <code class="docutils literal notranslate"><span class="pre">2)</span></code>, <code class="docutils literal notranslate"><span class="pre">3)</span></code> and <code class="docutils literal notranslate"><span class="pre">4)</span></code> are quite complex for most common use-cases, so ESP-NETIF provides some pre-configured interfaces and convenience functions that create the most common network interfaces in their most common configurations.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Each network interface needs to be initialized separately, so if you would like to use multiple interfaces, you would have to run steps <code class="docutils literal notranslate"><span class="pre">2)</span></code> to <code class="docutils literal notranslate"><span class="pre">5)</span></code> for every interface. Set <code class="docutils literal notranslate"><span class="pre">1)</span></code> should be performed only once.</p>
</div>
<p>Creating and configuring the interface and attaching the network interface driver to it (steps <code class="docutils literal notranslate"><span class="pre">2)</span></code>, <code class="docutils literal notranslate"><span class="pre">3)</span></code> and <code class="docutils literal notranslate"><span class="pre">4)</span></code>) is described in <a class="reference internal" href="#create-esp-netif"><span class="std std-ref">Common Network Interfaces</span></a>.</p>
<p>Using the ESP-NETIF event handlers (step <code class="docutils literal notranslate"><span class="pre">5)</span></code>) is described in <a class="reference internal" href="#esp-netif-ip-events"><span class="std std-ref">IP Events</span></a>.</p>
<section id="common-network-interfaces">
<span id="create-esp-netif"></span><h4>Common Network Interfaces<a class="headerlink" href="#common-network-interfaces" title="Permalink to this heading"></a></h4>
<p>As the initialization of network interfaces could be quite complex, ESP-NETIF provides some convenient methods of creating the most common ones, such as Wi-Fi and Ethernet.</p>
<p>Please refer to the following examples to understand the initialization process of the default interface:</p>
<p><ul class="simple">
<li><p><a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/examples/wifi/getting_started/station">wifi/getting_started/station</a> demonstrates how to use the station functionality to connect ESP32 to an AP.</p></li>
<li><p><a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/examples/wifi/getting_started/softAP">wifi/getting_started/softAP</a> demonstrates how to use the SoftAP functionality to configure ESP32 as an AP.</p></li>
<li><p><a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/examples/ethernet/basic">ethernet/basic</a> demonstrates how to use the Ethernet driver, attach it to <cite>esp_netif</cite>, and obtain an IP address that can be pinged.</p></li>
<li><p><a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/examples/protocols/l2tap">protocols/l2tap</a> demonstrates how to use the ESP-NETIF L2 TAP interface to access the Data Link Layer for receiving and transmitting frames, implement non-IP protocols, and echo Ethernet frames with specific EthTypes.</p></li>
<li><p><a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/examples/protocols/static_ip">protocols/static_ip</a> demonstrates how to configure Wi-Fi as a station, including setting up a static IP, netmask, gateway and DNS server.</p></li>
</ul>
</p>
</section>
<section id="wi-fi-default-initialization">
<h4>Wi-Fi Default Initialization<a class="headerlink" href="#wi-fi-default-initialization" title="Permalink to this heading"></a></h4>
<p>The initialization code as well as registering event handlers for default interfaces, such as softAP and station, are provided in separate APIs to facilitate simple startup code for most applications:</p>
<ul class="simple">
<li><p><a class="reference internal" href="esp_netif_programming.html#_CPPv433esp_netif_create_default_wifi_stav" title="esp_netif_create_default_wifi_sta"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_netif_create_default_wifi_sta()</span></code></a></p></li>
</ul>
<ul class="simple">
<li><p><a class="reference internal" href="esp_netif_programming.html#_CPPv432esp_netif_create_default_wifi_apv" title="esp_netif_create_default_wifi_ap"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_netif_create_default_wifi_ap()</span></code></a></p></li>
</ul>
<p>Please note that these functions return the <code class="docutils literal notranslate"><span class="pre">esp_netif</span></code> handle, i.e., a pointer to a network interface object allocated and configured with default settings, which means that:</p>
<ul class="simple">
<li><p>The created object has to be destroyed if a network de-initialization is provided by an application using <a class="reference internal" href="esp_netif_programming.html#_CPPv430esp_netif_destroy_default_wifiPv" title="esp_netif_destroy_default_wifi"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_netif_destroy_default_wifi()</span></code></a>.</p></li>
<li><p>These <em>default</em> interfaces must not be created multiple times unless the created handle is deleted using <a class="reference internal" href="esp_netif_programming.html#_CPPv430esp_netif_destroy_default_wifiPv" title="esp_netif_destroy_default_wifi"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_netif_destroy_default_wifi()</span></code></a>.</p></li>
</ul>
<ul class="simple">
<li><p>When using Wi-Fi in <code class="docutils literal notranslate"><span class="pre">AP+STA</span></code> mode, both these interfaces have to be created. Please refer to the example <a class="reference external" href="https://github.com/espressif/esp-idf/blob/v5.4.2/examples/wifi/softap_sta/main/softap_sta.c">wifi/softap_sta/main/softap_sta.c</a>.</p></li>
</ul>
</section>
</section>
<section id="ip-events">
<span id="esp-netif-ip-events"></span><h3>IP Events<a class="headerlink" href="#ip-events" title="Permalink to this heading"></a></h3>
<p>In the final section of <a class="reference internal" href="#esp-netif-init"><span class="std std-ref">Initialization</span></a> code (step <code class="docutils literal notranslate"><span class="pre">5)</span></code>), you register two sets of event handlers:</p>
<ul class="simple">
<li><p><strong>Network Interface Driver Events</strong>: These events notify you about the driver's lifecycle states, such as when a Wi-Fi station joins an AP or gets disconnected. Handling these events is outside the scope of the ESP-NETIF component. It is worth noting that the same events are also used by ESP-NETIF to set the network interface to a desired state. Therefore, if your application uses the driver's events to determine specific states of the network interface, you should register these handlers <strong>after</strong> registering the system handlers (which typically happens when attaching the driver to the interface). This is why handler registration occurs in the final step of the <a class="reference internal" href="#esp-netif-init"><span class="std std-ref">Initialization</span></a> code.</p></li>
<li><p><strong>IP Events</strong>: These events notify you about IP address changes, such as when a new address is assigned or when a valid address is lost. Specific types of these events are listed in <a class="reference internal" href="esp_netif_programming.html#_CPPv410ip_event_t" title="ip_event_t"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">ip_event_t</span></code></a>. Each common interface has a related pair of <code class="docutils literal notranslate"><span class="pre">GOT_IP</span></code> and <code class="docutils literal notranslate"><span class="pre">LOST_IP</span></code> events.</p></li>
</ul>
<p>Registering event handlers is crucial due to the asynchronous nature of networking, where changes in network state can occur unpredictably. By registering event handlers, applications can respond to these changes promptly, ensuring appropriate actions are taken in response to network events.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Lost IP events are triggered by a timer configurable by <a class="reference internal" href="../kconfig.html#config-esp-netif-ip-lost-timer-interval"><span class="std std-ref">CONFIG_ESP_NETIF_IP_LOST_TIMER_INTERVAL</span></a>. The timer is started upon losing the IP address and the event will be raised after the configured interval, which is 120 s by default. The event could be disabled when setting the interval to 0.</p>
</div>
</section>
<section id="esp-netif-architecture">
<span id="esp-netif-structure"></span><h3>ESP-NETIF Architecture<a class="headerlink" href="#esp-netif-architecture" title="Permalink to this heading"></a></h3>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>                       |          (A) USER CODE                 |
                       |                 Apps                   |
      .................| init          settings      events     |
      .                +----------------------------------------+
      .                   .                |           *
      .                   .                |           *
  --------+            +===========================+   *     +-----------------------+
          |            | new/config   get/set/apps |   *     | init                  |
          |            |                           |...*.....| Apps (DHCP, SNTP)     |
          |            |---------------------------|   *     |                       |
    init  |            |                           |****     |                       |
    start |************|  event handler            |*********|  DHCP                 |
    stop  |            |                           |         |                       |
          |            |---------------------------|         |                       |
          |            |                           |         |    NETIF              |
    +-----|            |                           |         +-----------------+     |
    | glue|---&lt;----|---|  esp_netif_transmit       |--&lt;------| netif_output    |     |
    |     |        |   |                           |         |                 |     |
    |     |---&gt;----|---|  esp_netif_receive        |--&gt;------| netif_input     |     |
    |     |        |   |                           |         + ----------------+     |
    |     |...&lt;....|...|  esp_netif_free_rx_buffer |...&lt;.....| packet buffer         |
    +-----|     |  |   |                           |         |                       |
          |     |  |   |                           |         |         (D)           |
    (B)   |     |  |   |          (C)              |         +-----------------------+
  --------+     |  |   +===========================+               NETWORK STACK
NETWORK         |  |           ESP-NETIF
INTERFACE       |  |
DRIVER          |  |   +---------------------------+         +------------------+
                |  |   |                           |.........| open/close       |
                |  |   |                           |         |                  |
                |  -&lt;--|  l2tap_write              |-----&lt;---|  write           |
                |      |                           |         |                  |
                ----&gt;--|  esp_vfs_l2tap_eth_filter |-----&gt;---|  read            |
                       |                           |         |        (A)       |
                       |            (E)            |         +------------------+
                       +---------------------------+              USER CODE
                             ESP-NETIF L2 TAP
</pre></div>
</div>
<section id="data-and-event-flow-in-the-diagram">
<h4>Data and Event Flow in the Diagram<a class="headerlink" href="#data-and-event-flow-in-the-diagram" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">........</span></code>     Initialization line from user code to ESP-NETIF and network interface driver</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--&lt;---&gt;--</span></code>    Data packets going from communication media to TCP/IP stack and back</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">********</span></code>     Events aggregated in ESP-NETIF propagate to the driver, user code, and network stack</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">|</span></code>            User settings and runtime configuration</p></li>
</ul>
</section>
<section id="esp-netif-interaction">
<h4>ESP-NETIF Interaction<a class="headerlink" href="#esp-netif-interaction" title="Permalink to this heading"></a></h4>
<section id="a-user-code-boilerplate">
<h5>A) User Code, Boilerplate<a class="headerlink" href="#a-user-code-boilerplate" title="Permalink to this heading"></a></h5>
<p>Overall application interaction with a specific IO driver for the communication media (network interface driver) and configured TCP/IP network stack is abstracted using ESP-NETIF APIs and is outlined as below:</p>
<ol class="upperalpha">
<li><p>Initialization code</p>
<blockquote>
<div><ol class="arabic">
<li><p>Initializes IO driver</p></li>
<li><p>Creates a new instance of ESP-NETIF and configure it with</p>
<blockquote>
<div><ul class="simple">
<li><p>ESP-NETIF specific options (flags, behavior, name)</p></li>
<li><p>Network stack options (netif init and input functions, not publicly available)</p></li>
<li><p>IO driver specific options (transmit, free rx buffer functions, IO driver handle)</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Attaches the IO driver handle to the ESP-NETIF instance created in the above steps</p></li>
<li><p>Configures event handlers</p>
<blockquote>
<div><ul class="simple">
<li><p>Use default handlers for common interfaces defined in IO drivers; or define a specific handler for customized behavior or new interfaces</p></li>
<li><p>Register handlers for app-related events (such as IP lost or acquired)</p></li>
</ul>
</div></blockquote>
</li>
</ol>
</div></blockquote>
</li>
<li><p>Interaction with network interfaces using ESP-NETIF API</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Gets and sets TCP/IP-related parameters (DHCP, IP, etc)</p></li>
<li><p>Receives IP events (connect or disconnect)</p></li>
<li><p>Controls application lifecycle (set interface up or down)</p></li>
</ol>
</div></blockquote>
</li>
</ol>
</section>
<section id="b-network-interface-driver">
<h5>B) Network Interface Driver<a class="headerlink" href="#b-network-interface-driver" title="Permalink to this heading"></a></h5>
<p>Network interface driver (also called I/O Driver, or Media Driver) plays these two important roles in relation to ESP-NETIF:</p>
<ol class="arabic">
<li><p>Event handlers: Defines behavior patterns of interaction with ESP-NETIF (e.g., ethernet link-up -&gt; turn netif on)</p></li>
<li><p>Glue IO layer: Adapts the input or output functions to use ESP-NETIF transmit, receive, and free receive buffer</p>
<blockquote>
<div><ul class="simple">
<li><p>Installs driver_transmit to the appropriate ESP-NETIF object so that outgoing packets from the network stack are passed to the IO driver</p></li>
<li><p>Calls <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_netif_receive()</span></code> to pass incoming data to the network stack</p></li>
</ul>
</div></blockquote>
</li>
</ol>
</section>
<section id="c-esp-netif">
<h5>C) ESP-NETIF<a class="headerlink" href="#c-esp-netif" title="Permalink to this heading"></a></h5>
<p>ESP-NETIF serves as an intermediary between an IO driver and a network stack, connecting the packet data path between the two. It provides a set of interfaces for attaching a driver to an ESP-NETIF object at runtime and configures a network stack during compiling. Additionally, a set of APIs is provided to control the network interface lifecycle and its TCP/IP properties. As an overview, the ESP-NETIF public interface can be divided into six groups:</p>
<ol class="arabic">
<li><p>Initialization APIs (to create and configure ESP-NETIF instance)</p></li>
<li><p>Input or Output API (for passing data between IO driver and network stack)</p></li>
<li><p>Event or Action API</p>
<blockquote>
<div><ul class="simple">
<li><p>Used for network interface lifecycle management</p></li>
<li><p>ESP-NETIF provides building blocks for designing event handlers</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Setters and Getters API for basic network interface properties</p></li>
<li><p>Network stack abstraction API: enabling user interaction with TCP/IP stack</p>
<blockquote>
<div><ul class="simple">
<li><p>Set interface up or down</p></li>
<li><p>DHCP server and client API</p></li>
<li><p>DNS API</p></li>
<li><p><a class="reference internal" href="esp_netif_programming.html#esp-netif-sntp-api"><span class="std std-ref">SNTP Service</span></a></p></li>
</ul>
</div></blockquote>
</li>
<li><p>Driver conversion utilities API</p></li>
</ol>
</section>
<section id="d-network-stack">
<h5>D) Network Stack<a class="headerlink" href="#d-network-stack" title="Permalink to this heading"></a></h5>
<p>The network stack has no public interaction with application code with regard to public interfaces and shall be fully abstracted by ESP-NETIF API.</p>
</section>
<section id="e-esp-netif-l2-tap-interface">
<h5>E) ESP-NETIF L2 TAP Interface<a class="headerlink" href="#e-esp-netif-l2-tap-interface" title="Permalink to this heading"></a></h5>
<p>The ESP-NETIF L2 TAP interface is a mechanism in ESP-IDF used to access Data Link Layer (L2 per OSI/ISO) for frame reception and transmission from the user application. Its typical usage in the embedded world might be the implementation of non-IP-related protocols, e.g., PTP, Wake on LAN. Note that only Ethernet (IEEE 802.3) is currently supported. Please read more about L2 TAP in <a class="reference internal" href="esp_netif_programming.html#esp-netif-l2tap"><span class="std std-ref">L2 TAP Interface Usage</span></a>.</p>
</section>
</section>
</section>
</section>
<section id="esp-netif-programmer-s-manual">
<span id="esp-netif-programmer"></span><h2>ESP-NETIF Programmer's Manual<a class="headerlink" href="#esp-netif-programmer-s-manual" title="Permalink to this heading"></a></h2>
<p>In some cases, it is not enough to simply initialize a network interface by default, start using it and connect to the local network. If so, please consult the programming guide: <a class="reference internal" href="esp_netif_programming.html"><span class="doc">ESP-NETIF Programmers Manual</span></a>.</p>
<p>You would typically need to use specific sets of ESP-NETIF APIs in the following use-cases:</p>
<ul class="simple">
<li><p><a class="reference internal" href="esp_netif_programming.html#esp-netif-set-ip"><span class="std std-ref">Configure IP, Gateway, and DNS</span></a></p></li>
<li><p><a class="reference internal" href="esp_netif_programming.html#esp-netif-set-dhcp"><span class="std std-ref">Configure DHCP options</span></a></p></li>
<li><p><a class="reference internal" href="esp_netif_programming.html#esp-netif-sntp-api"><span class="std std-ref">SNTP Service</span></a></p></li>
<li><p><a class="reference internal" href="esp_netif_programming.html#esp-netif-l2tap"><span class="std std-ref">L2 TAP Interface Usage</span></a></p></li>
<li><p><a class="reference internal" href="esp_netif_programming.html#esp-netif-other-events"><span class="std std-ref">IP Event: Transmit/Receive Packet</span></a></p></li>
<li><p><a class="reference internal" href="esp_netif_programming.html#esp-netif-api-reference"><span class="std std-ref">API Reference</span></a></p></li>
</ul>
</section>
<section id="esp-netif-developer-s-manual">
<span id="esp-netif-developer"></span><h2>ESP-NETIF Developer's Manual<a class="headerlink" href="#esp-netif-developer-s-manual" title="Permalink to this heading"></a></h2>
<p>In some cases, user applications might need to customize ESP-NETIF, register custom drivers or even use a custom TCP/IP stack. If so, please consult the <a class="reference internal" href="esp_netif_driver.html"><span class="doc">ESP-NETIF Developer's manual</span></a>.</p>
</section>
</section>

    <script type="text/javascript">
        function init() {
            WaveDrom.ProcessAll();
        }
        window.onload = init;
    </script>

           </div>
             <div class="articleComments">

<style>
    .expand-feedback-content {
        display: none;
    }
    .click-like-or-dislike {
        background-color: #d3d3d3;
        pointer-events: none;
    }
</style>

<script>
    function submitFeedbackForm(user_likes_document) {
        // Send to GA4 the user reaction
        gtag('event', 'user_reaction', {
            'user_likes_document': user_likes_document
        });

        if (user_likes_document === 1) {
            document.querySelector('.like-btn').classList.add('click-like-or-dislike');
            document.getElementById("expandContentLike").style.display = 'block';
        } else {
            document.querySelector('.dislike-btn').classList.add('click-like-or-dislike');
            document.getElementById("expandContent").style.display = 'block';
        }

        document.querySelector('.like-btn').style.pointerEvents = 'none';
        document.querySelector('.dislike-btn').style.pointerEvents = 'none';
    }
</script>

<hr>

<p style="text-align:center"><strong>Was this page helpful?</strong></p>
<p style="text-align:center">
    <button class="like-btn" onclick="submitFeedbackForm(1)">
        <svg aria-hidden="true" focusable="false" class="color-fg-muted" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom;overflow:visible">
            <path d="M8.834.066c.763.087 1.5.295 2.01.884.505.581.656 1.378.656 2.3 0 .467-.087 1.119-.157 1.637L11.328 5h1.422c.603 0 1.174.085 1.668.333.508.254.911.679 1.137 1.2.453.998.438 2.447.188 4.316l-.04.306c-.105.79-.195 1.473-.313 2.033-.131.63-.315 1.209-.668 1.672C13.97 15.847 12.706 16 11 16c-1.848 0-3.234-.333-4.388-.653-.165-.045-.323-.09-.475-.133-.658-.186-1.2-.34-1.725-.415A1.75 1.75 0 0 1 2.75 16h-1A1.75 1.75 0 0 1 0 14.25v-7.5C0 5.784.784 5 1.75 5h1a1.75 1.75 0 0 1 1.514.872c.258-.105.59-.268.918-.508C5.853 4.874 6.5 4.079 6.5 2.75v-.5c0-1.202.994-2.337 2.334-2.184ZM4.5 13.3c.705.088 1.39.284 2.072.478l.441.125c1.096.305 2.334.598 3.987.598 1.794 0 2.28-.223 2.528-.549.147-.193.276-.505.394-1.07.105-.502.188-1.124.295-1.93l.04-.3c.25-1.882.189-2.933-.068-3.497a.921.921 0 0 0-.442-.48c-.208-.104-.52-.174-.997-.174H11c-.686 0-1.295-.577-1.206-1.336.023-.192.05-.39.076-.586.065-.488.13-.97.13-1.328 0-.809-.144-1.15-.288-1.316-.137-.158-.402-.304-1.048-.378C8.357 1.521 8 1.793 8 2.25v.5c0 1.922-.978 3.128-1.933 3.825a5.831 5.831 0 0 1-1.567.81ZM2.75 6.5h-1a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h1a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
        </svg>
    </button>
    <button class="dislike-btn" onclick="submitFeedbackForm(0)">
        <svg aria-hidden="true" focusable="false" class="" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom;overflow:visible">
            <path d="M7.083 15.986c-.763-.087-1.499-.295-2.011-.884-.504-.581-.655-1.378-.655-2.299 0-.468.087-1.12.157-1.638l.015-.112H3.167c-.603 0-1.174-.086-1.669-.334a2.415 2.415 0 0 1-1.136-1.2c-.454-.998-.438-2.447-.188-4.316l.04-.306C.32 4.108.41 3.424.526 2.864c.132-.63.316-1.209.669-1.672C1.947.205 3.211.053 4.917.053c1.848 0 3.234.332 4.388.652l.474.133c.658.187 1.201.341 1.726.415a1.75 1.75 0 0 1 1.662-1.2h1c.966 0 1.75.784 1.75 1.75v7.5a1.75 1.75 0 0 1-1.75 1.75h-1a1.75 1.75 0 0 1-1.514-.872c-.259.105-.59.268-.919.508-.671.491-1.317 1.285-1.317 2.614v.5c0 1.201-.994 2.336-2.334 2.183Zm4.334-13.232c-.706-.089-1.39-.284-2.072-.479l-.441-.125c-1.096-.304-2.335-.597-3.987-.597-1.794 0-2.28.222-2.529.548-.147.193-.275.505-.393 1.07-.105.502-.188 1.124-.295 1.93l-.04.3c-.25 1.882-.19 2.933.067 3.497a.923.923 0 0 0 .443.48c.208.104.52.175.997.175h1.75c.685 0 1.295.577 1.205 1.335-.022.192-.049.39-.075.586-.066.488-.13.97-.13 1.329 0 .808.144 1.15.288 1.316.137.157.401.303 1.048.377.307.035.664-.237.664-.693v-.5c0-1.922.978-3.127 1.932-3.825a5.878 5.878 0 0 1 1.568-.809Zm1.75 6.798h1a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25h-1a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25Z"></path>
        </svg>
    </button>
</p>

<div class="expand-feedback-content" id="expandContentLike">
    <ul style="text-align:center">
        <li>Thank you! We received your feedback.</li>
        <li>If you have any comments, fill in <a href='https://www.espressif.com/en/company/documents/documentation_feedback?docId=4287&sections=ESP-NETIF (api-reference/network/esp_netif)&version=esp32 v5.4.2 (v5.4.2)'>Espressif Documentation Feedback Form</a>.</li>
    </ul>
</div>

<div class="expand-feedback-content" id="expandContent">
    <ul style="text-align:center">
        <li>We value your feedback.</li>
        <li>Let us know how we can improve this page by filling in <a href='https://www.espressif.com/en/company/documents/documentation_feedback?docId=4287&sections=ESP-NETIF (api-reference/network/esp_netif)&version=esp32 v5.4.2 (v5.4.2)'>Espressif Documentation Feedback Form</a>.</li>
    </ul>
</div>

<br>


             </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="esp_openthread.html" class="btn btn-neutral float-left" title="Thread" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="esp_netif_programming.html" class="btn btn-neutral float-right" title="ESP-NETIF Programmers Manual" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016 - 2025, Espressif Systems (Shanghai) Co., Ltd.</p>
  </div>

  <ul class="footer">
        <li>
	    
            
            Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/espressif/sphinx_idf_theme">theme</a>  based on <a href="https://github.com/readthedocs/sphinx_rtd_theme">Read the Docs Sphinx Theme</a>.
         </li>
    <li class="footer-aside">
        <a href="../../esp-idf-en-v5.4.2.zip"> Download HTML</a>
    </li>

  </ul> 

</footer>
        </div>
      </div>
    </section>
  </div>

  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>