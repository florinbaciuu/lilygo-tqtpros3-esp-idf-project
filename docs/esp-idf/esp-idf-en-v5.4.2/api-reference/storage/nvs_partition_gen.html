<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-73KGWFC8DM"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-73KGWFC8DM');
        </script><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NVS Partition Generator Utility - ESP32 -  &mdash; ESP-IDF Programming Guide v5.4.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=a60756f2" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=949a1ff5" />
      <link rel="stylesheet" type="text/css" href="../../_static/theme_overrides.css?v=851bd809" />

  
    <link rel="canonical" href="https://docs.espressif.com/projects/esp-idf/en/stable/esp32/api-reference/storage/nvs_partition_gen.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=c241bbaf"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=ff8fa330"></script>
        <script src="https://wavedrom.com/skins/default.js"></script>
        <script src="https://wavedrom.com/wavedrom.min.js"></script>
    <script src="../../_static/js/theme.js"></script>

    
        

    <script type="text/javascript">
        DOCUMENTATION_OPTIONS.PAGENAME = 'api-reference/storage/nvs_partition_gen';
        DOCUMENTATION_OPTIONS.PROJECT_SLUG = 'esp-idf';
        DOCUMENTATION_OPTIONS.LATEST_BRANCH_NAME = 'master';
        DOCUMENTATION_OPTIONS.VERSIONS_URL = 'https://dl.espressif.com/dl/esp-idf/idf_versions.js';
        DOCUMENTATION_OPTIONS.LANGUAGES = ["en", "zh_CN"];
        DOCUMENTATION_OPTIONS.IDF_TARGET = 'esp32';
        DOCUMENTATION_OPTIONS.HAS_IDF_TARGETS = ["esp32", "esp32s2", "esp32s3", "esp32c3", "esp32c2", "esp32c5", "esp32c6", "esp32p4"]
        DOCUMENTATION_OPTIONS.RELEASE = 'v5.4.2';
        DOCUMENTATION_OPTIONS.LANGUAGE_URL = 'en';

    </script>

    <script type="text/javascript" src="https://dl.espressif.com/dl/esp-idf/idf_versions.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="NVS Partition Parser Utility" href="nvs_partition_parse.html" />
    <link rel="prev" title="NVS Encryption" href="nvs_encryption.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            ESP-IDF Programming Guide
              <img src="../../_static/espressif-logo.svg" class="logo" alt="Logo"/>
          </a>

          
            <div class="selectors">
              <select id="target-select" style="width: 150px;" hidden>
                <option value="" disabled selected>Choose target...</option>
              </select>
            </div>
          

          <div class="selectors">
            <select id="version-select" style="width: 150px;" hidden>
              <option value="" disabled selected>Choose version...</option>
            </select>
          </div>

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../get-started/index.html">Get Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../api-conventions.html">API Conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/index.html">Application Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bluetooth/index.html">Bluetooth® API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../error-codes.html">Error Codes Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../network/index.html">Networking APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../peripherals/index.html">Peripherals API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kconfig.html">Project Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../provisioning/index.html">Provisioning API</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Storage API</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="fatfs.html">FAT Filesystem Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="fatfsgen.html">Generating and Parsing FATFS on Host</a></li>
<li class="toctree-l3"><a class="reference internal" href="mass_mfg.html">Manufacturing Utility</a></li>
<li class="toctree-l3"><a class="reference internal" href="nvs_flash.html">Non-Volatile Storage Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="nvs_bootloader.html">NVS Bootloader</a></li>
<li class="toctree-l3"><a class="reference internal" href="nvs_encryption.html">NVS Encryption</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">NVS Partition Generator Utility</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#nvs-entry-and-namespace-association">NVS Entry and Namespace Association</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multipage-blob-support">Multipage Blob Support</a></li>
<li class="toctree-l4"><a class="reference internal" href="#encryption-decryption-support">Encryption-Decryption Support</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-the-utility">Running the Utility</a></li>
<li class="toctree-l4"><a class="reference internal" href="#caveats">Caveats</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="nvs_partition_parse.html">NVS Partition Parser Utility</a></li>
<li class="toctree-l3"><a class="reference internal" href="sdmmc.html">SD/SDIO/MMC Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="partition.html">Partitions API</a></li>
<li class="toctree-l3"><a class="reference internal" href="spiffs.html">SPIFFS Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="vfs.html">Virtual Filesystem Component</a></li>
<li class="toctree-l3"><a class="reference internal" href="wear-levelling.html">Wear Levelling API</a></li>
<li class="toctree-l3"><a class="reference internal" href="storage-security.html">Storage Security</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../system/index.html">System API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../hw-reference/index.html">Hardware Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api-guides/index.html">API Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migration-guides/index.html">Migration Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../libraries-and-frameworks/index.html">Libraries and Frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contributions Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../versions.html">ESP-IDF Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COPYRIGHT.html">Copyrights and Licenses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../languages.html">Switch Between Languages</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ESP-IDF Programming Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">API Reference</a></li>
          <li class="breadcrumb-item"><a href="index.html">Storage API</a></li>
      <li class="breadcrumb-item active">NVS Partition Generator Utility</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/espressif/esp-idf/blob/v5.4.2/docs/en/api-reference/storage/nvs_partition_gen.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="nvs-partition-generator-utility">
<h1>NVS Partition Generator Utility<a class="headerlink" href="#nvs-partition-generator-utility" title="Permalink to this heading"></a></h1>
<p><a class="reference external" href="../../../../../zh_CN/v5.4.2/esp32/api-reference/storage/nvs_partition_gen.html">[中文]</a></p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h2>
<p>The utility <a class="reference external" href="https://github.com/espressif/esp-idf/blob/v5.4.2/components/nvs_flash/nvs_partition_generator/nvs_partition_gen.py">nvs_flash/nvs_partition_generator/nvs_partition_gen.py</a> creates a binary file, compatible with the NVS architecture defined in <a class="reference internal" href="nvs_flash.html"><span class="doc">Non-Volatile Storage Library</span></a>, based on the key-value pairs provided in a CSV file.</p>
<p>This utility is ideally suited for generating a binary blob, containing data specific to ODM/OEM, which can be flashed externally at the time of device manufacturing. This allows manufacturers to generate many instances of the same application firmware with customized parameters for each device, such as a serial number.</p>
</section>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading"></a></h2>
<dl class="simple">
<dt>To use this utility in encryption mode, install the following packages:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cryptography</span></code></p></li>
</ul>
</dd>
</dl>
<p>All the required packages are included in <cite>requirements.txt</cite> in the root of the ESP-IDF directory.</p>
<section id="csv-file-format">
<span id="nvs-csv-file-format"></span><h3>CSV File Format<a class="headerlink" href="#csv-file-format" title="Permalink to this heading"></a></h3>
<p>Each line of a CSV file should contain 4 parameters, separated by a comma. The table below describes each of these parameters.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 10.0%" />
<col style="width: 20.0%" />
<col style="width: 35.0%" />
<col style="width: 35.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>No.</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Key</p></td>
<td><p>Key of the data. The data can be accessed later from an application using this key.</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>Type</p></td>
<td><p>Supported values are <code class="docutils literal notranslate"><span class="pre">file</span></code>, <code class="docutils literal notranslate"><span class="pre">data</span></code>, and <code class="docutils literal notranslate"><span class="pre">namespace</span></code>.</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>Encoding</p></td>
<td><p>Supported values are: <code class="docutils literal notranslate"><span class="pre">u8</span></code>, <code class="docutils literal notranslate"><span class="pre">i8</span></code>, <code class="docutils literal notranslate"><span class="pre">u16</span></code>, <code class="docutils literal notranslate"><span class="pre">i16</span></code>, <code class="docutils literal notranslate"><span class="pre">u32</span></code>, <code class="docutils literal notranslate"><span class="pre">i32</span></code>, <code class="docutils literal notranslate"><span class="pre">u64</span></code>, <code class="docutils literal notranslate"><span class="pre">i64</span></code>, <code class="docutils literal notranslate"><span class="pre">string</span></code>, <code class="docutils literal notranslate"><span class="pre">hex2bin</span></code>, <code class="docutils literal notranslate"><span class="pre">base64</span></code>, and <code class="docutils literal notranslate"><span class="pre">binary</span></code>. This specifies how actual data values are encoded in the resulting binary file. The difference between the <code class="docutils literal notranslate"><span class="pre">string</span></code> and <code class="docutils literal notranslate"><span class="pre">binary</span></code> encoding is that <code class="docutils literal notranslate"><span class="pre">string</span></code> data is terminated with a NULL character, whereas <code class="docutils literal notranslate"><span class="pre">binary</span></code> data is not.</p></td>
<td><p>As of now, for the <code class="docutils literal notranslate"><span class="pre">file</span></code> type, only <code class="docutils literal notranslate"><span class="pre">hex2bin</span></code>, <code class="docutils literal notranslate"><span class="pre">base64</span></code>, <code class="docutils literal notranslate"><span class="pre">string</span></code>, and <code class="docutils literal notranslate"><span class="pre">binary</span></code> encoding is supported.</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>Value</p></td>
<td><p>Data value</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Encoding</span></code> and <code class="docutils literal notranslate"><span class="pre">Value</span></code> cells for the <code class="docutils literal notranslate"><span class="pre">namespace</span></code> field type should be empty. <code class="docutils literal notranslate"><span class="pre">Encoding</span></code> and <code class="docutils literal notranslate"><span class="pre">Value</span></code> of <code class="docutils literal notranslate"><span class="pre">namespace</span></code> are fixed and are not configurable. Any values in these cells are ignored.</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The first line of the CSV file should always be the column header and it is not configurable.</p>
</div>
<p>Below is an example dump of such a CSV file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">key</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">encoding</span><span class="p">,</span><span class="n">value</span>     <span class="o">&lt;--</span> <span class="n">column</span> <span class="n">header</span>
<span class="n">namespace_name</span><span class="p">,</span><span class="n">namespace</span><span class="p">,,</span>  <span class="o">&lt;--</span> <span class="n">First</span> <span class="n">entry</span> <span class="n">should</span> <span class="n">be</span> <span class="n">of</span> <span class="nb">type</span> <span class="s2">&quot;namespace&quot;</span>
<span class="n">key1</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">u8</span><span class="p">,</span><span class="mi">1</span>
<span class="n">key2</span><span class="p">,</span><span class="n">file</span><span class="p">,</span><span class="n">string</span><span class="p">,</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">file</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<dl class="simple">
<dt>Make sure there are <strong>no spaces</strong>:</dt><dd><ul class="simple">
<li><p>before and after ','</p></li>
<li><p>at the end of each line in a CSV file</p></li>
</ul>
</dd>
</dl>
</div>
</section>
</section>
<section id="nvs-entry-and-namespace-association">
<h2>NVS Entry and Namespace Association<a class="headerlink" href="#nvs-entry-and-namespace-association" title="Permalink to this heading"></a></h2>
<p>When a namespace entry is encountered in a CSV file, each following entry will be treated as part of that namespace until the next namespace entry is found. At this point, all the following entries will be treated as part of the new namespace.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>First entry in a CSV file should always be a <code class="docutils literal notranslate"><span class="pre">namespace</span></code> entry.</p>
</div>
</section>
<section id="multipage-blob-support">
<h2>Multipage Blob Support<a class="headerlink" href="#multipage-blob-support" title="Permalink to this heading"></a></h2>
<p>By default, binary blobs are allowed to span over multiple pages and are written in the format mentioned in Section <a class="reference internal" href="nvs_flash.html#structure-of-entry"><span class="std std-ref">Structure of Entry</span></a>. If you intend to use the older format, the utility provides an option to disable this feature.</p>
</section>
<section id="encryption-decryption-support">
<h2>Encryption-Decryption Support<a class="headerlink" href="#encryption-decryption-support" title="Permalink to this heading"></a></h2>
<p>The NVS Partition Generator utility also allows you to create an encrypted binary file and decrypt an encrypted one. The utility uses the XTS-AES encryption. Please refer to <a class="reference internal" href="nvs_flash.html#nvs-encryption"><span class="std std-ref">NVS Encryption</span></a> for more details.</p>
</section>
<section id="running-the-utility">
<h2>Running the Utility<a class="headerlink" href="#running-the-utility" title="Permalink to this heading"></a></h2>
<p><strong>Usage</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">nvs_partition_gen</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">{</span><span class="n">generate</span><span class="p">,</span><span class="n">generate</span><span class="o">-</span><span class="n">key</span><span class="p">,</span><span class="n">encrypt</span><span class="p">,</span><span class="n">decrypt</span><span class="p">}</span> <span class="o">...</span>
</pre></div>
</div>
<p><strong>Optional Arguments</strong>:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 40.0%" />
<col style="width: 40.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>No.</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">-h</span></code> / <code class="docutils literal notranslate"><span class="pre">--help</span></code></p></td>
<td><p>Show the help message and exit</p></td>
</tr>
</tbody>
</table>
<p><strong>Commands</strong>:</p>
<blockquote>
<div><p>Run <code class="docutils literal notranslate"><span class="pre">nvs_partition_gen.py</span> <span class="pre">{command}</span> <span class="pre">-h</span></code> for additional help</p>
</div></blockquote>
<table class="docutils align-default">
<colgroup>
<col style="width: 20.0%" />
<col style="width: 40.0%" />
<col style="width: 40.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>No.</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">generate</span></code></p></td>
<td><p>Generate NVS partition</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">generate-key</span></code></p></td>
<td><p>Generate keys for encryption</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">encrypt</span></code></p></td>
<td><p>Generate NVS encrypted partition</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">decrypt</span></code></p></td>
<td><p>Decrypt NVS encrypted partition</p></td>
</tr>
</tbody>
</table>
<section id="generate-nvs-partition-default">
<h3>Generate NVS Partition (Default)<a class="headerlink" href="#generate-nvs-partition-default" title="Permalink to this heading"></a></h3>
<p><strong>Usage</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">nvs_partition_gen</span><span class="o">.</span><span class="n">py</span> <span class="n">generate</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">version</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">}]</span> <span class="p">[</span><span class="o">--</span><span class="n">outdir</span> <span class="n">OUTDIR</span><span class="p">]</span> <span class="nb">input</span> <span class="n">output</span> <span class="n">size</span>
</pre></div>
</div>
<p><strong>Positional Arguments</strong>:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">input</span></code></p></td>
<td><p>Path to CSV file to parse</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">output</span></code></p></td>
<td><p>Path to output NVS binary file</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">size</span></code></p></td>
<td><p>Size of NVS partition in bytes (must be multiple of 4096)</p></td>
</tr>
</tbody>
</table>
<p><strong>Optional Arguments</strong>:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-h</span></code> / <code class="docutils literal notranslate"><span class="pre">--help</span></code></p></td>
<td><p>Show the help message and exit</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--version</span> <span class="pre">{1,2}</span></code></p></td>
<td><p>Set multipage blob version (Default: Version 2)</p>
<p>Version 1 - Multipage blob support disabled</p>
<p>Version 2 - Multipage blob support enabled</p>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--outdir</span> <span class="pre">OUTDIR</span></code></p></td>
<td><p>Output directory to store file created (Default: current directory)</p></td>
</tr>
</tbody>
</table>
<p>You can run the utility to generate NVS partition using the command below. A sample CSV file is provided with the utility:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">nvs_partition_gen</span><span class="o">.</span><span class="n">py</span> <span class="n">generate</span> <span class="n">sample_singlepage_blob</span><span class="o">.</span><span class="n">csv</span> <span class="n">sample</span><span class="o">.</span><span class="n">bin</span> <span class="mh">0x3000</span>
</pre></div>
</div>
</section>
<section id="generate-encryption-keys-partition">
<h3>Generate Encryption Keys Partition<a class="headerlink" href="#generate-encryption-keys-partition" title="Permalink to this heading"></a></h3>
<p><strong>Usage</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">nvs_partition_gen</span><span class="o">.</span><span class="n">py</span> <span class="n">generate</span><span class="o">-</span><span class="n">key</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">keyfile</span> <span class="n">KEYFILE</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">outdir</span> <span class="n">OUTDIR</span><span class="p">]</span>
</pre></div>
</div>
<p><strong>Optional Arguments</strong>:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-h</span></code> / <code class="docutils literal notranslate"><span class="pre">--help</span></code></p></td>
<td><p>Show the help message and exit</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--keyfile</span> <span class="pre">KEYFILE</span></code></p></td>
<td><p>Path to output encryption keys file</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--outdir</span> <span class="pre">OUTDIR</span></code></p></td>
<td><p>Output directory to store files created. (Default: current directory)</p></td>
</tr>
</tbody>
</table>
<p>You can run the utility to generate only the encryption key partition using the command below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">nvs_partition_gen</span><span class="o">.</span><span class="n">py</span> <span class="n">generate</span><span class="o">-</span><span class="n">key</span>
</pre></div>
</div>
</section>
<section id="generate-encrypted-nvs-partition">
<span id="id1"></span><h3>Generate Encrypted NVS Partition<a class="headerlink" href="#generate-encrypted-nvs-partition" title="Permalink to this heading"></a></h3>
<p><strong>Usage</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">nvs_partition_gen</span><span class="o">.</span><span class="n">py</span> <span class="n">encrypt</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">version</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">}]</span> <span class="p">[</span><span class="o">--</span><span class="n">keygen</span><span class="p">]</span>
                                    <span class="p">[</span><span class="o">--</span><span class="n">keyfile</span> <span class="n">KEYFILE</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">inputkey</span> <span class="n">INPUTKEY</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">outdir</span> <span class="n">OUTDIR</span><span class="p">]</span>
                                    <span class="nb">input</span> <span class="n">output</span> <span class="n">size</span>
</pre></div>
</div>
<p><strong>Positional Arguments</strong>:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">input</span></code></p></td>
<td><p>Path to CSV file to parse</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">output</span></code></p></td>
<td><p>Path to output NVS binary file</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">size</span></code></p></td>
<td><p>Size of NVS partition in bytes (must be multiple of 4096)</p></td>
</tr>
</tbody>
</table>
<p><strong>Optional Arguments</strong>:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-h</span></code> / <code class="docutils literal notranslate"><span class="pre">--help</span></code></p></td>
<td><p>Show the help message and exit</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--version</span> <span class="pre">{1,2}</span></code></p></td>
<td><p>Set multipage blob version (Default: Version 2)</p>
<p>Version 1 - Multipage blob support disabled</p>
<p>Version 2 - Multipage blob support enabled</p>
</td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--keygen</span></code></p></td>
<td><p>Generates key for encrypting NVS partition</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--keyfile</span> <span class="pre">KEYFILE</span></code></p></td>
<td><p>Path to output encryption keys file</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--inputkey</span> <span class="pre">INPUTKEY</span></code></p></td>
<td><p>File having key for encrypting NVS partition</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--outdir</span> <span class="pre">OUTDIR</span></code></p></td>
<td><p>Output directory to store file created (Default: current directory)</p></td>
</tr>
</tbody>
</table>
<p>You can run the utility to encrypt NVS partition using the command below. A sample CSV file is provided with the utility:</p>
<ul>
<li><p>Encrypt by allowing the utility to generate encryption keys:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">nvs_partition_gen</span><span class="o">.</span><span class="n">py</span> <span class="n">encrypt</span> <span class="n">sample_singlepage_blob</span><span class="o">.</span><span class="n">csv</span> <span class="n">sample_encr</span><span class="o">.</span><span class="n">bin</span> <span class="mh">0x3000</span> <span class="o">--</span><span class="n">keygen</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Encryption key of the format <code class="docutils literal notranslate"><span class="pre">&lt;outdir&gt;/keys/keys-&lt;timestamp&gt;.bin</span></code> is created.</p>
</div>
</li>
</ul>
<ul>
<li><p>Encrypt by allowing the utility to generate encryption keys and store it in provided custom filename:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">nvs_partition_gen</span><span class="o">.</span><span class="n">py</span> <span class="n">encrypt</span> <span class="n">sample_singlepage_blob</span><span class="o">.</span><span class="n">csv</span> <span class="n">sample_encr</span><span class="o">.</span><span class="n">bin</span> <span class="mh">0x3000</span> <span class="o">--</span><span class="n">keygen</span> <span class="o">--</span><span class="n">keyfile</span> <span class="n">sample_keys</span><span class="o">.</span><span class="n">bin</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Encryption key of the format <code class="docutils literal notranslate"><span class="pre">&lt;outdir&gt;/keys/sample_keys.bin</span></code> is created.</p></li>
<li><p>This newly created file having encryption keys in <code class="docutils literal notranslate"><span class="pre">keys/</span></code> directory is compatible with NVS key-partition structure. Refer to <a class="reference internal" href="nvs_encryption.html#nvs-encr-key-partition"><span class="std std-ref">NVS Key Partition</span></a> for more details.</p></li>
</ul>
</div>
<ul>
<li><p>Encrypt by providing the encryption keys as input binary file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">nvs_partition_gen</span><span class="o">.</span><span class="n">py</span> <span class="n">encrypt</span> <span class="n">sample_singlepage_blob</span><span class="o">.</span><span class="n">csv</span> <span class="n">sample_encr</span><span class="o">.</span><span class="n">bin</span> <span class="mh">0x3000</span> <span class="o">--</span><span class="n">inputkey</span> <span class="n">sample_keys</span><span class="o">.</span><span class="n">bin</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="decrypt-encrypted-nvs-partition">
<h3>Decrypt Encrypted NVS Partition<a class="headerlink" href="#decrypt-encrypted-nvs-partition" title="Permalink to this heading"></a></h3>
<p><strong>Usage</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">nvs_partition_gen</span><span class="o">.</span><span class="n">py</span> <span class="n">decrypt</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">outdir</span> <span class="n">OUTDIR</span><span class="p">]</span> <span class="nb">input</span> <span class="n">key</span> <span class="n">output</span>
</pre></div>
</div>
<p><strong>Positional Arguments</strong>:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">input</span></code></p></td>
<td><p>Path to encrypted NVS partition file to parse</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">key</span></code></p></td>
<td><p>Path to file having keys for decryption</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">output</span></code></p></td>
<td><p>Path to output decrypted binary file</p></td>
</tr>
</tbody>
</table>
<p><strong>Optional Arguments</strong>:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-h</span></code> / <code class="docutils literal notranslate"><span class="pre">--help</span></code></p></td>
<td><p>Show the help message and exit</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--outdir</span> <span class="pre">OUTDIR</span></code></p></td>
<td><p>Output directory to store files created. (Default: current directory)</p></td>
</tr>
</tbody>
</table>
<p>You can run the utility to decrypt encrypted NVS partition using the command below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">nvs_partition_gen</span><span class="o">.</span><span class="n">py</span> <span class="n">decrypt</span> <span class="n">sample_encr</span><span class="o">.</span><span class="n">bin</span> <span class="n">sample_keys</span><span class="o">.</span><span class="n">bin</span> <span class="n">sample_decr</span><span class="o">.</span><span class="n">bin</span>
</pre></div>
</div>
<dl class="simple">
<dt>You can also provide the format version number:</dt><dd><ul class="simple">
<li><p>Multipage blob support disabled (Version 1)</p></li>
<li><p>Multipage blob support enabled (Version 2)</p></li>
</ul>
</dd>
</dl>
</section>
<section id="multipage-blob-support-disabled-version-1">
<h3>Multipage Blob Support Disabled (Version 1)<a class="headerlink" href="#multipage-blob-support-disabled-version-1" title="Permalink to this heading"></a></h3>
<p>You can run the utility in this format by setting the version parameter to 1, as shown below. A sample CSV file for the same is provided with the utility:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">nvs_partition_gen</span><span class="o">.</span><span class="n">py</span> <span class="n">generate</span> <span class="n">sample_singlepage_blob</span><span class="o">.</span><span class="n">csv</span> <span class="n">sample</span><span class="o">.</span><span class="n">bin</span> <span class="mh">0x3000</span> <span class="o">--</span><span class="n">version</span> <span class="mi">1</span>
</pre></div>
</div>
</section>
<section id="multipage-blob-support-enabled-version-2">
<h3>Multipage Blob Support Enabled (Version 2)<a class="headerlink" href="#multipage-blob-support-enabled-version-2" title="Permalink to this heading"></a></h3>
<p>You can run the utility in this format by setting the version parameter to 2, as shown below. A sample CSV file for the same is provided with the utility:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">nvs_partition_gen</span><span class="o">.</span><span class="n">py</span> <span class="n">generate</span> <span class="n">sample_multipage_blob</span><span class="o">.</span><span class="n">csv</span> <span class="n">sample</span><span class="o">.</span><span class="n">bin</span> <span class="mh">0x4000</span> <span class="o">--</span><span class="n">version</span> <span class="mi">2</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Minimum NVS Partition Size needed is 0x3000 bytes.</p></li>
<li><p>When flashing the binary onto the device, make sure it is consistent with the application's sdkconfig.</p></li>
</ul>
</div>
</section>
</section>
<section id="caveats">
<h2>Caveats<a class="headerlink" href="#caveats" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Utility does not check for duplicate keys and will write data pertaining to both keys. You need to make sure that the keys are distinct.</p></li>
<li><p>Once a new page is created, no data will be written in the space left on the previous page. Fields in the CSV file need to be ordered in such a way as to optimize memory.</p></li>
<li><p>64-bit datatype is not yet supported.</p></li>
</ul>
</section>
</section>

    <script type="text/javascript">
        function init() {
            WaveDrom.ProcessAll();
        }
        window.onload = init;
    </script>

           </div>
             <div class="articleComments">

<style>
    .expand-feedback-content {
        display: none;
    }
    .click-like-or-dislike {
        background-color: #d3d3d3;
        pointer-events: none;
    }
</style>

<script>
    function submitFeedbackForm(user_likes_document) {
        // Send to GA4 the user reaction
        gtag('event', 'user_reaction', {
            'user_likes_document': user_likes_document
        });

        if (user_likes_document === 1) {
            document.querySelector('.like-btn').classList.add('click-like-or-dislike');
            document.getElementById("expandContentLike").style.display = 'block';
        } else {
            document.querySelector('.dislike-btn').classList.add('click-like-or-dislike');
            document.getElementById("expandContent").style.display = 'block';
        }

        document.querySelector('.like-btn').style.pointerEvents = 'none';
        document.querySelector('.dislike-btn').style.pointerEvents = 'none';
    }
</script>

<hr>

<p style="text-align:center"><strong>Was this page helpful?</strong></p>
<p style="text-align:center">
    <button class="like-btn" onclick="submitFeedbackForm(1)">
        <svg aria-hidden="true" focusable="false" class="color-fg-muted" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom;overflow:visible">
            <path d="M8.834.066c.763.087 1.5.295 2.01.884.505.581.656 1.378.656 2.3 0 .467-.087 1.119-.157 1.637L11.328 5h1.422c.603 0 1.174.085 1.668.333.508.254.911.679 1.137 1.2.453.998.438 2.447.188 4.316l-.04.306c-.105.79-.195 1.473-.313 2.033-.131.63-.315 1.209-.668 1.672C13.97 15.847 12.706 16 11 16c-1.848 0-3.234-.333-4.388-.653-.165-.045-.323-.09-.475-.133-.658-.186-1.2-.34-1.725-.415A1.75 1.75 0 0 1 2.75 16h-1A1.75 1.75 0 0 1 0 14.25v-7.5C0 5.784.784 5 1.75 5h1a1.75 1.75 0 0 1 1.514.872c.258-.105.59-.268.918-.508C5.853 4.874 6.5 4.079 6.5 2.75v-.5c0-1.202.994-2.337 2.334-2.184ZM4.5 13.3c.705.088 1.39.284 2.072.478l.441.125c1.096.305 2.334.598 3.987.598 1.794 0 2.28-.223 2.528-.549.147-.193.276-.505.394-1.07.105-.502.188-1.124.295-1.93l.04-.3c.25-1.882.189-2.933-.068-3.497a.921.921 0 0 0-.442-.48c-.208-.104-.52-.174-.997-.174H11c-.686 0-1.295-.577-1.206-1.336.023-.192.05-.39.076-.586.065-.488.13-.97.13-1.328 0-.809-.144-1.15-.288-1.316-.137-.158-.402-.304-1.048-.378C8.357 1.521 8 1.793 8 2.25v.5c0 1.922-.978 3.128-1.933 3.825a5.831 5.831 0 0 1-1.567.81ZM2.75 6.5h-1a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h1a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
        </svg>
    </button>
    <button class="dislike-btn" onclick="submitFeedbackForm(0)">
        <svg aria-hidden="true" focusable="false" class="" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom;overflow:visible">
            <path d="M7.083 15.986c-.763-.087-1.499-.295-2.011-.884-.504-.581-.655-1.378-.655-2.299 0-.468.087-1.12.157-1.638l.015-.112H3.167c-.603 0-1.174-.086-1.669-.334a2.415 2.415 0 0 1-1.136-1.2c-.454-.998-.438-2.447-.188-4.316l.04-.306C.32 4.108.41 3.424.526 2.864c.132-.63.316-1.209.669-1.672C1.947.205 3.211.053 4.917.053c1.848 0 3.234.332 4.388.652l.474.133c.658.187 1.201.341 1.726.415a1.75 1.75 0 0 1 1.662-1.2h1c.966 0 1.75.784 1.75 1.75v7.5a1.75 1.75 0 0 1-1.75 1.75h-1a1.75 1.75 0 0 1-1.514-.872c-.259.105-.59.268-.919.508-.671.491-1.317 1.285-1.317 2.614v.5c0 1.201-.994 2.336-2.334 2.183Zm4.334-13.232c-.706-.089-1.39-.284-2.072-.479l-.441-.125c-1.096-.304-2.335-.597-3.987-.597-1.794 0-2.28.222-2.529.548-.147.193-.275.505-.393 1.07-.105.502-.188 1.124-.295 1.93l-.04.3c-.25 1.882-.19 2.933.067 3.497a.923.923 0 0 0 .443.48c.208.104.52.175.997.175h1.75c.685 0 1.295.577 1.205 1.335-.022.192-.049.39-.075.586-.066.488-.13.97-.13 1.329 0 .808.144 1.15.288 1.316.137.157.401.303 1.048.377.307.035.664-.237.664-.693v-.5c0-1.922.978-3.127 1.932-3.825a5.878 5.878 0 0 1 1.568-.809Zm1.75 6.798h1a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25h-1a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25Z"></path>
        </svg>
    </button>
</p>

<div class="expand-feedback-content" id="expandContentLike">
    <ul style="text-align:center">
        <li>Thank you! We received your feedback.</li>
        <li>If you have any comments, fill in <a href='https://www.espressif.com/en/company/documents/documentation_feedback?docId=4287&sections=NVS Partition Generator Utility (api-reference/storage/nvs_partition_gen)&version=esp32 v5.4.2 (v5.4.2)'>Espressif Documentation Feedback Form</a>.</li>
    </ul>
</div>

<div class="expand-feedback-content" id="expandContent">
    <ul style="text-align:center">
        <li>We value your feedback.</li>
        <li>Let us know how we can improve this page by filling in <a href='https://www.espressif.com/en/company/documents/documentation_feedback?docId=4287&sections=NVS Partition Generator Utility (api-reference/storage/nvs_partition_gen)&version=esp32 v5.4.2 (v5.4.2)'>Espressif Documentation Feedback Form</a>.</li>
    </ul>
</div>

<br>


             </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="nvs_encryption.html" class="btn btn-neutral float-left" title="NVS Encryption" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="nvs_partition_parse.html" class="btn btn-neutral float-right" title="NVS Partition Parser Utility" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016 - 2025, Espressif Systems (Shanghai) Co., Ltd.</p>
  </div>

  <ul class="footer">
        <li>
	    
            
            Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/espressif/sphinx_idf_theme">theme</a>  based on <a href="https://github.com/readthedocs/sphinx_rtd_theme">Read the Docs Sphinx Theme</a>.
         </li>
    <li class="footer-aside">
        <a href="../../esp-idf-en-v5.4.2.zip"> Download HTML</a>
    </li>

  </ul> 

</footer>
        </div>
      </div>
    </section>
  </div>

  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>