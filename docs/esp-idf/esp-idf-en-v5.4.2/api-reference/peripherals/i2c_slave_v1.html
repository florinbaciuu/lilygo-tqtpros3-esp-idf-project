<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-73KGWFC8DM"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-73KGWFC8DM');
        </script><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>I2C Slave v1.0 - ESP32 -  &mdash; ESP-IDF Programming Guide v5.4.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=a60756f2" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=949a1ff5" />
      <link rel="stylesheet" type="text/css" href="../../_static/theme_overrides.css?v=851bd809" />

  
    <link rel="canonical" href="https://docs.espressif.com/projects/esp-idf/en/stable/esp32/api-reference/peripherals/i2c_slave_v1.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=c241bbaf"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=ff8fa330"></script>
        <script src="https://wavedrom.com/skins/default.js"></script>
        <script src="https://wavedrom.com/wavedrom.min.js"></script>
    <script src="../../_static/js/theme.js"></script>

    
        

    <script type="text/javascript">
        DOCUMENTATION_OPTIONS.PAGENAME = 'api-reference/peripherals/i2c_slave_v1';
        DOCUMENTATION_OPTIONS.PROJECT_SLUG = 'esp-idf';
        DOCUMENTATION_OPTIONS.LATEST_BRANCH_NAME = 'master';
        DOCUMENTATION_OPTIONS.VERSIONS_URL = 'https://dl.espressif.com/dl/esp-idf/idf_versions.js';
        DOCUMENTATION_OPTIONS.LANGUAGES = ["en", "zh_CN"];
        DOCUMENTATION_OPTIONS.IDF_TARGET = 'esp32';
        DOCUMENTATION_OPTIONS.HAS_IDF_TARGETS = ["esp32", "esp32s2", "esp32s3", "esp32c3", "esp32c2", "esp32c5", "esp32c6", "esp32p4"]
        DOCUMENTATION_OPTIONS.RELEASE = 'v5.4.2';
        DOCUMENTATION_OPTIONS.LANGUAGE_URL = 'en';

    </script>

    <script type="text/javascript" src="https://dl.espressif.com/dl/esp-idf/idf_versions.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Inter-IC Sound (I2S)" href="i2s.html" />
    <link rel="prev" title="Inter-Integrated Circuit (I2C)" href="i2c.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            ESP-IDF Programming Guide
              <img src="../../_static/espressif-logo.svg" class="logo" alt="Logo"/>
          </a>

          
            <div class="selectors">
              <select id="target-select" style="width: 150px;" hidden>
                <option value="" disabled selected>Choose target...</option>
              </select>
            </div>
          

          <div class="selectors">
            <select id="version-select" style="width: 150px;" hidden>
              <option value="" disabled selected>Choose version...</option>
            </select>
          </div>

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../get-started/index.html">Get Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../api-conventions.html">API Conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/index.html">Application Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bluetooth/index.html">BluetoothÂ® API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../error-codes.html">Error Codes Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../network/index.html">Networking APIs</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Peripherals API</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="adc_oneshot.html">Analog to Digital Converter (ADC) Oneshot Mode Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="adc_continuous.html">Analog to Digital Converter (ADC) Continuous Mode Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="adc_calibration.html">Analog to Digital Converter (ADC) Calibration Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="clk_tree.html">Clock Tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="dac.html">Digital To Analog Converter (DAC)</a></li>
<li class="toctree-l3"><a class="reference internal" href="gpio.html">GPIO &amp; RTC GPIO</a></li>
<li class="toctree-l3"><a class="reference internal" href="gptimer.html">General Purpose Timer (GPTimer)</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="i2c.html">Inter-Integrated Circuit (I2C)</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="i2c.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="i2c.html#i2c-clock-configuration">I2C Clock Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="i2c.html#i2c-file-structure">I2C File Structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="i2c.html#functional-overview">Functional Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="i2c.html#application-examples">Application Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="i2c.html#api-reference">API Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="i2s.html">Inter-IC Sound (I2S)</a></li>
<li class="toctree-l3"><a class="reference internal" href="lcd/index.html">LCD</a></li>
<li class="toctree-l3"><a class="reference internal" href="ledc.html">LED Control (LEDC)</a></li>
<li class="toctree-l3"><a class="reference internal" href="mcpwm.html">Motor Control Pulse Width Modulator (MCPWM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="pcnt.html">Pulse Counter (PCNT)</a></li>
<li class="toctree-l3"><a class="reference internal" href="rmt.html">Remote Control Transceiver (RMT)</a></li>
<li class="toctree-l3"><a class="reference internal" href="sd_pullup_requirements.html">SD Pull-up Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="sdmmc_host.html">SDMMC Host Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="sdspi_host.html">SD SPI Host Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="sdio_slave.html">SDIO Card Slave Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="sdm.html">Sigma-Delta Modulation (SDM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="spi_flash/index.html">SPI Flash API</a></li>
<li class="toctree-l3"><a class="reference internal" href="spi_master.html">SPI Master Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="spi_slave.html">SPI Slave Driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="touch_pad.html">Touch Sensor</a></li>
<li class="toctree-l3"><a class="reference internal" href="twai.html">Two-Wire Automotive Interface (TWAI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="uart.html">Universal Asynchronous Receiver/Transmitter (UART)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../kconfig.html">Project Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../provisioning/index.html">Provisioning API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../storage/index.html">Storage API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../system/index.html">System API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../hw-reference/index.html">Hardware Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api-guides/index.html">API Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migration-guides/index.html">Migration Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../libraries-and-frameworks/index.html">Libraries and Frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contributions Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../versions.html">ESP-IDF Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COPYRIGHT.html">Copyrights and Licenses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../languages.html">Switch Between Languages</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ESP-IDF Programming Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">API Reference</a></li>
          <li class="breadcrumb-item"><a href="index.html">Peripherals API</a></li>
          <li class="breadcrumb-item"><a href="i2c.html">Inter-Integrated Circuit (I2C)</a></li>
      <li class="breadcrumb-item active">I2C Slave v1.0</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/espressif/esp-idf/blob/v5.4.2/docs/en/api-reference/peripherals/i2c_slave_v1.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="i2c-slave-v1-0">
<span id="i2c-slave-v1"></span><h1>I2C Slave v1.0<a class="headerlink" href="#i2c-slave-v1-0" title="Permalink to this heading">ï</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This I2C slave driver version 1 will be removed when idf v6.0 update. We suggest you use I2C slave version 2 via <a class="reference internal" href="../kconfig.html#config-i2c-enable-slave-driver-version-2"><span class="std std-ref">CONFIG_I2C_ENABLE_SLAVE_DRIVER_VERSION_2</span></a>.</p>
</div>
<p>After installing the I2C slave driver by <a class="reference internal" href="i2c.html#_CPPv420i2c_new_slave_devicePK18i2c_slave_config_tP22i2c_slave_dev_handle_t" title="i2c_new_slave_device"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">i2c_new_slave_device()</span></code></a>, ESP32 is ready to communicate with other I2C masters as a slave.</p>
<section id="install-i2c-slave-device">
<h2>Install I2C slave device<a class="headerlink" href="#install-i2c-slave-device" title="Permalink to this heading">ï</a></h2>
<p>I2C slave requires the configuration specified by <a class="reference internal" href="i2c.html#_CPPv418i2c_slave_config_t" title="i2c_slave_config_t"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">i2c_slave_config_t</span></code></a>:</p>
<p><ul class="simple">
<li><p><a class="reference internal" href="i2c.html#_CPPv4N18i2c_slave_config_t8i2c_portE" title="i2c_slave_config_t::i2c_port"><code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">i2c_slave_config_t::i2c_port</span></code></a> sets the I2C port used by the controller.</p></li>
<li><p><a class="reference internal" href="i2c.html#_CPPv4N18i2c_slave_config_t10sda_io_numE" title="i2c_slave_config_t::sda_io_num"><code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">i2c_slave_config_t::sda_io_num</span></code></a> sets the GPIO number for serial data bus (SDA).</p></li>
<li><p><a class="reference internal" href="i2c.html#_CPPv4N18i2c_slave_config_t10scl_io_numE" title="i2c_slave_config_t::scl_io_num"><code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">i2c_slave_config_t::scl_io_num</span></code></a> sets the GPIO number for serial clock bus (SCL).</p></li>
<li><p><a class="reference internal" href="i2c.html#_CPPv4N18i2c_slave_config_t10clk_sourceE" title="i2c_slave_config_t::clk_source"><code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">i2c_slave_config_t::clk_source</span></code></a> selects the source clock for I2C bus. The available clocks are listed in <a class="reference internal" href="i2c.html#_CPPv418i2c_clock_source_t" title="i2c_clock_source_t"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">i2c_clock_source_t</span></code></a>. For the effect on power consumption of different clock source, please refer to <a class="reference external" href="#power-management">Power Management</a>  section.</p></li>
<li><p><a class="reference internal" href="i2c.html#_CPPv4N18i2c_slave_config_t14send_buf_depthE" title="i2c_slave_config_t::send_buf_depth"><code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">i2c_slave_config_t::send_buf_depth</span></code></a> sets the sending buffer length.</p></li>
<li><p><a class="reference internal" href="i2c.html#_CPPv4N18i2c_slave_config_t10slave_addrE" title="i2c_slave_config_t::slave_addr"><code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">i2c_slave_config_t::slave_addr</span></code></a> sets the slave address.</p></li>
<li><p><a class="reference internal" href="i2c.html#_CPPv4N18i2c_slave_config_t13intr_priorityE" title="i2c_slave_config_t::intr_priority"><code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">i2c_slave_config_t::intr_priority</span></code></a> sets the priority of the interrupt. If set to <code class="docutils literal notranslate"><span class="pre">0</span></code> , then the driver will use a interrupt with low or medium priority (priority level may be one of 1, 2 or 3), otherwise use the priority indicated by <a class="reference internal" href="i2c.html#_CPPv4N18i2c_slave_config_t13intr_priorityE" title="i2c_slave_config_t::intr_priority"><code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">i2c_slave_config_t::intr_priority</span></code></a>. Please use the number form (1, 2, 3), instead of the bitmask form ((1&lt;&lt;1), (1&lt;&lt;2), (1&lt;&lt;3)). Please pay attention that once the interrupt priority is set, it cannot be changed until <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">i2c_del_slave_bus()</span></code> is called.</p></li>
<li><p><a class="reference internal" href="i2c.html#_CPPv4N18i2c_slave_config_t12addr_bit_lenE" title="i2c_slave_config_t::addr_bit_len"><code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">i2c_slave_config_t::addr_bit_len</span></code></a>. Set this variable to <code class="docutils literal notranslate"><span class="pre">I2C_ADDR_BIT_LEN_10</span></code> if the slave should have a 10-bit address.</p></li>
</ul>
</p>
<p>Once the <a class="reference internal" href="i2c.html#_CPPv418i2c_slave_config_t" title="i2c_slave_config_t"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">i2c_slave_config_t</span></code></a> structure is populated with mandatory parameters, <a class="reference internal" href="i2c.html#_CPPv420i2c_new_slave_devicePK18i2c_slave_config_tP22i2c_slave_dev_handle_t" title="i2c_new_slave_device"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">i2c_new_slave_device()</span></code></a> can be called to allocate and initialize an I2C master bus. This function will return an I2C bus handle if it runs correctly. Specifically, when there are no more I2C port available, this function will return <a class="reference internal" href="../system/esp_err.html#c.ESP_ERR_NOT_FOUND" title="ESP_ERR_NOT_FOUND"><code class="xref c c-macro docutils literal notranslate"><span class="pre">ESP_ERR_NOT_FOUND</span></code></a> error.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">i2c_slave_config_t</span><span class="w"> </span><span class="n">i2c_slv_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">.</span><span class="n">addr_bit_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">I2C_ADDR_BIT_LEN_7</span><span class="p">,</span>
<span class="w">    </span><span class="p">.</span><span class="n">clk_source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">I2C_CLK_SRC_DEFAULT</span><span class="p">,</span>
<span class="w">    </span><span class="p">.</span><span class="n">i2c_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEST_I2C_PORT</span><span class="p">,</span>
<span class="w">    </span><span class="p">.</span><span class="n">send_buf_depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">,</span>
<span class="w">    </span><span class="p">.</span><span class="n">scl_io_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">I2C_SLAVE_SCL_IO</span><span class="p">,</span>
<span class="w">    </span><span class="p">.</span><span class="n">sda_io_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">I2C_SLAVE_SDA_IO</span><span class="p">,</span>
<span class="w">    </span><span class="p">.</span><span class="n">slave_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x58</span><span class="p">,</span>
<span class="p">};</span>

<span class="n">i2c_slave_dev_handle_t</span><span class="w"> </span><span class="n">slave_handle</span><span class="p">;</span>
<span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">i2c_new_slave_device</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i2c_slv_config</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">slave_handle</span><span class="p">));</span>
</pre></div>
</div>
</section>
<section id="uninstall-i2c-slave-device">
<h2>Uninstall I2C slave device<a class="headerlink" href="#uninstall-i2c-slave-device" title="Permalink to this heading">ï</a></h2>
<p>If a previously installed I2C bus is no longer needed, it's recommended to recycle the resource by calling <a class="reference internal" href="i2c.html#_CPPv420i2c_del_slave_device22i2c_slave_dev_handle_t" title="i2c_del_slave_device"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">i2c_del_slave_device()</span></code></a>, so that to release the underlying hardware.</p>
</section>
<section id="i2c-slave-write">
<h2>I2C Slave Write<a class="headerlink" href="#i2c-slave-write" title="Permalink to this heading">ï</a></h2>
<p>The send buffer of the I2C slave is used as a FIFO to store the data to be sent. The data will queue up until the master requests them. You can call <a class="reference internal" href="i2c.html#_CPPv418i2c_slave_transmit22i2c_slave_dev_handle_tPK7uint8_tii" title="i2c_slave_transmit"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">i2c_slave_transmit()</span></code></a> to transfer data.</p>
<p>Simple example for writing data to FIFO:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">data_wr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="n">DATA_LENGTH</span><span class="p">);</span>

<span class="n">i2c_slave_config_t</span><span class="w"> </span><span class="n">i2c_slv_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">.</span><span class="n">addr_bit_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">I2C_ADDR_BIT_LEN_7</span><span class="p">,</span><span class="w">   </span><span class="c1">// 7-bit address</span>
<span class="w">    </span><span class="p">.</span><span class="n">clk_source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">I2C_CLK_SRC_DEFAULT</span><span class="p">,</span><span class="w">    </span><span class="c1">// set the clock source</span>
<span class="w">    </span><span class="p">.</span><span class="n">i2c_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEST_I2C_PORT</span><span class="p">,</span><span class="w">            </span><span class="c1">// set I2C port number</span>
<span class="w">    </span><span class="p">.</span><span class="n">send_buf_depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">,</span><span class="w">                </span><span class="c1">// set TX buffer length</span>
<span class="w">    </span><span class="p">.</span><span class="n">scl_io_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">I2C_SLAVE_SCL_IO</span><span class="p">,</span><span class="w">       </span><span class="c1">// SCL GPIO number</span>
<span class="w">    </span><span class="p">.</span><span class="n">sda_io_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">I2C_SLAVE_SDA_IO</span><span class="p">,</span><span class="w">       </span><span class="c1">// SDA GPIO number</span>
<span class="w">    </span><span class="p">.</span><span class="n">slave_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x58</span><span class="p">,</span><span class="w">                   </span><span class="c1">// slave address</span>
<span class="p">};</span>

<span class="n">i2c_slave_dev_handle_t</span><span class="w"> </span><span class="n">slave_handle</span><span class="p">;</span>
<span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">i2c_new_slave_device</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i2c_slv_config</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">slave_handle</span><span class="p">));</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">DATA_LENGTH</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">data_wr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">i2c_slave_transmit</span><span class="p">(</span><span class="n">slave_handle</span><span class="p">,</span><span class="w"> </span><span class="n">data_wr</span><span class="p">,</span><span class="w"> </span><span class="n">DATA_LENGTH</span><span class="p">,</span><span class="w"> </span><span class="mi">10000</span><span class="p">));</span>
</pre></div>
</div>
</section>
<section id="i2c-slave-read">
<h2>I2C Slave Read<a class="headerlink" href="#i2c-slave-read" title="Permalink to this heading">ï</a></h2>
<p>Whenever the master writes data to the slave, the slave will automatically store data in the receive buffer. This allows the slave application to call the function <a class="reference internal" href="i2c.html#_CPPv417i2c_slave_receive22i2c_slave_dev_handle_tP7uint8_t6size_t" title="i2c_slave_receive"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">i2c_slave_receive()</span></code></a> as its own discretion. As <a class="reference internal" href="i2c.html#_CPPv417i2c_slave_receive22i2c_slave_dev_handle_tP7uint8_t6size_t" title="i2c_slave_receive"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">i2c_slave_receive()</span></code></a> is designed as a non-blocking interface, users need to register callback <a class="reference internal" href="i2c.html#_CPPv434i2c_slave_register_event_callbacks22i2c_slave_dev_handle_tPK27i2c_slave_event_callbacks_tPv" title="i2c_slave_register_event_callbacks"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">i2c_slave_register_event_callbacks()</span></code></a> to know when the receive has finished.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="n">IRAM_ATTR</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">i2c_slave_rx_done_callback</span><span class="p">(</span><span class="n">i2c_slave_dev_handle_t</span><span class="w"> </span><span class="n">channel</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">i2c_slave_rx_done_event_data_t</span><span class="w"> </span><span class="o">*</span><span class="n">edata</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">user_data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">BaseType_t</span><span class="w"> </span><span class="n">high_task_wakeup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pdFALSE</span><span class="p">;</span>
<span class="w">    </span><span class="n">QueueHandle_t</span><span class="w"> </span><span class="n">receive_queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">QueueHandle_t</span><span class="p">)</span><span class="n">user_data</span><span class="p">;</span>
<span class="w">    </span><span class="n">xQueueSendFromISR</span><span class="p">(</span><span class="n">receive_queue</span><span class="p">,</span><span class="w"> </span><span class="n">edata</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">high_task_wakeup</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">high_task_wakeup</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">pdTRUE</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="n">data_rd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="n">DATA_LENGTH</span><span class="p">);</span>
<span class="kt">uint32_t</span><span class="w"> </span><span class="n">size_rd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="n">i2c_slave_config_t</span><span class="w"> </span><span class="n">i2c_slv_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">.</span><span class="n">addr_bit_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">I2C_ADDR_BIT_LEN_7</span><span class="p">,</span>
<span class="w">    </span><span class="p">.</span><span class="n">clk_source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">I2C_CLK_SRC_DEFAULT</span><span class="p">,</span>
<span class="w">    </span><span class="p">.</span><span class="n">i2c_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEST_I2C_PORT</span><span class="p">,</span>
<span class="w">    </span><span class="p">.</span><span class="n">send_buf_depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">,</span>
<span class="w">    </span><span class="p">.</span><span class="n">scl_io_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">I2C_SLAVE_SCL_IO</span><span class="p">,</span>
<span class="w">    </span><span class="p">.</span><span class="n">sda_io_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">I2C_SLAVE_SDA_IO</span><span class="p">,</span>
<span class="w">    </span><span class="p">.</span><span class="n">slave_addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x58</span><span class="p">,</span>
<span class="p">};</span>

<span class="n">i2c_slave_dev_handle_t</span><span class="w"> </span><span class="n">slave_handle</span><span class="p">;</span>
<span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">i2c_new_slave_device</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i2c_slv_config</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">slave_handle</span><span class="p">));</span>

<span class="n">s_receive_queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xQueueCreate</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">i2c_slave_rx_done_event_data_t</span><span class="p">));</span>
<span class="n">i2c_slave_event_callbacks_t</span><span class="w"> </span><span class="n">cbs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">.</span><span class="n">on_recv_done</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i2c_slave_rx_done_callback</span><span class="p">,</span>
<span class="p">};</span>
<span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">i2c_slave_register_event_callbacks</span><span class="p">(</span><span class="n">slave_handle</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cbs</span><span class="p">,</span><span class="w"> </span><span class="n">s_receive_queue</span><span class="p">));</span>

<span class="n">i2c_slave_rx_done_event_data_t</span><span class="w"> </span><span class="n">rx_data</span><span class="p">;</span>
<span class="n">ESP_ERROR_CHECK</span><span class="p">(</span><span class="n">i2c_slave_receive</span><span class="p">(</span><span class="n">slave_handle</span><span class="p">,</span><span class="w"> </span><span class="n">data_rd</span><span class="p">,</span><span class="w"> </span><span class="n">DATA_LENGTH</span><span class="p">));</span>
<span class="n">xQueueReceive</span><span class="p">(</span><span class="n">s_receive_queue</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rx_data</span><span class="p">,</span><span class="w"> </span><span class="n">pdMS_TO_TICKS</span><span class="p">(</span><span class="mi">10000</span><span class="p">));</span>
<span class="c1">// Receive done.</span>
</pre></div>
</div>
</section>
<section id="i2c-slave-callbacks">
<h2>I2C slave callbacks<a class="headerlink" href="#i2c-slave-callbacks" title="Permalink to this heading">ï</a></h2>
<p>When an I2C slave bus triggers an interrupt, a specific event will be generated and notify the CPU. If you have some function that needs to be called when those events occurred, you can hook your function to the ISR (Interrupt Service Routine) by calling <a class="reference internal" href="i2c.html#_CPPv434i2c_slave_register_event_callbacks22i2c_slave_dev_handle_tPK27i2c_slave_event_callbacks_tPv" title="i2c_slave_register_event_callbacks"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">i2c_slave_register_event_callbacks()</span></code></a>. Since the registered callback functions are called in the interrupt context, users should ensure the callback function doesn't attempt to block (e.g. by making sure that only FreeRTOS APIs with <code class="docutils literal notranslate"><span class="pre">ISR</span></code> suffix are called from the function). The callback function has a boolean return value, to tell the caller whether a high priority task is woken up by it.</p>
<p>I2C slave event callbacks are listed in the <a class="reference internal" href="i2c.html#_CPPv427i2c_slave_event_callbacks_t" title="i2c_slave_event_callbacks_t"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">i2c_slave_event_callbacks_t</span></code></a>.</p>
<p><ul class="simple">
<li><p><a class="reference internal" href="i2c.html#_CPPv4N27i2c_slave_event_callbacks_t12on_recv_doneE" title="i2c_slave_event_callbacks_t::on_recv_done"><code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">i2c_slave_event_callbacks_t::on_recv_done</span></code></a> sets a callback function for &quot;receive-done&quot; event. The function prototype is declared in <a class="reference internal" href="i2c.html#_CPPv429i2c_slave_received_callback_t" title="i2c_slave_received_callback_t"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">i2c_slave_received_callback_t</span></code></a>.</p></li>
</ul>
</p>
</section>
</section>

    <script type="text/javascript">
        function init() {
            WaveDrom.ProcessAll();
        }
        window.onload = init;
    </script>

           </div>
             <div class="articleComments">

<style>
    .expand-feedback-content {
        display: none;
    }
    .click-like-or-dislike {
        background-color: #d3d3d3;
        pointer-events: none;
    }
</style>

<script>
    function submitFeedbackForm(user_likes_document) {
        // Send to GA4 the user reaction
        gtag('event', 'user_reaction', {
            'user_likes_document': user_likes_document
        });

        if (user_likes_document === 1) {
            document.querySelector('.like-btn').classList.add('click-like-or-dislike');
            document.getElementById("expandContentLike").style.display = 'block';
        } else {
            document.querySelector('.dislike-btn').classList.add('click-like-or-dislike');
            document.getElementById("expandContent").style.display = 'block';
        }

        document.querySelector('.like-btn').style.pointerEvents = 'none';
        document.querySelector('.dislike-btn').style.pointerEvents = 'none';
    }
</script>

<hr>

<p style="text-align:center"><strong>Was this page helpful?</strong></p>
<p style="text-align:center">
    <button class="like-btn" onclick="submitFeedbackForm(1)">
        <svg aria-hidden="true" focusable="false" class="color-fg-muted" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom;overflow:visible">
            <path d="M8.834.066c.763.087 1.5.295 2.01.884.505.581.656 1.378.656 2.3 0 .467-.087 1.119-.157 1.637L11.328 5h1.422c.603 0 1.174.085 1.668.333.508.254.911.679 1.137 1.2.453.998.438 2.447.188 4.316l-.04.306c-.105.79-.195 1.473-.313 2.033-.131.63-.315 1.209-.668 1.672C13.97 15.847 12.706 16 11 16c-1.848 0-3.234-.333-4.388-.653-.165-.045-.323-.09-.475-.133-.658-.186-1.2-.34-1.725-.415A1.75 1.75 0 0 1 2.75 16h-1A1.75 1.75 0 0 1 0 14.25v-7.5C0 5.784.784 5 1.75 5h1a1.75 1.75 0 0 1 1.514.872c.258-.105.59-.268.918-.508C5.853 4.874 6.5 4.079 6.5 2.75v-.5c0-1.202.994-2.337 2.334-2.184ZM4.5 13.3c.705.088 1.39.284 2.072.478l.441.125c1.096.305 2.334.598 3.987.598 1.794 0 2.28-.223 2.528-.549.147-.193.276-.505.394-1.07.105-.502.188-1.124.295-1.93l.04-.3c.25-1.882.189-2.933-.068-3.497a.921.921 0 0 0-.442-.48c-.208-.104-.52-.174-.997-.174H11c-.686 0-1.295-.577-1.206-1.336.023-.192.05-.39.076-.586.065-.488.13-.97.13-1.328 0-.809-.144-1.15-.288-1.316-.137-.158-.402-.304-1.048-.378C8.357 1.521 8 1.793 8 2.25v.5c0 1.922-.978 3.128-1.933 3.825a5.831 5.831 0 0 1-1.567.81ZM2.75 6.5h-1a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h1a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
        </svg>
    </button>
    <button class="dislike-btn" onclick="submitFeedbackForm(0)">
        <svg aria-hidden="true" focusable="false" class="" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom;overflow:visible">
            <path d="M7.083 15.986c-.763-.087-1.499-.295-2.011-.884-.504-.581-.655-1.378-.655-2.299 0-.468.087-1.12.157-1.638l.015-.112H3.167c-.603 0-1.174-.086-1.669-.334a2.415 2.415 0 0 1-1.136-1.2c-.454-.998-.438-2.447-.188-4.316l.04-.306C.32 4.108.41 3.424.526 2.864c.132-.63.316-1.209.669-1.672C1.947.205 3.211.053 4.917.053c1.848 0 3.234.332 4.388.652l.474.133c.658.187 1.201.341 1.726.415a1.75 1.75 0 0 1 1.662-1.2h1c.966 0 1.75.784 1.75 1.75v7.5a1.75 1.75 0 0 1-1.75 1.75h-1a1.75 1.75 0 0 1-1.514-.872c-.259.105-.59.268-.919.508-.671.491-1.317 1.285-1.317 2.614v.5c0 1.201-.994 2.336-2.334 2.183Zm4.334-13.232c-.706-.089-1.39-.284-2.072-.479l-.441-.125c-1.096-.304-2.335-.597-3.987-.597-1.794 0-2.28.222-2.529.548-.147.193-.275.505-.393 1.07-.105.502-.188 1.124-.295 1.93l-.04.3c-.25 1.882-.19 2.933.067 3.497a.923.923 0 0 0 .443.48c.208.104.52.175.997.175h1.75c.685 0 1.295.577 1.205 1.335-.022.192-.049.39-.075.586-.066.488-.13.97-.13 1.329 0 .808.144 1.15.288 1.316.137.157.401.303 1.048.377.307.035.664-.237.664-.693v-.5c0-1.922.978-3.127 1.932-3.825a5.878 5.878 0 0 1 1.568-.809Zm1.75 6.798h1a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25h-1a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25Z"></path>
        </svg>
    </button>
</p>

<div class="expand-feedback-content" id="expandContentLike">
    <ul style="text-align:center">
        <li>Thank you! We received your feedback.</li>
        <li>If you have any comments, fill in <a href='https://www.espressif.com/en/company/documents/documentation_feedback?docId=4287&sections=I2C Slave v1.0 (api-reference/peripherals/i2c_slave_v1)&version=esp32 v5.4.2 (v5.4.2)'>Espressif Documentation Feedback Form</a>.</li>
    </ul>
</div>

<div class="expand-feedback-content" id="expandContent">
    <ul style="text-align:center">
        <li>We value your feedback.</li>
        <li>Let us know how we can improve this page by filling in <a href='https://www.espressif.com/en/company/documents/documentation_feedback?docId=4287&sections=I2C Slave v1.0 (api-reference/peripherals/i2c_slave_v1)&version=esp32 v5.4.2 (v5.4.2)'>Espressif Documentation Feedback Form</a>.</li>
    </ul>
</div>

<br>


             </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="i2c.html" class="btn btn-neutral float-left" title="Inter-Integrated Circuit (I2C)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="i2s.html" class="btn btn-neutral float-right" title="Inter-IC Sound (I2S)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016 - 2025, Espressif Systems (Shanghai) Co., Ltd.</p>
  </div>

  <ul class="footer">
        <li>
	    
            
            Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/espressif/sphinx_idf_theme">theme</a>  based on <a href="https://github.com/readthedocs/sphinx_rtd_theme">Read the Docs Sphinx Theme</a>.
         </li>
    <li class="footer-aside">
        <a href="../../esp-idf-en-v5.4.2.zip"> Download HTML</a>
    </li>

  </ul> 

</footer>
        </div>
      </div>
    </section>
  </div>

  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>