<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-73KGWFC8DM"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-73KGWFC8DM');
        </script><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Watchdogs - ESP32 -  &mdash; ESP-IDF Programming Guide v5.4.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=a60756f2" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=949a1ff5" />
      <link rel="stylesheet" type="text/css" href="../../_static/theme_overrides.css?v=851bd809" />

  
    <link rel="canonical" href="https://docs.espressif.com/projects/esp-idf/en/stable/esp32/api-reference/system/wdts.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=c241bbaf"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=ff8fa330"></script>
        <script src="https://wavedrom.com/skins/default.js"></script>
        <script src="https://wavedrom.com/wavedrom.min.js"></script>
    <script src="../../_static/js/theme.js"></script>

    
        

    <script type="text/javascript">
        DOCUMENTATION_OPTIONS.PAGENAME = 'api-reference/system/wdts';
        DOCUMENTATION_OPTIONS.PROJECT_SLUG = 'esp-idf';
        DOCUMENTATION_OPTIONS.LATEST_BRANCH_NAME = 'master';
        DOCUMENTATION_OPTIONS.VERSIONS_URL = 'https://dl.espressif.com/dl/esp-idf/idf_versions.js';
        DOCUMENTATION_OPTIONS.LANGUAGES = ["en", "zh_CN"];
        DOCUMENTATION_OPTIONS.IDF_TARGET = 'esp32';
        DOCUMENTATION_OPTIONS.HAS_IDF_TARGETS = ["esp32", "esp32s2", "esp32s3", "esp32c3", "esp32c2", "esp32c5", "esp32c6", "esp32p4"]
        DOCUMENTATION_OPTIONS.RELEASE = 'v5.4.2';
        DOCUMENTATION_OPTIONS.LANGUAGE_URL = 'en';

    </script>

    <script type="text/javascript" src="https://dl.espressif.com/dl/esp-idf/idf_versions.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Hardware Reference" href="../../hw-reference/index.html" />
    <link rel="prev" title="Programming ULP FSM Coprocessor Using C Macros (Legacy)" href="ulp_macros.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            ESP-IDF Programming Guide
              <img src="../../_static/espressif-logo.svg" class="logo" alt="Logo"/>
          </a>

          
            <div class="selectors">
              <select id="target-select" style="width: 150px;" hidden>
                <option value="" disabled selected>Choose target...</option>
              </select>
            </div>
          

          <div class="selectors">
            <select id="version-select" style="width: 150px;" hidden>
              <option value="" disabled selected>Choose version...</option>
            </select>
          </div>

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../get-started/index.html">Get Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../api-conventions.html">API Conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../protocols/index.html">Application Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bluetooth/index.html">BluetoothÂ® API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../error-codes.html">Error Codes Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../network/index.html">Networking APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../peripherals/index.html">Peripherals API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kconfig.html">Project Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../provisioning/index.html">Provisioning API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../storage/index.html">Storage API</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">System API</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="app_image_format.html">App Image Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="bootloader_image_format.html">Bootloader Image Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="app_trace.html">Application Level Tracing</a></li>
<li class="toctree-l3"><a class="reference internal" href="esp_function_with_shared_stack.html">Call Function with External Stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="chip_revision.html">Chip Revision</a></li>
<li class="toctree-l3"><a class="reference internal" href="console.html">Console</a></li>
<li class="toctree-l3"><a class="reference internal" href="efuse.html">eFuse Manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="esp_err.html">Error Code and Helper Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="esp_https_ota.html">ESP HTTPS OTA</a></li>
<li class="toctree-l3"><a class="reference internal" href="esp_event.html">Event Loop Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="freertos.html">FreeRTOS Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="freertos_idf.html">FreeRTOS (IDF)</a></li>
<li class="toctree-l3"><a class="reference internal" href="freertos_additions.html">FreeRTOS (Supplemental Features)</a></li>
<li class="toctree-l3"><a class="reference internal" href="mem_alloc.html">Heap Memory Allocation</a></li>
<li class="toctree-l3"><a class="reference internal" href="mm.html">Memory Management for MMU Supported Memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="heap_debug.html">Heap Memory Debugging</a></li>
<li class="toctree-l3"><a class="reference internal" href="esp_timer.html">ESP Timer (High Resolution Timer)</a></li>
<li class="toctree-l3"><a class="reference internal" href="internal-unstable.html">Internal and Unstable APIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="ipc.html">Inter-Processor Call (IPC)</a></li>
<li class="toctree-l3"><a class="reference internal" href="intr_alloc.html">Interrupt Allocation</a></li>
<li class="toctree-l3"><a class="reference internal" href="log.html">Logging library</a></li>
<li class="toctree-l3"><a class="reference internal" href="misc_system_api.html">Miscellaneous System APIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="ota.html">Over The Air Updates (OTA)</a></li>
<li class="toctree-l3"><a class="reference internal" href="perfmon.html">Performance Monitor</a></li>
<li class="toctree-l3"><a class="reference internal" href="power_management.html">Power Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="pthread.html">POSIX Support (Including POSIX Threads Support)</a></li>
<li class="toctree-l3"><a class="reference internal" href="random.html">Random Number Generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="sleep_modes.html">Sleep Modes</a></li>
<li class="toctree-l3"><a class="reference internal" href="soc_caps.html">SoC Capabilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="system_time.html">System Time</a></li>
<li class="toctree-l3"><a class="reference internal" href="himem.html">Himem</a></li>
<li class="toctree-l3"><a class="reference internal" href="ulp.html">ULP Coprocessor Programming</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Watchdogs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hardware-watchdog-timers">Hardware Watchdog Timers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#interrupt-watchdog-timer-iwdt">Interrupt Watchdog Timer (IWDT)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#task-watchdog-timer-twdt">Task Watchdog Timer (TWDT)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#jtag-watchdogs">JTAG &amp; Watchdogs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#application-examples">Application Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#api-reference">API Reference</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../hw-reference/index.html">Hardware Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api-guides/index.html">API Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migration-guides/index.html">Migration Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../libraries-and-frameworks/index.html">Libraries and Frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contributions Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../versions.html">ESP-IDF Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../COPYRIGHT.html">Copyrights and Licenses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../languages.html">Switch Between Languages</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ESP-IDF Programming Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">API Reference</a></li>
          <li class="breadcrumb-item"><a href="index.html">System API</a></li>
      <li class="breadcrumb-item active">Watchdogs</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/espressif/esp-idf/blob/v5.4.2/docs/en/api-reference/system/wdts.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="watchdogs">
<h1>Watchdogs<a class="headerlink" href="#watchdogs" title="Permalink to this heading">ï</a></h1>
<p><a class="reference external" href="../../../../../zh_CN/v5.4.2/esp32/api-reference/system/wdts.html">[ä¸­æ]</a></p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">ï</a></h2>
<p>ESP-IDF supports multiple types of watchdogs:</p>
<p><ul class="simple">
<li><p>Hardware Watchdog Timers</p></li>
<li><p>Interrupt Watchdog Timer (IWDT)</p></li>
<li><p>Task Watchdog Timer (TWDT)</p></li>
</ul>
</p>
<p>The Interrupt Watchdog is responsible for ensuring that ISRs (Interrupt Service Routines) are not blocked for a prolonged period of time. The TWDT is responsible for detecting instances of tasks running without yielding for a prolonged period.</p>
<p>The various watchdog timers can be enabled using the <a class="reference internal" href="../kconfig.html#project-configuration-menu"><span class="std std-ref">Project Configuration Menu</span></a>. However, the TWDT can also be enabled during runtime.</p>
</section>
<section id="hardware-watchdog-timers">
<span id="app-hardware-watchdog-timers"></span><h2>Hardware Watchdog Timers<a class="headerlink" href="#hardware-watchdog-timers" title="Permalink to this heading">ï</a></h2>
<p>The chips have two groups of watchdog timers:</p>
<p><ul class="simple">
<li><p>Main System Watchdog Timer (MWDT_WDT) - used by Interrupt Watchdog Timer (IWDT) and Task Watchdog Timer (TWDT).</p></li>
<li><p>RTC Watchdog Timer (RTC_WDT) - used to track the boot time from power-up until the user's main function (by default RTC Watchdog is disabled immediately before the user's main function).</p></li>
</ul>
</p>
<p>Refer to the <a class="reference internal" href="../../api-guides/bootloader.html#bootloader-watchdog"><span class="std std-ref">Watchdog</span></a> section to understand how watchdogs are utilized in the bootloader.</p>
<p>The app's behaviour can be adjusted so the RTC Watchdog remains enabled after app startup. The Watchdog would need to be explicitly reset (i.e., fed) or disabled by the app to avoid the chip reset. To do this, set the <a class="reference internal" href="../kconfig.html#config-bootloader-wdt-disable-in-user-code"><span class="std std-ref">CONFIG_BOOTLOADER_WDT_DISABLE_IN_USER_CODE</span></a> option, modify the app as needed, and then recompile the app. In this case, the following APIs should be used:</p>
<p><ul class="simple">
<li><p><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">wdt_hal_disable()</span></code>: see <a class="reference internal" href="../../api-guides/hardware-abstraction.html#hw-abstraction-hal-layer-disable-rtc-wdt"><span class="std std-ref">To Disable RTC_WDT</span></a></p></li>
<li><p><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">wdt_hal_feed()</span></code>: see <a class="reference internal" href="../../api-guides/hardware-abstraction.html#hw-abstraction-hal-layer-feed-rtc-wdt"><span class="std std-ref">To Reset the RTC_WDT Counter</span></a></p></li>
<li><p><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">rtc_wdt_feed()</span></code></p></li>
<li><p><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">rtc_wdt_disable()</span></code></p></li>
</ul>
</p>
<p>If RTC_WDT is not reset/disabled in time, the chip will be automatically reset. See <a class="reference internal" href="../../api-guides/fatal-errors.html#rtc-watchdog-timeout"><span class="std std-ref">RTC Watchdog Timeout</span></a> for more information.</p>
</section>
<section id="interrupt-watchdog-timer-iwdt">
<h2>Interrupt Watchdog Timer (IWDT)<a class="headerlink" href="#interrupt-watchdog-timer-iwdt" title="Permalink to this heading">ï</a></h2>
<p>The purpose of the IWDT is to ensure that interrupt service routines (ISRs) are not blocked from running for a prolonged period of time (i.e., the IWDT timeout period). Preventing ISRs from running in a timely manner is undesirable as it can increase ISR latency, and also prevent task switching (as task switching is executed form an ISR). The things that can block ISRs from running include:</p>
<ul class="simple">
<li><p>Disabling interrupts</p></li>
<li><p>Critical Sections (also disables interrupts)</p></li>
<li><p>Other same/higher priority ISRs which block same/lower priority ISRs from running</p></li>
</ul>
<p>The IWDT utilizes the MWDT_WDT watchdog timer in Timer Group 1 as its underlying hardware timer and leverages the FreeRTOS tick interrupt on each CPU to feed the watchdog timer. If the tick interrupt on a particular CPU is not run at within the IWDT timeout period, it is indicative that something is blocking ISRs from being run on that CPU (see the list of reasons above).</p>
<p>When the IWDT times out, the default action is to invoke the panic handler and display the panic reason as <code class="docutils literal notranslate"><span class="pre">Interrupt</span> <span class="pre">wdt</span> <span class="pre">timeout</span> <span class="pre">on</span> <span class="pre">CPU0</span></code> or <code class="docutils literal notranslate"><span class="pre">Interrupt</span> <span class="pre">wdt</span> <span class="pre">timeout</span> <span class="pre">on</span> <span class="pre">CPU1</span></code> (as applicable). Depending on the panic handler's configured behavior (see <a class="reference internal" href="../kconfig.html#config-esp-system-panic"><span class="std std-ref">CONFIG_ESP_SYSTEM_PANIC</span></a>), users can then debug the source of the IWDT timeout (via the backtrace, OpenOCD, gdbstub etc) or simply reset the chip (which may be preferred in a production environment).</p>
<p>If for whatever reason the panic handler is unable to run after an IWDT timeout, the IWDT has a second stage timeout that will hard-reset the chip (i.e., a system reset).</p>
<section id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading">ï</a></h3>
<ul>
<li><p>The IWDT is enabled by default via the <a class="reference internal" href="../kconfig.html#config-esp-int-wdt"><span class="std std-ref">CONFIG_ESP_INT_WDT</span></a> option.</p></li>
<li><p>The IWDT's timeout is configured by setting the <a class="reference internal" href="../kconfig.html#config-esp-int-wdt-timeout-ms"><span class="std std-ref">CONFIG_ESP_INT_WDT_TIMEOUT_MS</span></a> option.</p>
<blockquote>
<div><ul class="simple">
<li><p>Note that the default timeout is higher if PSRAM support is enabled, as a critical section or interrupt routine that accesses a large amount of PSRAM takes longer to complete in some circumstances.</p></li>
<li><p>The timeout should always at least twice longer than the period between FreeRTOS ticks (see <a class="reference internal" href="../kconfig.html#config-freertos-hz"><span class="std std-ref">CONFIG_FREERTOS_HZ</span></a>).</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="tuning">
<h3>Tuning<a class="headerlink" href="#tuning" title="Permalink to this heading">ï</a></h3>
<p>If you find the IWDT timeout is triggered because an interrupt or critical section is running longer than the timeout period, consider rewriting the code:</p>
<ul class="simple">
<li><p>Critical sections should be made as short as possible. Any non-critical code/computation should be placed outside the critical section.</p></li>
<li><p>Interrupt handlers should also perform the minimum possible amount of computation. Users can consider deferring any computation to a task by having the ISR push data to a task using queues.</p></li>
</ul>
<p>Neither critical sections or interrupt handlers should ever block waiting for another event to occur. If changing the code to reduce the processing time is not possible or desirable, it is possible to increase the <a class="reference internal" href="../kconfig.html#config-esp-int-wdt-timeout-ms"><span class="std std-ref">CONFIG_ESP_INT_WDT_TIMEOUT_MS</span></a> setting instead.</p>
</section>
</section>
<section id="task-watchdog-timer-twdt">
<span id="task-watchdog-timer"></span><h2>Task Watchdog Timer (TWDT)<a class="headerlink" href="#task-watchdog-timer-twdt" title="Permalink to this heading">ï</a></h2>
<p>The Task Watchdog Timer (TWDT) is used to monitor particular tasks, ensuring that they are able to execute within a given timeout period. The TWDT primarily watches the Idle Tasks of each CPU, however any task can subscribe to be watched by the TWDT. By watching the Idle Tasks of each CPU, the TWDT can detect instances of tasks running for a prolonged period of time without yielding. This can be an indicator of poorly written code that spinloops on a peripheral, or a task that is stuck in an infinite loop.</p>
<p>The TWDT is built around the MWDT_WDT watchdog timer in Timer Group 0. When a timeout occurs, an interrupt is triggered.</p>
<p>Users can define the function <code class="docutils literal notranslate"><span class="pre">esp_task_wdt_isr_user_handler</span></code> in the user code, in order to receive the timeout event and extend the default behavior.</p>
<section id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Permalink to this heading">ï</a></h3>
<p>The following functions can be used to watch tasks using the TWDT:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#_CPPv417esp_task_wdt_initPK21esp_task_wdt_config_t" title="esp_task_wdt_init"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_task_wdt_init()</span></code></a> to initialize the TWDT and subscribe the idle tasks.</p></li>
<li><p><a class="reference internal" href="#_CPPv416esp_task_wdt_add12TaskHandle_t" title="esp_task_wdt_add"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_task_wdt_add()</span></code></a> subscribes other tasks to the TWDT.</p></li>
<li><p>Once subscribed, <a class="reference internal" href="#_CPPv418esp_task_wdt_resetv" title="esp_task_wdt_reset"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_task_wdt_reset()</span></code></a> should be called from the task to feed the TWDT.</p></li>
<li><p><a class="reference internal" href="#_CPPv419esp_task_wdt_delete12TaskHandle_t" title="esp_task_wdt_delete"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_task_wdt_delete()</span></code></a> unsubscribes a previously subscribed task.</p></li>
<li><p><a class="reference internal" href="#_CPPv419esp_task_wdt_deinitv" title="esp_task_wdt_deinit"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_task_wdt_deinit()</span></code></a> unsubscribes the idle tasks and deinitializes the TWDT.</p></li>
</ul>
<p>In the case where applications need to watch at a more granular level (i.e., ensure that a particular functions/stub/code-path is called), the TWDT allows subscription of <code class="docutils literal notranslate"><span class="pre">users</span></code>.</p>
<ul class="simple">
<li><p><a class="reference internal" href="#_CPPv421esp_task_wdt_add_userPKcP26esp_task_wdt_user_handle_t" title="esp_task_wdt_add_user"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_task_wdt_add_user()</span></code></a> to subscribe an arbitrary user of the TWDT. This function returns a user handle to the added user.</p></li>
<li><p><a class="reference internal" href="#_CPPv423esp_task_wdt_reset_user26esp_task_wdt_user_handle_t" title="esp_task_wdt_reset_user"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_task_wdt_reset_user()</span></code></a> must be called using the user handle in order to prevent a TWDT timeout.</p></li>
<li><p><a class="reference internal" href="#_CPPv424esp_task_wdt_delete_user26esp_task_wdt_user_handle_t" title="esp_task_wdt_delete_user"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_task_wdt_delete_user()</span></code></a> unsubscribes an arbitrary user of the TWDT.</p></li>
</ul>
</section>
<section id="id1">
<h3>Configuration<a class="headerlink" href="#id1" title="Permalink to this heading">ï</a></h3>
<p>The default timeout period for the TWDT is set using config item <a class="reference internal" href="../kconfig.html#config-esp-task-wdt-timeout-s"><span class="std std-ref">CONFIG_ESP_TASK_WDT_TIMEOUT_S</span></a>. This should be set to at least as long as you expect any single task needs to monopolize the CPU (for example, if you expect the app will do a long intensive calculation and should not yield to other tasks). It is also possible to change this timeout at runtime by calling <a class="reference internal" href="#_CPPv417esp_task_wdt_initPK21esp_task_wdt_config_t" title="esp_task_wdt_init"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_task_wdt_init()</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Erasing large flash areas can be time consuming and can cause a task to run continuously, thus triggering a TWDT timeout. The following two methods can be used to avoid this:</p>
<ul class="simple">
<li><p>Increase <a class="reference internal" href="../kconfig.html#config-esp-task-wdt-timeout-s"><span class="std std-ref">CONFIG_ESP_TASK_WDT_TIMEOUT_S</span></a> in menuconfig for a larger watchdog timeout period.</p></li>
<li><p>You can also call <a class="reference internal" href="#_CPPv417esp_task_wdt_initPK21esp_task_wdt_config_t" title="esp_task_wdt_init"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_task_wdt_init()</span></code></a> to increase the watchdog timeout period before erasing a large flash area.</p></li>
</ul>
<p>For more information, you can refer to <a class="reference internal" href="../peripherals/spi_flash/index.html"><span class="doc">SPI Flash API</span></a>.</p>
</div>
<p>The following config options control TWDT configuration. They are all enabled by default:</p>
<p><ul class="simple">
<li><p><a class="reference internal" href="../kconfig.html#config-esp-task-wdt-en"><span class="std std-ref">CONFIG_ESP_TASK_WDT_EN</span></a> - enables TWDT feature. If this option is disabled, TWDT cannot be used, even if initialized at runtime.</p></li>
<li><p><a class="reference internal" href="../kconfig.html#config-esp-task-wdt-init"><span class="std std-ref">CONFIG_ESP_TASK_WDT_INIT</span></a> - the TWDT is initialized automatically during startup. If this option is disabled, it is still possible to initialize the Task WDT at runtime by calling <a class="reference internal" href="#_CPPv417esp_task_wdt_initPK21esp_task_wdt_config_t" title="esp_task_wdt_init"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_task_wdt_init()</span></code></a>.</p></li>
<li><p><a class="reference internal" href="../kconfig.html#config-esp-task-wdt-check-idle-task-cpu0"><span class="std std-ref">CONFIG_ESP_TASK_WDT_CHECK_IDLE_TASK_CPU0</span></a> - CPU0 Idle task is subscribed to the TWDT during startup. If this option is disabled, it is still possible to subscribe the idle task by calling <a class="reference internal" href="#_CPPv417esp_task_wdt_initPK21esp_task_wdt_config_t" title="esp_task_wdt_init"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">esp_task_wdt_init()</span></code></a> again.</p></li>
<li><p><a class="reference internal" href="../kconfig.html#config-esp-task-wdt-check-idle-task-cpu1"><span class="std std-ref">CONFIG_ESP_TASK_WDT_CHECK_IDLE_TASK_CPU1</span></a> - CPU1 Idle task is subscribed to the TWDT during startup.</p></li>
</ul>
</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>On a TWDT timeout the default behaviour is to simply print a warning and a backtrace before continuing running the app. If you want a timeout to cause a panic and a system reset then this can be configured through <a class="reference internal" href="../kconfig.html#config-esp-task-wdt-panic"><span class="std std-ref">CONFIG_ESP_TASK_WDT_PANIC</span></a>.</p>
</div>
</section>
</section>
<section id="jtag-watchdogs">
<h2>JTAG &amp; Watchdogs<a class="headerlink" href="#jtag-watchdogs" title="Permalink to this heading">ï</a></h2>
<p>While debugging using OpenOCD, the CPUs are halted every time a breakpoint is reached. However if the watchdog timers continue to run when a breakpoint is encountered, they will eventually trigger a reset making it very difficult to debug code. Therefore OpenOCD will disable the hardware timers of both the interrupt and task watchdogs at every breakpoint. Moreover, OpenOCD will not re-enable them upon leaving the breakpoint. This means that interrupt watchdog and task watchdog functionality will essentially be disabled. No warnings or panics from either watchdogs will be generated when the ESP32 is connected to OpenOCD via JTAG.</p>
</section>
<section id="application-examples">
<h2>Application Examples<a class="headerlink" href="#application-examples" title="Permalink to this heading">ï</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/espressif/esp-idf/tree/v5.4.2/examples/system/task_watchdog">system/task_watchdog</a> demonstrates how to initialize, subscribe and unsubscribe tasks and users to the task watchdog, and how tasks and users can reset (feed) the task watchdog.</p></li>
</ul>
</section>
<section id="api-reference">
<h2>API Reference<a class="headerlink" href="#api-reference" title="Permalink to this heading">ï</a></h2>
<section id="header-file">
<h3>Header File<a class="headerlink" href="#header-file" title="Permalink to this heading">ï</a></h3>
<ul>
<li><p><a class="reference external" href="https://github.com/espressif/esp-idf/blob/v5.4.2/components/esp_system/include/esp_task_wdt.h">components/esp_system/include/esp_task_wdt.h</a></p></li>
<li><p>This header file can be included with:</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;esp_task_wdt.h&quot;</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</section>
<section id="functions">
<h3>Functions<a class="headerlink" href="#functions" title="Permalink to this heading">ï</a></h3>
<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv417esp_task_wdt_initPK21esp_task_wdt_config_t">
<span id="_CPPv317esp_task_wdt_initPK21esp_task_wdt_config_t"></span><span id="_CPPv217esp_task_wdt_initPK21esp_task_wdt_config_t"></span><span id="esp_task_wdt_init__esp_task_wdt_config_tCP"></span><span class="target" id="esp__task__wdt_8h_1a35f090c757737bc0bd9e0d2213c60dce"></span><a class="reference internal" href="esp_err.html#_CPPv49esp_err_t" title="esp_err_t"><span class="n"><span class="pre">esp_err_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">esp_task_wdt_init</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="#_CPPv421esp_task_wdt_config_t" title="esp_task_wdt_config_t"><span class="n"><span class="pre">esp_task_wdt_config_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">config</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv417esp_task_wdt_initPK21esp_task_wdt_config_t" title="Permalink to this definition">ï</a><br /></dt>
<dd><p>Initialize the Task Watchdog Timer (TWDT) </p>
<p>This function configures and initializes the TWDT. This function will subscribe the idle tasks if configured to do so. For other tasks, users can subscribe them using esp_task_wdt_add() or esp_task_wdt_add_user(). This function won't start the timer if no task have been registered yet.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>esp_task_wdt_init() must only be called after the scheduler is started. Moreover, it must not be called by multiple tasks simultaneously. </p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>config</strong> -- <strong>[in]</strong> Configuration structure </p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p>ESP_OK: Initialization was successful</p></li>
<li><p>ESP_ERR_INVALID_STATE: Already initialized</p></li>
<li><p>Other: Failed to initialize TWDT </p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv424esp_task_wdt_reconfigurePK21esp_task_wdt_config_t">
<span id="_CPPv324esp_task_wdt_reconfigurePK21esp_task_wdt_config_t"></span><span id="_CPPv224esp_task_wdt_reconfigurePK21esp_task_wdt_config_t"></span><span id="esp_task_wdt_reconfigure__esp_task_wdt_config_tCP"></span><span class="target" id="esp__task__wdt_8h_1a353553a8e4f0e9782a3c6aac491a8c10"></span><a class="reference internal" href="esp_err.html#_CPPv49esp_err_t" title="esp_err_t"><span class="n"><span class="pre">esp_err_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">esp_task_wdt_reconfigure</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="#_CPPv421esp_task_wdt_config_t" title="esp_task_wdt_config_t"><span class="n"><span class="pre">esp_task_wdt_config_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">config</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv424esp_task_wdt_reconfigurePK21esp_task_wdt_config_t" title="Permalink to this definition">ï</a><br /></dt>
<dd><p>Reconfigure the Task Watchdog Timer (TWDT) </p>
<p>The function reconfigures the running TWDT. It must already be initialized when this function is called.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>esp_task_wdt_reconfigure() must not be called by multiple tasks simultaneously.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>config</strong> -- <strong>[in]</strong> Configuration structure</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p>ESP_OK: Reconfiguring was successful</p></li>
<li><p>ESP_ERR_INVALID_STATE: TWDT not initialized yet</p></li>
<li><p>Other: Failed to initialize TWDT </p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv419esp_task_wdt_deinitv">
<span id="_CPPv319esp_task_wdt_deinitv"></span><span id="_CPPv219esp_task_wdt_deinitv"></span><span id="esp_task_wdt_deinit__void"></span><span class="target" id="esp__task__wdt_8h_1a4bf2413059d861ef983cb78655ee849c"></span><a class="reference internal" href="esp_err.html#_CPPv49esp_err_t" title="esp_err_t"><span class="n"><span class="pre">esp_err_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">esp_task_wdt_deinit</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv419esp_task_wdt_deinitv" title="Permalink to this definition">ï</a><br /></dt>
<dd><p>Deinitialize the Task Watchdog Timer (TWDT) </p>
<p>This function will deinitialize the TWDT, and unsubscribe any idle tasks. Calling this function whilst other tasks are still subscribed to the TWDT, or when the TWDT is already deinitialized, will result in an error code being returned.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>esp_task_wdt_deinit() must not be called by multiple tasks simultaneously. </p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p>ESP_OK: TWDT successfully deinitialized</p></li>
<li><p>Other: Failed to deinitialize TWDT </p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv416esp_task_wdt_add12TaskHandle_t">
<span id="_CPPv316esp_task_wdt_add12TaskHandle_t"></span><span id="_CPPv216esp_task_wdt_add12TaskHandle_t"></span><span id="esp_task_wdt_add__TaskHandle_t"></span><span class="target" id="esp__task__wdt_8h_1a2f6ed3df1695d9a512c864b7cd9157b6"></span><a class="reference internal" href="esp_err.html#_CPPv49esp_err_t" title="esp_err_t"><span class="n"><span class="pre">esp_err_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">esp_task_wdt_add</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="freertos_idf.html#_CPPv412TaskHandle_t" title="TaskHandle_t"><span class="n"><span class="pre">TaskHandle_t</span></span></a><span class="w"> </span><span class="n sig-param"><span class="pre">task_handle</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv416esp_task_wdt_add12TaskHandle_t" title="Permalink to this definition">ï</a><br /></dt>
<dd><p>Subscribe a task to the Task Watchdog Timer (TWDT) </p>
<p>This function subscribes a task to the TWDT. Each subscribed task must periodically call esp_task_wdt_reset() to prevent the TWDT from elapsing its timeout period. Failure to do so will result in a TWDT timeout.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>task_handle</strong> -- Handle of the task. Input NULL to subscribe the current running task to the TWDT </p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p>ESP_OK: Successfully subscribed the task to the TWDT</p></li>
<li><p>Other: Failed to subscribe task </p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv421esp_task_wdt_add_userPKcP26esp_task_wdt_user_handle_t">
<span id="_CPPv321esp_task_wdt_add_userPKcP26esp_task_wdt_user_handle_t"></span><span id="_CPPv221esp_task_wdt_add_userPKcP26esp_task_wdt_user_handle_t"></span><span id="esp_task_wdt_add_user__cCP.esp_task_wdt_user_handle_tP"></span><span class="target" id="esp__task__wdt_8h_1a770d9de745107c059495508f300b26cb"></span><a class="reference internal" href="esp_err.html#_CPPv49esp_err_t" title="esp_err_t"><span class="n"><span class="pre">esp_err_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">esp_task_wdt_add_user</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">user_name</span></span>, <a class="reference internal" href="#_CPPv426esp_task_wdt_user_handle_t" title="esp_task_wdt_user_handle_t"><span class="n"><span class="pre">esp_task_wdt_user_handle_t</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">user_handle_ret</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv421esp_task_wdt_add_userPKcP26esp_task_wdt_user_handle_t" title="Permalink to this definition">ï</a><br /></dt>
<dd><p>Subscribe a user to the Task Watchdog Timer (TWDT) </p>
<p>This function subscribes a user to the TWDT. A user of the TWDT is usually a function that needs to run periodically. Each subscribed user must periodically call esp_task_wdt_reset_user() to prevent the TWDT from elapsing its timeout period. Failure to do so will result in a TWDT timeout.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>user_name</strong> -- <strong>[in]</strong> String to identify the user </p></li>
<li><p><strong>user_handle_ret</strong> -- <strong>[out]</strong> Handle of the user </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p>ESP_OK: Successfully subscribed the user to the TWDT</p></li>
<li><p>Other: Failed to subscribe user </p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv418esp_task_wdt_resetv">
<span id="_CPPv318esp_task_wdt_resetv"></span><span id="_CPPv218esp_task_wdt_resetv"></span><span id="esp_task_wdt_reset__void"></span><span class="target" id="esp__task__wdt_8h_1a962752554e8ae7b53e3c8dbcec61f34d"></span><a class="reference internal" href="esp_err.html#_CPPv49esp_err_t" title="esp_err_t"><span class="n"><span class="pre">esp_err_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">esp_task_wdt_reset</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv418esp_task_wdt_resetv" title="Permalink to this definition">ï</a><br /></dt>
<dd><p>Reset the Task Watchdog Timer (TWDT) on behalf of the currently running task. </p>
<p>This function will reset the TWDT on behalf of the currently running task. Each subscribed task must periodically call this function to prevent the TWDT from timing out. If one or more subscribed tasks fail to reset the TWDT on their own behalf, a TWDT timeout will occur.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p>ESP_OK: Successfully reset the TWDT on behalf of the currently running task</p></li>
<li><p>Other: Failed to reset </p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv423esp_task_wdt_reset_user26esp_task_wdt_user_handle_t">
<span id="_CPPv323esp_task_wdt_reset_user26esp_task_wdt_user_handle_t"></span><span id="_CPPv223esp_task_wdt_reset_user26esp_task_wdt_user_handle_t"></span><span id="esp_task_wdt_reset_user__esp_task_wdt_user_handle_t"></span><span class="target" id="esp__task__wdt_8h_1a06e0063de7113c3a2dfe74b7bd8d2ad0"></span><a class="reference internal" href="esp_err.html#_CPPv49esp_err_t" title="esp_err_t"><span class="n"><span class="pre">esp_err_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">esp_task_wdt_reset_user</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="#_CPPv426esp_task_wdt_user_handle_t" title="esp_task_wdt_user_handle_t"><span class="n"><span class="pre">esp_task_wdt_user_handle_t</span></span></a><span class="w"> </span><span class="n sig-param"><span class="pre">user_handle</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv423esp_task_wdt_reset_user26esp_task_wdt_user_handle_t" title="Permalink to this definition">ï</a><br /></dt>
<dd><p>Reset the Task Watchdog Timer (TWDT) on behalf of a user. </p>
<p>This function will reset the TWDT on behalf of a user. Each subscribed user must periodically call this function to prevent the TWDT from timing out. If one or more subscribed users fail to reset the TWDT on their own behalf, a TWDT timeout will occur.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>user_handle</strong> -- <strong>[in]</strong> User handle<ul class="simple">
<li><p>ESP_OK: Successfully reset the TWDT on behalf of the user</p></li>
<li><p>Other: Failed to reset </p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv419esp_task_wdt_delete12TaskHandle_t">
<span id="_CPPv319esp_task_wdt_delete12TaskHandle_t"></span><span id="_CPPv219esp_task_wdt_delete12TaskHandle_t"></span><span id="esp_task_wdt_delete__TaskHandle_t"></span><span class="target" id="esp__task__wdt_8h_1afef7cdbd33bdd67a529629c7bb2e2585"></span><a class="reference internal" href="esp_err.html#_CPPv49esp_err_t" title="esp_err_t"><span class="n"><span class="pre">esp_err_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">esp_task_wdt_delete</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="freertos_idf.html#_CPPv412TaskHandle_t" title="TaskHandle_t"><span class="n"><span class="pre">TaskHandle_t</span></span></a><span class="w"> </span><span class="n sig-param"><span class="pre">task_handle</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv419esp_task_wdt_delete12TaskHandle_t" title="Permalink to this definition">ï</a><br /></dt>
<dd><p>Unsubscribes a task from the Task Watchdog Timer (TWDT) </p>
<p>This function will unsubscribe a task from the TWDT. After being unsubscribed, the task should no longer call esp_task_wdt_reset().</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>task_handle</strong> -- <strong>[in]</strong> Handle of the task. Input NULL to unsubscribe the current running task. </p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p>ESP_OK: Successfully unsubscribed the task from the TWDT</p></li>
<li><p>Other: Failed to unsubscribe task </p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv424esp_task_wdt_delete_user26esp_task_wdt_user_handle_t">
<span id="_CPPv324esp_task_wdt_delete_user26esp_task_wdt_user_handle_t"></span><span id="_CPPv224esp_task_wdt_delete_user26esp_task_wdt_user_handle_t"></span><span id="esp_task_wdt_delete_user__esp_task_wdt_user_handle_t"></span><span class="target" id="esp__task__wdt_8h_1a984def80b9d07d323c4bb6edf75f3987"></span><a class="reference internal" href="esp_err.html#_CPPv49esp_err_t" title="esp_err_t"><span class="n"><span class="pre">esp_err_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">esp_task_wdt_delete_user</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="#_CPPv426esp_task_wdt_user_handle_t" title="esp_task_wdt_user_handle_t"><span class="n"><span class="pre">esp_task_wdt_user_handle_t</span></span></a><span class="w"> </span><span class="n sig-param"><span class="pre">user_handle</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv424esp_task_wdt_delete_user26esp_task_wdt_user_handle_t" title="Permalink to this definition">ï</a><br /></dt>
<dd><p>Unsubscribes a user from the Task Watchdog Timer (TWDT) </p>
<p>This function will unsubscribe a user from the TWDT. After being unsubscribed, the user should no longer call esp_task_wdt_reset_user().</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>user_handle</strong> -- <strong>[in]</strong> User handle </p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p>ESP_OK: Successfully unsubscribed the user from the TWDT</p></li>
<li><p>Other: Failed to unsubscribe user </p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv419esp_task_wdt_status12TaskHandle_t">
<span id="_CPPv319esp_task_wdt_status12TaskHandle_t"></span><span id="_CPPv219esp_task_wdt_status12TaskHandle_t"></span><span id="esp_task_wdt_status__TaskHandle_t"></span><span class="target" id="esp__task__wdt_8h_1ac839881b786f641aaa97a887117316ac"></span><a class="reference internal" href="esp_err.html#_CPPv49esp_err_t" title="esp_err_t"><span class="n"><span class="pre">esp_err_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">esp_task_wdt_status</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="freertos_idf.html#_CPPv412TaskHandle_t" title="TaskHandle_t"><span class="n"><span class="pre">TaskHandle_t</span></span></a><span class="w"> </span><span class="n sig-param"><span class="pre">task_handle</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv419esp_task_wdt_status12TaskHandle_t" title="Permalink to this definition">ï</a><br /></dt>
<dd><p>Query whether a task is subscribed to the Task Watchdog Timer (TWDT) </p>
<p>This function will query whether a task is currently subscribed to the TWDT, or whether the TWDT is initialized.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>task_handle</strong> -- <strong>[in]</strong> Handle of the task. Input NULL to query the current running task. </p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>:<ul class="simple">
<li><p>ESP_OK: The task is currently subscribed to the TWDT</p></li>
<li><p>ESP_ERR_NOT_FOUND: The task is not subscribed</p></li>
<li><p>ESP_ERR_INVALID_STATE: TWDT was never initialized </p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv429esp_task_wdt_isr_user_handlerv">
<span id="_CPPv329esp_task_wdt_isr_user_handlerv"></span><span id="_CPPv229esp_task_wdt_isr_user_handlerv"></span><span id="esp_task_wdt_isr_user_handler__void"></span><span class="target" id="esp__task__wdt_8h_1a1f2a8567a429b77ce674c72b73d12582"></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">esp_task_wdt_isr_user_handler</span></span></span><span class="sig-paren">(</span><span class="kt"><span class="pre">void</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv429esp_task_wdt_isr_user_handlerv" title="Permalink to this definition">ï</a><br /></dt>
<dd><p>User ISR callback placeholder. </p>
<p>This function is called by task_wdt_isr function (ISR for when TWDT times out). It can be defined in user code to handle TWDT events.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It has the same limitations as the interrupt function. Do not use ESP_LOGx functions inside. </p>
</div>
</dd></dl>

<dl class="cpp function">
<dt class="sig sig-object cpp" id="_CPPv434esp_task_wdt_print_triggered_tasks20task_wdt_msg_handlerPvPi">
<span id="_CPPv334esp_task_wdt_print_triggered_tasks20task_wdt_msg_handlerPvPi"></span><span id="_CPPv234esp_task_wdt_print_triggered_tasks20task_wdt_msg_handlerPvPi"></span><span id="esp_task_wdt_print_triggered_tasks__task_wdt_msg_handler.voidP.iP"></span><span class="target" id="esp__task__wdt_8h_1adc7613ffb2101025dd12dcf11e361cf1"></span><a class="reference internal" href="esp_err.html#_CPPv49esp_err_t" title="esp_err_t"><span class="n"><span class="pre">esp_err_t</span></span></a><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">esp_task_wdt_print_triggered_tasks</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="#_CPPv420task_wdt_msg_handler" title="task_wdt_msg_handler"><span class="n"><span class="pre">task_wdt_msg_handler</span></span></a><span class="w"> </span><span class="n sig-param"><span class="pre">msg_handler</span></span>, <span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">opaque</span></span>, <span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n sig-param"><span class="pre">cpus_fail</span></span><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv434esp_task_wdt_print_triggered_tasks20task_wdt_msg_handlerPvPi" title="Permalink to this definition">ï</a><br /></dt>
<dd><p>Prints or retrieves information about tasks/users that triggered the Task Watchdog Timeout. </p>
<p>This function provides various operations to handle tasks/users that did not reset the Task Watchdog in time. It can print detailed information about these tasks/users, such as their names, associated CPUs, and whether they have been reset. Additionally, it can retrieve the total length of the printed information or the CPU affinity of the failing tasks.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">msg_handler</span></code> is not provided, the information will be printed to console using ESP_EARLY_LOGE.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">msg_handler</span></code> is provided, the function will send the printed information to the provided message handler function.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">cpus_fail</span></code> is provided, the function will store the CPU affinity of the failing tasks in the provided integer.</p></li>
<li><p>During the execution of this function, logging is allowed in critical sections, as TWDT timeouts are considered fatal errors. </p></li>
</ul>
</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>msg_handler</strong> -- <strong>[in]</strong> Optional message handler function that will be called for each printed line. </p></li>
<li><p><strong>opaque</strong> -- <strong>[in]</strong> Optional pointer to opaque data that will be passed to the message handler function. </p></li>
<li><p><strong>cpus_fail</strong> -- <strong>[out]</strong> Optional pointer to an integer where the CPU affinity of the failing tasks will be stored.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p>ESP_OK: The function executed successfully.</p></li>
<li><p>ESP_FAIL: No triggered tasks were found, and thus no information was printed or retrieved.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="structures">
<h3>Structures<a class="headerlink" href="#structures" title="Permalink to this heading">ï</a></h3>
<dl class="cpp struct">
<dt class="sig sig-object cpp" id="_CPPv421esp_task_wdt_config_t">
<span id="_CPPv321esp_task_wdt_config_t"></span><span id="_CPPv221esp_task_wdt_config_t"></span><span id="esp_task_wdt_config_t"></span><span class="target" id="structesp__task__wdt__config__t"></span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">esp_task_wdt_config_t</span></span></span><a class="headerlink" href="#_CPPv421esp_task_wdt_config_t" title="Permalink to this definition">ï</a><br /></dt>
<dd><p>Task Watchdog Timer (TWDT) configuration structure. </p>
<div class="breathe-sectiondef docutils container">
<p class="breathe-sectiondef-title rubric" id="breathe-section-title-public-members">Public Members</p>
<dl class="cpp var">
<dt class="sig sig-object cpp" id="_CPPv4N21esp_task_wdt_config_t10timeout_msE">
<span id="_CPPv3N21esp_task_wdt_config_t10timeout_msE"></span><span id="_CPPv2N21esp_task_wdt_config_t10timeout_msE"></span><span id="esp_task_wdt_config_t::timeout_ms__uint32_t"></span><span class="target" id="structesp__task__wdt__config__t_1a571fcb73e97e782aabd2404e8f8de9e5"></span><span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">timeout_ms</span></span></span><a class="headerlink" href="#_CPPv4N21esp_task_wdt_config_t10timeout_msE" title="Permalink to this definition">ï</a><br /></dt>
<dd><p>TWDT timeout duration in milliseconds </p>
</dd></dl>

<dl class="cpp var">
<dt class="sig sig-object cpp" id="_CPPv4N21esp_task_wdt_config_t14idle_core_maskE">
<span id="_CPPv3N21esp_task_wdt_config_t14idle_core_maskE"></span><span id="_CPPv2N21esp_task_wdt_config_t14idle_core_maskE"></span><span id="esp_task_wdt_config_t::idle_core_mask__uint32_t"></span><span class="target" id="structesp__task__wdt__config__t_1aa36f8914bd6ca5491637f44c1074c66a"></span><span class="n"><span class="pre">uint32_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">idle_core_mask</span></span></span><a class="headerlink" href="#_CPPv4N21esp_task_wdt_config_t14idle_core_maskE" title="Permalink to this definition">ï</a><br /></dt>
<dd><p>Bitmask of the core whose idle task should be subscribed on initialization where 1 &lt;&lt; i means that core i's idle task will be monitored by the TWDT </p>
</dd></dl>

<dl class="cpp var">
<dt class="sig sig-object cpp" id="_CPPv4N21esp_task_wdt_config_t13trigger_panicE">
<span id="_CPPv3N21esp_task_wdt_config_t13trigger_panicE"></span><span id="_CPPv2N21esp_task_wdt_config_t13trigger_panicE"></span><span id="esp_task_wdt_config_t::trigger_panic__b"></span><span class="target" id="structesp__task__wdt__config__t_1a7557a4b3ced688bc248db4133fff5644"></span><span class="kt"><span class="pre">bool</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">trigger_panic</span></span></span><a class="headerlink" href="#_CPPv4N21esp_task_wdt_config_t13trigger_panicE" title="Permalink to this definition">ï</a><br /></dt>
<dd><p>Trigger panic when timeout occurs </p>
</dd></dl>

</div>
</dd></dl>

</section>
<section id="type-definitions">
<h3>Type Definitions<a class="headerlink" href="#type-definitions" title="Permalink to this heading">ï</a></h3>
<dl class="cpp type">
<dt class="sig sig-object cpp" id="_CPPv426esp_task_wdt_user_handle_t">
<span id="_CPPv326esp_task_wdt_user_handle_t"></span><span id="_CPPv226esp_task_wdt_user_handle_t"></span><span id="esp_task_wdt_user_handle_t"></span><span class="target" id="esp__task__wdt_8h_1a7f4bb209f45d3f03d0e5a5d09fc39006"></span><span class="k"><span class="pre">typedef</span></span><span class="w"> </span><span class="k"><span class="pre">struct</span></span><span class="w"> </span><span class="n"><span class="pre">esp_task_wdt_user_handle_s</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">esp_task_wdt_user_handle_t</span></span></span><a class="headerlink" href="#_CPPv426esp_task_wdt_user_handle_t" title="Permalink to this definition">ï</a><br /></dt>
<dd><p>Task Watchdog Timer (TWDT) user handle. </p>
</dd></dl>

<dl class="cpp type">
<dt class="sig sig-object cpp" id="_CPPv420task_wdt_msg_handler">
<span id="_CPPv320task_wdt_msg_handler"></span><span id="_CPPv220task_wdt_msg_handler"></span><span id="task_wdt_msg_handler"></span><span class="target" id="esp__task__wdt_8h_1a385ecaadd61d66e5f0af3e25ff01d6d4"></span><span class="k"><span class="pre">typedef</span></span><span class="w"> </span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">(</span></span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">task_wdt_msg_handler</span></span></span><span class="p"><span class="pre">)</span></span><span class="p"><span class="pre">(</span></span><span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">opaque</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">char</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">msg</span></span><span class="p"><span class="pre">)</span></span><a class="headerlink" href="#_CPPv420task_wdt_msg_handler" title="Permalink to this definition">ï</a><br /></dt>
<dd></dd></dl>

</section>
</section>
</section>

    <script type="text/javascript">
        function init() {
            WaveDrom.ProcessAll();
        }
        window.onload = init;
    </script>

           </div>
             <div class="articleComments">

<style>
    .expand-feedback-content {
        display: none;
    }
    .click-like-or-dislike {
        background-color: #d3d3d3;
        pointer-events: none;
    }
</style>

<script>
    function submitFeedbackForm(user_likes_document) {
        // Send to GA4 the user reaction
        gtag('event', 'user_reaction', {
            'user_likes_document': user_likes_document
        });

        if (user_likes_document === 1) {
            document.querySelector('.like-btn').classList.add('click-like-or-dislike');
            document.getElementById("expandContentLike").style.display = 'block';
        } else {
            document.querySelector('.dislike-btn').classList.add('click-like-or-dislike');
            document.getElementById("expandContent").style.display = 'block';
        }

        document.querySelector('.like-btn').style.pointerEvents = 'none';
        document.querySelector('.dislike-btn').style.pointerEvents = 'none';
    }
</script>

<hr>

<p style="text-align:center"><strong>Was this page helpful?</strong></p>
<p style="text-align:center">
    <button class="like-btn" onclick="submitFeedbackForm(1)">
        <svg aria-hidden="true" focusable="false" class="color-fg-muted" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom;overflow:visible">
            <path d="M8.834.066c.763.087 1.5.295 2.01.884.505.581.656 1.378.656 2.3 0 .467-.087 1.119-.157 1.637L11.328 5h1.422c.603 0 1.174.085 1.668.333.508.254.911.679 1.137 1.2.453.998.438 2.447.188 4.316l-.04.306c-.105.79-.195 1.473-.313 2.033-.131.63-.315 1.209-.668 1.672C13.97 15.847 12.706 16 11 16c-1.848 0-3.234-.333-4.388-.653-.165-.045-.323-.09-.475-.133-.658-.186-1.2-.34-1.725-.415A1.75 1.75 0 0 1 2.75 16h-1A1.75 1.75 0 0 1 0 14.25v-7.5C0 5.784.784 5 1.75 5h1a1.75 1.75 0 0 1 1.514.872c.258-.105.59-.268.918-.508C5.853 4.874 6.5 4.079 6.5 2.75v-.5c0-1.202.994-2.337 2.334-2.184ZM4.5 13.3c.705.088 1.39.284 2.072.478l.441.125c1.096.305 2.334.598 3.987.598 1.794 0 2.28-.223 2.528-.549.147-.193.276-.505.394-1.07.105-.502.188-1.124.295-1.93l.04-.3c.25-1.882.189-2.933-.068-3.497a.921.921 0 0 0-.442-.48c-.208-.104-.52-.174-.997-.174H11c-.686 0-1.295-.577-1.206-1.336.023-.192.05-.39.076-.586.065-.488.13-.97.13-1.328 0-.809-.144-1.15-.288-1.316-.137-.158-.402-.304-1.048-.378C8.357 1.521 8 1.793 8 2.25v.5c0 1.922-.978 3.128-1.933 3.825a5.831 5.831 0 0 1-1.567.81ZM2.75 6.5h-1a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h1a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
        </svg>
    </button>
    <button class="dislike-btn" onclick="submitFeedbackForm(0)">
        <svg aria-hidden="true" focusable="false" class="" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom;overflow:visible">
            <path d="M7.083 15.986c-.763-.087-1.499-.295-2.011-.884-.504-.581-.655-1.378-.655-2.299 0-.468.087-1.12.157-1.638l.015-.112H3.167c-.603 0-1.174-.086-1.669-.334a2.415 2.415 0 0 1-1.136-1.2c-.454-.998-.438-2.447-.188-4.316l.04-.306C.32 4.108.41 3.424.526 2.864c.132-.63.316-1.209.669-1.672C1.947.205 3.211.053 4.917.053c1.848 0 3.234.332 4.388.652l.474.133c.658.187 1.201.341 1.726.415a1.75 1.75 0 0 1 1.662-1.2h1c.966 0 1.75.784 1.75 1.75v7.5a1.75 1.75 0 0 1-1.75 1.75h-1a1.75 1.75 0 0 1-1.514-.872c-.259.105-.59.268-.919.508-.671.491-1.317 1.285-1.317 2.614v.5c0 1.201-.994 2.336-2.334 2.183Zm4.334-13.232c-.706-.089-1.39-.284-2.072-.479l-.441-.125c-1.096-.304-2.335-.597-3.987-.597-1.794 0-2.28.222-2.529.548-.147.193-.275.505-.393 1.07-.105.502-.188 1.124-.295 1.93l-.04.3c-.25 1.882-.19 2.933.067 3.497a.923.923 0 0 0 .443.48c.208.104.52.175.997.175h1.75c.685 0 1.295.577 1.205 1.335-.022.192-.049.39-.075.586-.066.488-.13.97-.13 1.329 0 .808.144 1.15.288 1.316.137.157.401.303 1.048.377.307.035.664-.237.664-.693v-.5c0-1.922.978-3.127 1.932-3.825a5.878 5.878 0 0 1 1.568-.809Zm1.75 6.798h1a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25h-1a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25Z"></path>
        </svg>
    </button>
</p>

<div class="expand-feedback-content" id="expandContentLike">
    <ul style="text-align:center">
        <li>Thank you! We received your feedback.</li>
        <li>If you have any comments, fill in <a href='https://www.espressif.com/en/company/documents/documentation_feedback?docId=4287&sections=Watchdogs (api-reference/system/wdts)&version=esp32 v5.4.2 (v5.4.2)'>Espressif Documentation Feedback Form</a>.</li>
    </ul>
</div>

<div class="expand-feedback-content" id="expandContent">
    <ul style="text-align:center">
        <li>We value your feedback.</li>
        <li>Let us know how we can improve this page by filling in <a href='https://www.espressif.com/en/company/documents/documentation_feedback?docId=4287&sections=Watchdogs (api-reference/system/wdts)&version=esp32 v5.4.2 (v5.4.2)'>Espressif Documentation Feedback Form</a>.</li>
    </ul>
</div>

<br>


             </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ulp_macros.html" class="btn btn-neutral float-left" title="Programming ULP FSM Coprocessor Using C Macros (Legacy)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../hw-reference/index.html" class="btn btn-neutral float-right" title="Hardware Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016 - 2025, Espressif Systems (Shanghai) Co., Ltd.</p>
  </div>

  <ul class="footer">
        <li>
	    
            
            Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/espressif/sphinx_idf_theme">theme</a>  based on <a href="https://github.com/readthedocs/sphinx_rtd_theme">Read the Docs Sphinx Theme</a>.
         </li>
    <li class="footer-aside">
        <a href="../../esp-idf-en-v5.4.2.zip"> Download HTML</a>
    </li>

  </ul> 

</footer>
        </div>
      </div>
    </section>
  </div>

  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>